<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Test Report</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a24;
      --bg-card-hover: #22222e;
      --bg-sidebar: #0d0d14;
      --border-subtle: #2a2a3a;
      --border-glow: #3b3b4f;
      --text-primary: #f0f0f5;
      --text-secondary: #8888a0;
      --text-muted: #5a5a70;
      --accent-green: #00ff88;
      --accent-green-dim: #00cc6a;
      --accent-red: #ff4466;
      --accent-red-dim: #cc3355;
      --accent-yellow: #ffcc00;
      --accent-yellow-dim: #ccaa00;
      --accent-blue: #00aaff;
      --accent-blue-dim: #0088cc;
      --accent-purple: #aa66ff;
      --accent-orange: #ff8844;
      --sidebar-width: 260px;
      --topbar-height: 56px;
    }

    /* Light theme - respects system preference */
    @media (prefers-color-scheme: light) {
      :root:not([data-theme="dark"]) {
        --bg-primary: #f5f5f7;
        --bg-secondary: #ffffff;
        --bg-card: #ffffff;
        --bg-card-hover: #f0f0f2;
        --bg-sidebar: #fafafa;
        --border-subtle: #e0e0e5;
        --border-glow: #d0d0d8;
        --text-primary: #1a1a1f;
        --text-secondary: #5a5a6e;
        --text-muted: #8a8a9a;
        --accent-green: #00aa55;
        --accent-green-dim: #008844;
        --accent-red: #dd3344;
        --accent-red-dim: #bb2233;
        --accent-yellow: #cc9900;
        --accent-yellow-dim: #aa7700;
        --accent-blue: #0077cc;
        --accent-blue-dim: #005599;
        --accent-purple: #8844cc;
        --accent-orange: #dd6622;
      }
    }

    /* Manual dark theme override */
    :root[data-theme="dark"] {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a24;
      --bg-card-hover: #22222e;
      --bg-sidebar: #0d0d14;
      --border-subtle: #2a2a3a;
      --border-glow: #3b3b4f;
      --text-primary: #f0f0f5;
      --text-secondary: #8888a0;
      --text-muted: #5a5a70;
      --accent-green: #00ff88;
      --accent-green-dim: #00cc6a;
      --accent-red: #ff4466;
      --accent-red-dim: #cc3355;
      --accent-yellow: #ffcc00;
      --accent-yellow-dim: #ccaa00;
      --accent-blue: #00aaff;
      --accent-blue-dim: #0088cc;
      --accent-purple: #aa66ff;
      --accent-orange: #ff8844;
    }

    /* Manual light theme override */
    :root[data-theme="light"] {
      --bg-primary: #f5f5f7;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --bg-card-hover: #f0f0f2;
      --bg-sidebar: #fafafa;
      --border-subtle: #e0e0e5;
      --border-glow: #d0d0d8;
      --text-primary: #1a1a1f;
      --text-secondary: #5a5a6e;
      --text-muted: #8a8a9a;
      --accent-green: #00aa55;
      --accent-green-dim: #008844;
      --accent-red: #dd3344;
      --accent-red-dim: #bb2233;
      --accent-yellow: #cc9900;
      --accent-yellow-dim: #aa7700;
      --accent-blue: #0077cc;
      --accent-blue-dim: #005599;
      --accent-purple: #8844cc;
      --accent-orange: #dd6622;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    button {
      background: none;
      border: none;
      font: inherit;
      color: inherit;
      cursor: pointer;
    }

    body {
      font-family: 'Space Grotesk', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      height: 100vh;
      overflow: hidden;
      line-height: 1.5;
    }

    /* ============================================
       APP SHELL LAYOUT
    ============================================ */
    .app-shell {
      display: grid;
      grid-template-areas:
        "topbar topbar"
        "sidebar main";
      grid-template-columns: var(--sidebar-width) 1fr;
      grid-template-rows: var(--topbar-height) 1fr;
      height: 100vh;
      overflow: hidden;
      transition: grid-template-columns 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .app-shell.sidebar-collapsed {
      grid-template-columns: 0 1fr;
    }

    .app-shell.sidebar-collapsed .sidebar {
      transform: translateX(-100%);
      opacity: 0;
    }

    /* ============================================
       TOP BAR
    ============================================ */
    .top-bar {
      grid-area: topbar;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
      z-index: 100;
    }

    .top-bar-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .top-bar-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: transparent;
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .sidebar-toggle:hover {
      background: var(--bg-card);
      border-color: var(--border-glow);
      color: var(--text-primary);
    }

    .hamburger-icon {
      font-size: 1.1rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-blue) 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 700;
      color: var(--bg-primary);
    }

    .logo-icon-img {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      line-height: 1.2;
    }

    .logo-title {
      font-size: 0.95rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .logo-subtitle {
      font-size: 0.65rem;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
    }

    .breadcrumbs {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-left: 1rem;
      padding-left: 1rem;
      border-left: 1px solid var(--border-subtle);
    }

    .breadcrumb {
      font-size: 0.85rem;
      color: var(--text-muted);
      cursor: pointer;
      transition: color 0.2s;
    }

    .breadcrumb:hover { color: var(--text-secondary); }
    .breadcrumb.active { color: var(--text-primary); font-weight: 500; }

    .breadcrumb-separator {
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .search-trigger {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
      min-width: 200px;
    }

    .search-trigger:hover {
      border-color: var(--border-glow);
      color: var(--text-secondary);
    }

    .search-icon-btn { font-size: 0.85rem; }
    .search-label { flex: 1; text-align: left; font-size: 0.85rem; }
    .search-kbd {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      padding: 0.15rem 0.4rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      color: var(--text-muted);
    }

    .top-bar-btn {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.4rem 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      transition: all 0.2s;
    }

    .top-bar-btn:hover {
      background: var(--bg-card-hover);
      border-color: var(--accent-blue);
      color: var(--accent-blue);
    }

    .btn-label { font-size: 0.8rem; }

    .timestamp {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 0.4rem 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
    }

    /* ============================================
       SIDEBAR
    ============================================ */
    .sidebar {
      grid-area: sidebar;
      display: flex;
      flex-direction: column;
      background: var(--bg-sidebar);
      border-right: 1px solid var(--border-subtle);
      min-height: 0; /* Allow grid cell to shrink below content height */
      overflow-y: auto;
      overflow-x: hidden;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
    }

    /* Hidden by default on desktop */
    .sidebar-overlay {
      display: none;
    }

    .sidebar-progress {
      padding: 1.25rem;
      text-align: center;
      border-bottom: 1px solid var(--border-subtle);
      flex-shrink: 0;
    }

    .progress-ring-container {
      position: relative;
      width: 80px;
      height: 80px;
      margin: 0 auto;
    }

    .progress-ring-container.clickable {
      cursor: pointer;
      transition: transform 0.2s, filter 0.2s;
    }

    .progress-ring-container.clickable:hover {
      transform: scale(1.05);
      filter: brightness(1.1);
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring-bg {
      fill: none;
      stroke: var(--border-subtle);
      stroke-width: 6;
    }

    .progress-ring-fill {
      fill: none;
      stroke: var(--accent-green);
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
      filter: drop-shadow(0 0 6px var(--accent-green));
    }

    .progress-ring-value {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    .progress-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .sidebar-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      padding: 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
      flex-shrink: 0;
    }

    .mini-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mini-stat:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-glow);
      transform: translateY(-1px);
    }

    .mini-stat-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 1rem;
      font-weight: 700;
    }

    .mini-stat-label {
      font-size: 0.6rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .mini-stat.passed .mini-stat-value { color: var(--accent-green); }
    .mini-stat.failed .mini-stat-value { color: var(--accent-red); }
    .mini-stat.flaky .mini-stat-value { color: var(--accent-yellow); }

    .sidebar-nav {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
      flex-shrink: 0;
    }

    .sidebar-nav [role="tablist"] {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .nav-section-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.65rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 0.5rem 0.75rem;
      margin-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-subtle);
    }

    .clear-filters-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.7rem;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      opacity: 0.6;
      transition: all 0.2s;
    }

    .clear-filters-btn:hover {
      opacity: 1;
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .nav-item {
      position: relative;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0.75rem;
      width: 100%;
      padding: 0.6rem 0.75rem;
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.85rem;
      text-align: left;
    }

    .nav-item:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--bg-card);
      color: var(--accent-green);
      border-left: 3px solid var(--accent-green);
      padding-left: calc(0.75rem - 3px);
    }

    .nav-icon { font-size: 1rem; flex-shrink: 0; }
    .nav-label { flex: 1; font-weight: 500; white-space: nowrap; }
    .nav-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      background: var(--bg-secondary);
      border-radius: 10px;
      color: var(--text-muted);
    }

    .sidebar-filters {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
      flex-shrink: 0;
    }

    .filter-group {
      margin-bottom: 0.75rem;
    }

    .filter-group:last-child { margin-bottom: 0; }

    .filter-group-title {
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
      padding-left: 0.25rem;
    }

    .filter-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .filter-chip {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      padding: 0.35rem 0.6rem;
      border-radius: 20px;
      border: 1px solid var(--border-subtle);
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-chip:hover {
      background: var(--bg-card);
      color: var(--text-secondary);
      border-color: var(--border-glow);
    }

    .filter-chip.active {
      background: var(--bg-card);
      color: var(--accent-blue);
      border-color: var(--accent-blue);
    }

    .grade-chips .filter-chip {
      min-width: 28px;
      text-align: center;
    }

    .filter-chip.grade-a { border-color: var(--accent-green-dim); }
    .filter-chip.grade-a:hover, .filter-chip.grade-a.active { background: var(--accent-green); color: var(--bg-primary); border-color: var(--accent-green); }
    .filter-chip.grade-b { border-color: var(--accent-blue-dim); }
    .filter-chip.grade-b:hover, .filter-chip.grade-b.active { background: var(--accent-blue); color: var(--bg-primary); border-color: var(--accent-blue); }
    .filter-chip.grade-c { border-color: var(--accent-yellow-dim); }
    .filter-chip.grade-c:hover, .filter-chip.grade-c.active { background: var(--accent-yellow); color: var(--bg-primary); border-color: var(--accent-yellow); }
    .filter-chip.grade-d { border-color: var(--accent-orange); }
    .filter-chip.grade-d:hover, .filter-chip.grade-d.active { background: var(--accent-orange); color: var(--bg-primary); border-color: var(--accent-orange); }
    .filter-chip.grade-f { border-color: var(--accent-red-dim); }
    .filter-chip.grade-f:hover, .filter-chip.grade-f.active { background: var(--accent-red); color: var(--bg-primary); border-color: var(--accent-red); }

    /* Attention filter chips */
    .attention-chips .filter-chip {
      font-weight: 500;
    }
    .filter-chip.attention-new-failure { border-color: var(--accent-red-dim); }
    .filter-chip.attention-new-failure:hover:not(.active) { 
      background: rgba(255, 68, 102, 0.15); 
      color: var(--accent-red); 
      border-color: var(--accent-red); 
    }
    .filter-chip.attention-new-failure.active { 
      background: var(--accent-red); 
      color: var(--bg-primary); 
      border-color: var(--accent-red); 
    }
    .filter-chip.attention-regression { border-color: var(--accent-orange); }
    .filter-chip.attention-regression:hover:not(.active) { 
      background: rgba(255, 136, 68, 0.15); 
      color: var(--accent-orange); 
      border-color: var(--accent-orange); 
    }
    .filter-chip.attention-regression.active { 
      background: var(--accent-orange); 
      color: var(--bg-primary); 
      border-color: var(--accent-orange); 
    }
    .filter-chip.attention-fixed { border-color: var(--accent-green-dim); }
    .filter-chip.attention-fixed:hover:not(.active) { 
      background: rgba(0, 255, 136, 0.15); 
      color: var(--accent-green); 
      border-color: var(--accent-green); 
    }
    .filter-chip.attention-fixed.active { 
      background: var(--accent-green); 
      color: var(--bg-primary); 
      border-color: var(--accent-green); 
    }

    .sidebar-files {
      padding: 0.75rem;
      flex-shrink: 0;
    }

    .file-tree {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .file-tree-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.8rem;
    }

    .file-tree-item:hover {
      background: var(--bg-card);
    }

    .file-tree-item.active {
      background: var(--bg-card);
      box-shadow: inset 2px 0 0 var(--accent-blue);
    }

    .file-tree-icon { font-size: 0.85rem; }
    .file-tree-name {
      flex: 1;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .file-tree-item.has-failures .file-tree-name { color: var(--accent-red); }
    .file-tree-item.all-passed .file-tree-name { color: var(--text-secondary); }

    .file-tree-stats {
      display: flex;
      gap: 0.25rem;
    }

    .file-stat {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      padding: 0.1rem 0.35rem;
      border-radius: 4px;
    }

    .file-stat.passed { color: var(--accent-green); background: rgba(0, 255, 136, 0.1); }
    .file-stat.failed { color: var(--accent-red); background: rgba(255, 68, 102, 0.1); }

    .sidebar-footer {
      padding: 0.75rem;
      border-top: 1px solid var(--border-subtle);
      flex-shrink: 0;
    }

    .run-duration {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* ============================================
       MAIN CONTENT AREA
    ============================================ */
    .main-content {
      grid-area: main;
      overflow-y: auto;
      background: var(--bg-primary);
    }

    .view-panel {
      height: 100%;
      overflow-y: auto;
    }

    .view-header {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border-subtle);
      background: var(--bg-secondary);
    }

    .view-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    /* ============================================
       OVERVIEW VIEW
    ============================================ */
    .overview-content {
      padding: 1.5rem;
    }

    .overview-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card.large {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      transition: all 0.2s;
    }

    .stat-card.large:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .stat-icon {
      font-size: 1.5rem;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: var(--bg-secondary);
    }

    .stat-card.large.passed { border-left: 3px solid var(--accent-green); }
    .stat-card.large.passed .stat-icon { background: rgba(0, 255, 136, 0.1); color: var(--accent-green); }
    .stat-card.large.failed { border-left: 3px solid var(--accent-red); }
    .stat-card.large.failed .stat-icon { background: rgba(255, 68, 102, 0.1); color: var(--accent-red); }
    .stat-card.large.skipped { border-left: 3px solid var(--text-muted); }
    .stat-card.large.skipped .stat-icon { background: rgba(90, 90, 112, 0.1); color: var(--text-muted); }
    .stat-card.large.flaky { border-left: 3px solid var(--accent-yellow); }
    .stat-card.large.flaky .stat-icon { background: rgba(255, 204, 0, 0.1); color: var(--accent-yellow); }
    .stat-card.large.slow { border-left: 3px solid var(--accent-orange); }
    .stat-card.large.slow .stat-icon { background: rgba(255, 136, 68, 0.1); color: var(--accent-orange); }
    .stat-card.large.duration { border-left: 3px solid var(--accent-blue); }
    .stat-card.large.duration .stat-icon { background: rgba(0, 170, 255, 0.1); color: var(--accent-blue); }

    .stat-content { flex: 1; }

    .stat-card.large .stat-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .stat-card.large .stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .overview-trends {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 1.5rem;
    }

    /* ============================================
       OVERVIEW - HERO STATS
    ============================================ */
    .hero-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .hero-stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 1.25rem;
      transition: all 0.2s;
    }

    .hero-stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
    }

    .hero-stat-card.health {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .health-gauge {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .health-ring {
      transform: rotate(-90deg);
      width: 100%;
      height: 100%;
    }

    .health-ring-bg {
      fill: none;
      stroke: var(--border-subtle);
      stroke-width: 8;
    }

    .health-ring-fill {
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dasharray 0.5s ease;
    }

    .hero-stat-card.health.excellent .health-ring-fill { stroke: var(--accent-green); }
    .hero-stat-card.health.good .health-ring-fill { stroke: var(--accent-blue); }
    .hero-stat-card.health.fair .health-ring-fill { stroke: var(--accent-yellow); }
    .hero-stat-card.health.poor .health-ring-fill { stroke: var(--accent-red); }

    .health-score {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .health-grade {
      font-size: 1.5rem;
      font-weight: 800;
      display: block;
    }

    .hero-stat-card.health.excellent .health-grade { color: var(--accent-green); }
    .hero-stat-card.health.good .health-grade { color: var(--accent-blue); }
    .hero-stat-card.health.fair .health-grade { color: var(--accent-yellow); }
    .hero-stat-card.health.poor .health-grade { color: var(--accent-red); }

    .health-value {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .hero-stat-info {
      flex: 1;
    }

    .health-breakdown {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
    }

    .hero-stat-main {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }

    .hero-stat-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .hero-stat-delta {
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
    }

    .hero-stat-delta.positive {
      color: var(--accent-green);
      background: rgba(0, 255, 136, 0.1);
    }

    .hero-stat-delta.negative {
      color: var(--accent-red);
      background: rgba(255, 68, 102, 0.1);
    }

    .hero-stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .hero-stat-detail {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* Mini Comparison Bars */
    .mini-comparison {
      padding: 1rem;
    }

    .mini-bars {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .mini-bar-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .mini-bar-row.clickable {
      cursor: pointer;
      padding: 0.35rem 0.5rem;
      margin: -0.35rem -0.5rem;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .mini-bar-row.clickable:hover {
      background: var(--bg-card-hover);
    }

    .mini-bar-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      width: 50px;
    }

    .mini-bar-track {
      flex: 1;
      height: 8px;
      background: var(--bg-secondary);
      border-radius: 4px;
      overflow: hidden;
    }

    .mini-bar {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .mini-bar.passed { background: var(--accent-green); }
    .mini-bar.failed { background: var(--accent-red); }
    .mini-bar.skipped { background: var(--text-muted); }

    .mini-bar-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-secondary);
      width: 30px;
      text-align: right;
    }

    /* ============================================
       OVERVIEW - ATTENTION SECTION
    ============================================ */
    .overview-section {
      margin-bottom: 1.5rem;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .section-icon {
      font-size: 1.1rem;
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-secondary);
    }

    .attention-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }

    .attention-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 4px solid transparent;
    }

    .attention-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .attention-card.critical {
      border-left-color: var(--accent-red);
      background: linear-gradient(135deg, rgba(255, 68, 102, 0.05) 0%, transparent 50%);
    }

    .attention-card.warning {
      border-left-color: var(--accent-yellow);
      background: linear-gradient(135deg, rgba(255, 204, 0, 0.05) 0%, transparent 50%);
    }

    .attention-card.success {
      border-left-color: var(--accent-green);
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.05) 0%, transparent 50%);
    }

    .attention-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .attention-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }

    .attention-desc {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* ============================================
       OVERVIEW - FAILURE CLUSTERS
    ============================================ */
    .failure-clusters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
    }

    .cluster-card {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-left: 3px solid var(--accent-red);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .cluster-card:hover {
      background: var(--bg-card-hover);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .cluster-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .cluster-icon {
      font-size: 1rem;
    }

    .cluster-type {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent-red);
      flex: 1;
    }

    .cluster-count {
      font-size: 0.7rem;
      color: var(--text-muted);
      background: var(--bg-secondary);
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
    }

    .cluster-error {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-secondary);
      background: var(--bg-secondary);
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .cluster-tests {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .cluster-test-name {
      font-size: 0.7rem;
      color: var(--text-secondary);
      background: var(--bg-secondary);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
    }

    .cluster-files {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.25rem;
    }

    .cluster-file {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .cluster-more {
      font-size: 0.65rem;
      color: var(--text-muted);
      font-style: italic;
    }

    /* ============================================
       OVERVIEW - QUICK INSIGHTS
    ============================================ */
    .insights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }

    .insight-card {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .insight-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .insight-icon {
      font-size: 1.5rem;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-secondary);
      border-radius: 10px;
    }

    .insight-content {
      flex: 1;
      min-width: 0;
    }

    .insight-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .insight-title {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .insight-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    .insight-mini-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 0.25rem;
    }

    .mini-stat {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .dot.passed { background: var(--accent-green); }
    .dot.failed { background: var(--accent-red); }
    .dot.skipped { background: var(--text-muted); }

    .mini-sparkline {
      display: flex;
      align-items: flex-end;
      gap: 3px;
      height: 30px;
      margin-top: 0.5rem;
    }

    .spark-col {
      flex: 1;
      height: 100%;
      display: flex;
      align-items: flex-end;
    }

    .spark-bar {
      width: 100%;
      background: var(--accent-green);
      border-radius: 2px;
      min-height: 3px;
      transition: height 0.3s ease;
    }

    .mini-sparkline .no-data {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* ============================================
       TESTS VIEW - MASTER-DETAIL LAYOUT
    ============================================ */
    .master-detail-layout {
      display: grid;
      grid-template-columns: 380px 1fr;
      height: 100%;
    }

    .test-list-panel {
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border-subtle);
      background: var(--bg-secondary);
      overflow: hidden;
    }

    .test-list-header {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
      background: var(--bg-card);
    }

    .test-list-tabs {
      display: flex;
      gap: 0.25rem;
      margin-bottom: 0.75rem;
    }

    .tab-btn {
      font-size: 0.75rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
      font-weight: 500;
    }

    .tab-btn:hover {
      background: var(--bg-card);
      color: var(--text-secondary);
    }

    .tab-btn.active {
      background: var(--bg-card);
      color: var(--accent-blue);
      border-color: var(--accent-blue);
    }

    .test-list-search {
      width: 100%;
    }

    .inline-search {
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
    }

    .inline-search:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .inline-search::placeholder { color: var(--text-muted); }

    .test-list-content {
      flex: 1;
      overflow-y: auto;
    }

    .test-tab-content {
      display: none;
      padding: 0.5rem;
    }

    .test-tab-content.active { display: block; }

    /* Test List Items */
    .test-list-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      margin-bottom: 0.25rem;
      background: var(--bg-card);
      border: 1px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .test-list-item:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-subtle);
    }

    .test-list-item.selected {
      background: var(--bg-card-hover);
      border-color: var(--accent-blue);
      box-shadow: inset 3px 0 0 var(--accent-blue);
    }

    .test-item-status { flex-shrink: 0; }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .status-dot.passed { background: var(--accent-green); box-shadow: 0 0 8px var(--accent-green); }
    .status-dot.failed { background: var(--accent-red); box-shadow: 0 0 8px var(--accent-red); }
    .status-dot.skipped { background: var(--text-muted); }

    .test-item-info {
      flex: 1;
      min-width: 0;
    }

    .test-item-title {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .test-item-file {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .test-item-meta {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-shrink: 0;
    }

    .test-item-duration {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .test-item-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.6rem;
      padding: 0.15rem 0.35rem;
      border-radius: 4px;
      text-transform: uppercase;
    }

    .test-item-badge.flaky { background: rgba(255, 204, 0, 0.15); color: var(--accent-yellow); }
    .test-item-badge.slow { background: rgba(255, 136, 68, 0.15); color: var(--accent-orange); }
    .test-item-badge.new { background: rgba(0, 170, 255, 0.15); color: var(--accent-blue); }
    
    /* Attention badges - more prominent */
    .test-item-badge.new-failure { 
      background: rgba(255, 68, 102, 0.2); 
      color: var(--accent-red); 
      font-weight: 600;
      animation: pulse-badge 2s ease-in-out infinite;
    }
    .test-item-badge.regression { 
      background: rgba(255, 136, 68, 0.2); 
      color: var(--accent-orange);
      font-weight: 600;
    }
    .test-item-badge.fixed { 
      background: rgba(0, 255, 136, 0.2); 
      color: var(--accent-green);
      font-weight: 600;
    }

    @keyframes pulse-badge {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .stability-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      font-weight: 700;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
    }

    .stability-badge.grade-a { background: rgba(0, 255, 136, 0.15); color: var(--accent-green); }
    .stability-badge.grade-b { background: rgba(0, 170, 255, 0.15); color: var(--accent-blue); }
    .stability-badge.grade-c { background: rgba(255, 204, 0, 0.15); color: var(--accent-yellow); }
    .stability-badge.grade-d { background: rgba(255, 136, 68, 0.15); color: var(--accent-orange); }
    .stability-badge.grade-f { background: rgba(255, 68, 102, 0.15); color: var(--accent-red); }

    /* Status/Stability Groups */
    .status-group, .stability-group {
      margin-bottom: 1rem;
    }

    .status-group-header, .stability-group-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      margin-bottom: 0.5rem;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .status-group-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-group-dot.passed { background: var(--accent-green); }
    .status-group-dot.failed { background: var(--accent-red); }
    .status-group-dot.skipped { background: var(--text-muted); }

    /* Test Detail Panel */
    .test-detail-panel {
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      background: var(--bg-primary);
    }

    .detail-placeholder {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      color: var(--text-muted);
    }

    .placeholder-icon { font-size: 4rem; opacity: 0.3; }
    .placeholder-text { font-size: 1.1rem; }
    .placeholder-hint { font-size: 0.85rem; opacity: 0.6; }

    /* Detail View Content (when test is selected) */
    .detail-view-content {
      padding: 1.5rem;
    }

    .detail-view-header {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border-subtle);
      margin-bottom: 1.5rem;
    }

    .detail-status-indicator {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 0.25rem;
    }

    .detail-status-indicator.passed { background: var(--accent-green); box-shadow: 0 0 12px var(--accent-green); }
    .detail-status-indicator.failed { background: var(--accent-red); box-shadow: 0 0 12px var(--accent-red); }
    .detail-status-indicator.skipped { background: var(--text-muted); }

    .detail-info { flex: 1; min-width: 0; }

    .detail-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 0.25rem 0;
      word-break: break-word;
    }

    .detail-file {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .detail-duration {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 1rem;
      color: var(--text-secondary);
      flex-shrink: 0;
    }

    /* Make test-card work inside detail panel */
    .test-detail-panel .test-card {
      background: transparent;
      border: none;
      border-radius: 0;
    }

    .test-detail-panel .test-card-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-subtle);
      cursor: default;
    }

    .test-detail-panel .test-details {
      display: block !important;
      padding: 1.5rem;
      background: transparent;
      border-top: none;
    }

    /* ============================================
       SEARCH MODAL
    ============================================ */
    .search-modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 1000;
      align-items: flex-start;
      justify-content: center;
      padding-top: 15vh;
    }

    .search-modal.open { display: flex; }

    .search-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }

    .search-modal-content {
      position: relative;
      width: 100%;
      max-width: 600px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }

    .search-modal-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      border-bottom: 1px solid var(--border-subtle);
    }

    .search-modal-icon { font-size: 1.25rem; color: var(--text-muted); }

    .search-modal-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
    }

    .search-modal-input::placeholder { color: var(--text-muted); }

    .search-modal-esc {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      color: var(--text-muted);
    }

    .search-modal-results {
      max-height: 400px;
      overflow-y: auto;
    }

    .search-result-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: background 0.15s;
    }

    .search-result-item:hover {
      background: var(--bg-card-hover);
    }

    .search-result-item .status-dot { flex-shrink: 0; }

    .search-result-info { flex: 1; min-width: 0; }

    .search-result-title {
      font-size: 0.9rem;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .search-result-file {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* ============================================
       EXISTING STYLES (preserved from original)
    ============================================ */

    .progress-ring .value {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    /* Trend Chart - Pass Rate Over Time */
    .trend-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      position: relative;
      overflow: hidden;
    }

    .trend-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
      opacity: 0.8;
    }

    .trend-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      cursor: pointer;
      user-select: none;
    }

    .trend-header:hover .section-toggle {
      color: var(--text-primary);
    }

    .trend-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .trend-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
    }

    .section-toggle {
      color: var(--text-muted);
      font-size: 0.8rem;
      transition: transform 0.2s ease, color 0.2s ease;
      margin-left: 0.5rem;
    }

    .collapsible-section.collapsed .section-toggle {
      transform: rotate(-90deg);
    }

    .collapsible-section.collapsed .section-content {
      display: none;
    }

    .section-content {
      animation: slideDown 0.2s ease;
    }

    .trend-message {
      padding: 1.5rem;
      background: var(--bg-primary);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      text-align: center;
      color: var(--text-secondary);
    }

    .trend-message p {
      margin: 0.5rem 0;
    }

    .trend-message code {
      background: var(--bg-secondary);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.85em;
    }

    .trend-chart {
      display: flex;
      align-items: flex-end;
      gap: 10px;
      height: 140px;
      padding: 20px 16px 12px;
      background: var(--bg-primary);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      position: relative;
    }

    /* Grid lines */
    .trend-chart::before {
      content: '';
      position: absolute;
      left: 8px;
      right: 8px;
      top: 25%;
      border-top: 1px dashed var(--border-subtle);
    }

    .trend-chart::after {
      content: '';
      position: absolute;
      left: 8px;
      right: 8px;
      top: 50%;
      border-top: 1px dashed var(--border-subtle);
    }

    .trend-bar-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 40px;
      max-width: 60px;
      z-index: 1;
    }

    .trend-bar {
      width: 100%;
      background: linear-gradient(180deg, var(--accent-green) 0%, var(--accent-green-dim) 100%);
      border-radius: 6px 6px 2px 2px;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 255, 136, 0.2);
    }

    .trend-bar:hover {
      transform: scaleY(1.02);
      box-shadow: 0 4px 16px rgba(0, 255, 136, 0.3);
    }

    .trend-bar.low {
      background: linear-gradient(180deg, var(--accent-red) 0%, var(--accent-red-dim) 100%);
      box-shadow: 0 2px 8px rgba(255, 68, 102, 0.2);
    }

    .trend-bar.low:hover {
      box-shadow: 0 4px 16px rgba(255, 68, 102, 0.3);
    }

    .trend-bar.medium {
      background: linear-gradient(180deg, var(--accent-yellow) 0%, var(--accent-yellow-dim) 100%);
      box-shadow: 0 2px 8px rgba(255, 204, 0, 0.2);
    }

    .trend-bar.medium:hover {
      box-shadow: 0 4px 16px rgba(255, 204, 0, 0.3);
    }

    .trend-bar.current {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.4), 0 2px 8px rgba(0, 255, 136, 0.3);
      border: 2px solid var(--text-primary);
    }

    .trend-label {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      color: var(--text-muted);
      white-space: nowrap;
      margin-top: 4px;
    }


    /* Stacked Bar Styles */
    .trend-stacked-bar {
      width: 100%;
      display: flex;
      flex-direction: column;
      border-radius: 6px 6px 2px 2px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .trend-segment {
      width: 100%;
      transition: all 0.2s ease;
      position: relative;
      cursor: pointer;
    }

    .trend-segment-label {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      font-weight: 600;
      color: var(--bg-primary);
      background: rgba(0, 0, 0, 0.7);
      padding: 3px 6px;
      border-radius: 4px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 10;
    }

    .trend-segment:hover .trend-segment-label {
      opacity: 1;
    }

    .trend-segment.passed {
      background: linear-gradient(180deg, var(--accent-green) 0%, var(--accent-green-dim) 100%);
    }

    .trend-segment.passed:hover {
      background: linear-gradient(180deg, #00ffaa 0%, var(--accent-green) 100%);
      box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.3), 0 0 12px rgba(0, 255, 136, 0.5);
      z-index: 2;
    }

    .trend-segment.passed .trend-segment-label {
      color: var(--accent-green);
    }

    .trend-segment.failed {
      background: linear-gradient(180deg, var(--accent-red) 0%, var(--accent-red-dim) 100%);
    }

    .trend-segment.failed:hover {
      background: linear-gradient(180deg, #ff6688 0%, var(--accent-red) 100%);
      box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.3), 0 0 12px rgba(255, 68, 102, 0.5);
      z-index: 2;
    }

    .trend-segment.failed .trend-segment-label {
      color: var(--accent-red);
    }

    .trend-segment.skipped {
      background: linear-gradient(180deg, var(--text-muted) 0%, #444455 100%);
    }

    .trend-segment.skipped:hover {
      background: linear-gradient(180deg, #8888bb 0%, var(--text-muted) 100%);
      box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.2), 0 0 12px rgba(136, 136, 187, 0.4);
      z-index: 2;
    }

    .trend-segment.skipped .trend-segment-label {
      color: #aaaacc;
    }

    .trend-bar-wrapper.current .trend-stacked-bar {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.4), 0 2px 8px rgba(0, 255, 136, 0.3);
      border: 2px solid var(--text-primary);
    }

    /* Chart Bar Hover Effects */
    .chart-bar {
      cursor: default;
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    .chart-bar-clickable {
      cursor: pointer;
    }

    .chart-bar:hover {
      opacity: 1 !important;
      filter: brightness(1.1);
    }

    .bar-group {
      cursor: default;
    }

    .bar-group.clickable {
      cursor: pointer;
    }

    .bar-group.clickable:hover .chart-bar {
      transform: translateY(-2px);
      filter: brightness(1.2);
    }

    .bar-group:hover .chart-bar {
      transform: translateY(-2px);
    }

    /* History Banner */
    .history-banner {
      display: none;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      margin-top: 0.75rem;
      background: linear-gradient(135deg, rgba(0, 170, 255, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
      border: 1px solid var(--accent-blue-dim);
      border-radius: 8px;
    }

    .history-banner-icon {
      font-size: 1.25rem;
    }

    .history-banner-text {
      flex: 1;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .history-banner-text strong {
      color: var(--accent-blue);
    }

    .history-banner-close {
      padding: 0.4rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 500;
      background: var(--accent-blue);
      color: var(--bg-primary);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .history-banner-close:hover {
      filter: brightness(1.1);
    }

    /* Historical test item badge */
    .test-item-badge.historical {
      background: rgba(168, 85, 247, 0.15);
      color: #a855f7;
    }

    .test-list-item.historical-item {
      border-left: 3px solid #a855f7;
    }

    /* Chart Tooltip */
    .chart-tooltip {
      position: absolute;
      display: none;
      background: var(--bg-card);
      color: var(--text-primary);
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      pointer-events: none;
      z-index: 10000;
      white-space: nowrap;
    }

    .line-chart-container {
      background: var(--bg-primary);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .chart-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 1rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .all-charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.25rem;
      margin-top: 1rem;
    }

    @media (max-width: 1024px) {
      .all-charts-grid {
        grid-template-columns: 1fr;
      }
    }

    .secondary-trends-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.25rem;
      margin-top: 1rem;
    }

    @media (max-width: 1024px) {
      .secondary-trends-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Secondary Trend Sections (Duration, Flaky, Slow) - Aligned with main trends */
    .secondary-trends {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      margin-top: 1.75rem;
      max-width: 100%;
    }

    .secondary-trend-section {
      background: var(--bg-primary);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 1rem 0;
      width: 100%;
    }

    .secondary-trend-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.875rem;
      padding: 0 16px;
    }

    .secondary-trend-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .secondary-trend-chart {
      display: flex;
      align-items: flex-end;
      gap: 10px;
      height: 50px;
      padding: 8px 16px 12px;
      overflow-x: auto;
      flex-wrap: nowrap;
      scrollbar-width: auto;
      scrollbar-color: rgba(100, 100, 100, 0.6) rgba(0, 0, 0, 0.08);
    }

    .secondary-trend-chart::-webkit-scrollbar {
      height: 10px;
    }

    .secondary-trend-chart::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.08);
      border-radius: 4px;
    }

    .secondary-trend-chart::-webkit-scrollbar-thumb {
      background: rgba(100, 100, 100, 0.6);
      border-radius: 4px;
      min-width: 40px;
    }

    .secondary-trend-chart::-webkit-scrollbar-thumb:hover {
      background: rgba(100, 100, 100, 0.9);
    }

    /* Force scrollbars to always be visible */
    .secondary-trend-chart::-webkit-scrollbar-button {
      display: none;
    }

    .secondary-bar-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      min-width: 40px;
      max-width: 60px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .secondary-bar-wrapper:hover {
      transform: translateY(-2px);
    }

    .secondary-bar-wrapper:hover .secondary-value {
      color: var(--text-primary);
    }

    .secondary-bar {
      width: 100%;
      border-radius: 6px 6px 2px 2px;
      transition: all 0.2s ease;
    }

    .secondary-bar:hover {
      transform: scaleY(1.05);
    }

    .secondary-bar.current {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.4), 0 2px 8px rgba(0, 255, 136, 0.3);
      border: 2px solid var(--text-primary);
    }

    /* Duration bars */
    .secondary-bar.duration {
      background: linear-gradient(180deg, var(--accent-purple) 0%, #7744cc 100%);
      box-shadow: 0 2px 8px rgba(170, 102, 255, 0.2);
    }

    .secondary-bar.duration:hover {
      box-shadow: 0 4px 16px rgba(170, 102, 255, 0.3);
      background: linear-gradient(180deg, #bb88ff 0%, var(--accent-purple) 100%);
    }

    /* Flaky bars */
    .secondary-bar.flaky {
      background: linear-gradient(180deg, var(--accent-yellow) 0%, var(--accent-yellow-dim) 100%);
      box-shadow: 0 2px 8px rgba(255, 204, 0, 0.2);
    }

    .secondary-bar.flaky:hover {
      box-shadow: 0 4px 16px rgba(255, 204, 0, 0.3);
      background: linear-gradient(180deg, #ffdd44 0%, var(--accent-yellow) 100%);
    }

    /* Slow bars */
    .secondary-bar.slow {
      background: linear-gradient(180deg, var(--accent-orange) 0%, #cc6633 100%);
      box-shadow: 0 2px 8px rgba(255, 136, 68, 0.2);
    }

    .secondary-bar.slow:hover {
      box-shadow: 0 4px 16px rgba(255, 136, 68, 0.3);
      background: linear-gradient(180deg, #ffaa66 0%, var(--accent-orange) 100%);
    }

    .secondary-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.6rem;
      color: var(--text-muted);
      margin-top: 4px;
      transition: color 0.2s ease;
    }

    /* Individual Test History Sparkline */
    .history-section {
      display: flex;
      gap: 2rem;
      padding: 1rem;
      background: var(--bg-primary);
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
    }

    .history-column {
      flex: 1;
    }

	    .history-label {
	      font-size: 0.65rem;
	      text-transform: uppercase;
	      letter-spacing: 0.1em;
	      color: var(--text-muted);
	      margin-bottom: 0.5rem;
	    }

	    .sparkline-block {
	      display: inline-flex;
	      flex-direction: column;
	      align-items: flex-start;
	      width: fit-content;
	    }

	    .sparkline {
	      display: flex;
	      gap: 3px;
	      align-items: center;
	      height: 24px;
    }

    .spark-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      transition: transform 0.2s ease;
      position: relative;
    }

    .spark-dot:hover {
      transform: scale(1.4);
    }

    .spark-dot[data-ts]:hover::after {
      content: attr(data-ts);
      position: absolute;
      bottom: 160%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      padding: 0.35rem 0.5rem;
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      white-space: nowrap;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      pointer-events: none;
      z-index: 100000;
    }

    .spark-dot.pass {
      background: var(--accent-green);
      box-shadow: 0 0 6px var(--accent-green);
    }

    .spark-dot.fail {
      background: var(--accent-red);
      box-shadow: 0 0 6px var(--accent-red);
    }

    .spark-dot.skip {
      background: var(--text-muted);
    }

	    .spark-dot.current {
	      width: 10px;
	      height: 10px;
	      border: 2px solid var(--text-primary);
	    }

	    .history-dot {
	      cursor: pointer;
	    }

	    .history-dot.selected {
	      outline: 2px solid rgba(255, 255, 255, 0.85);
	      outline-offset: 2px;
	    }

	    .duration-bar.selected {
	      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.75);
	    }

	    .history-stats.passfail {
	      display: flex;
	      align-items: center;
	      justify-content: space-between;
	      gap: 0.75rem;
	      width: 100%;
	    }

	    .history-back-btn {
	      appearance: none;
	      border: 1px solid var(--border-subtle);
	      background: var(--bg-secondary);
	      color: var(--text-primary);
	      font-size: 0.75rem;
	      font-weight: 600;
	      padding: 0.25rem 0.5rem;
	      border-radius: 8px;
	      cursor: pointer;
	    }

	    .history-back-btn:hover {
	      border-color: var(--border-glow);
	      background: var(--bg-card-hover);
	    }

	    /* Duration Trend Mini Chart */
	    .duration-chart {
	      display: flex;
	      align-items: flex-end;
      gap: 2px;
      height: 32px;
      padding: 4px 0;
    }

    .duration-bar {
      width: 8px;
      min-height: 4px;
      background: var(--accent-blue);
      border-radius: 2px 2px 0 0;
      transition: all 0.2s ease;
    }

    .duration-bar:hover {
      filter: brightness(1.2);
    }

    .duration-bar.current {
      background: var(--accent-purple);
      box-shadow: 0 0 8px var(--accent-purple);
    }

    .duration-bar.slower {
      background: var(--accent-orange);
    }

    .duration-bar.faster {
      background: var(--accent-green);
    }

    .history-stats {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .history-stat {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .history-stat span {
      color: var(--text-secondary);
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
    }

    .filter-btn {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter-btn:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-glow);
      color: var(--text-primary);
    }

    .filter-btn.active {
      background: var(--text-primary);
      color: var(--bg-primary);
      border-color: var(--text-primary);
    }

    /* Stability Score Filters */
    .stability-filters {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: -0.5rem;
    }

    .filter-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-right: 0.5rem;
    }

    .filter-btn.stability-grade {
      min-width: 50px;
    }

    .filter-btn.stability-grade.active {
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.3);
    }

    /* Search Container */
    .search-container {
      margin-bottom: 1rem;
    }

    .search-wrapper {
      position: relative;
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem;
      padding-left: 2.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(0, 170, 255, 0.1);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    /* Test Cards */
    .test-list { display: flex; flex-direction: column; gap: 0.75rem; }

    .test-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.2s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* Allow history tooltips to escape the card when expanded */
    .test-card.expanded {
      overflow: visible;
      position: relative;
      z-index: 1;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .test-card:hover {
      border-color: var(--border-glow);
      background: var(--bg-card-hover);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
    }

    .test-card.keyboard-focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(0, 170, 255, 0.3);
      background: var(--bg-card-hover);
    }

    .test-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      cursor: pointer;
      gap: 1rem;
    }

    .test-card-left {
      display: flex;
      align-items: center;
      gap: 1rem;
      min-width: 0;
      flex: 1;
    }

    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-indicator.passed {
      background: var(--accent-green);
      box-shadow: 0 0 8px rgba(0, 255, 136, 0.4);
    }

    .status-indicator.failed {
      background: var(--accent-red);
      box-shadow: 0 0 8px rgba(255, 68, 102, 0.5);
    }

    .status-indicator.skipped {
      background: var(--text-muted);
      box-shadow: none;
    }

    .test-info { min-width: 0; flex: 1; }

    .test-title {
      font-weight: 600;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .test-file {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .test-title-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .test-meta-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .test-badges-row {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      flex-wrap: wrap;
      margin-top: 0.4rem;
      padding-top: 0.4rem;
      border-top: 1px dashed var(--border-color);
    }

    .badge-separator {
      width: 1px;
      height: 14px;
      background: var(--border-color);
      margin: 0 0.15rem;
      flex-shrink: 0;
    }

    .test-suite-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      color: var(--text-muted);
    }

    .test-tags {
      display: inline-flex;
      gap: 0.3rem;
      flex-wrap: wrap;
    }

    .test-tag {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      background: var(--accent-blue);
      color: white;
      font-weight: 500;
      white-space: nowrap;
    }

    .test-browser-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      background: var(--accent-purple);
      color: white;
      font-weight: 500;
      white-space: nowrap;
    }

    .test-project-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      background: var(--bg-hover);
      border: 1px solid var(--accent-purple);
      color: var(--accent-purple);
      font-weight: 500;
      white-space: nowrap;
    }

    .test-annotation-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      background: var(--bg-hover);
      color: var(--text-secondary);
      font-weight: 500;
      white-space: nowrap;
    }

    .test-annotation-badge.annotation-slow {
      background: #fef3c7;
      color: #92400e;
      border: 1px solid #fcd34d;
    }

    .test-annotation-badge.annotation-fixme,
    .test-annotation-badge.annotation-fix {
      background: #fce7f3;
      color: #9d174d;
      border: 1px solid #f9a8d4;
    }

    .test-annotation-badge.annotation-skip {
      background: #e0e7ff;
      color: #3730a3;
      border: 1px solid #a5b4fc;
    }

    .test-annotation-badge.annotation-issue,
    .test-annotation-badge.annotation-bug {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }

    .test-annotation-badge.annotation-critical {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #f87171;
    }

    .test-annotation-badge.annotation-experimental {
      background: #ecfdf5;
      color: #059669;
      border: 1px solid #6ee7b7;
    }

    .suite-chips .filter-chip,
    .tag-chips .filter-chip {
      background: var(--bg-card);
    }

    .suite-chips .filter-chip.active {
      background: var(--accent-purple);
      color: white;
      border-color: var(--accent-purple);
    }

    .tag-chips .filter-chip.active {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    .test-card-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-shrink: 0;
    }

    .test-duration {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      border: 1px solid;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge.stable {
      color: var(--accent-green);
      border-color: var(--accent-green-dim);
      background: rgba(0, 255, 136, 0.1);
    }

    .badge.unstable {
      color: var(--accent-yellow);
      border-color: var(--accent-yellow-dim);
      background: rgba(255, 204, 0, 0.1);
    }

    .badge.flaky {
      color: var(--accent-red);
      border-color: var(--accent-red-dim);
      background: rgba(255, 68, 102, 0.1);
    }

    .badge.new {
      color: var(--text-muted);
      border-color: var(--border-subtle);
      background: rgba(90, 90, 112, 0.1);
    }

    .badge.skipped {
      color: var(--text-muted);
      border-color: var(--border-subtle);
      background: rgba(90, 90, 112, 0.1);
    }

    .badge.stability-high {
      color: var(--accent-green);
      border-color: var(--accent-green-dim);
      background: rgba(0, 255, 136, 0.1);
      font-weight: 600;
    }

    .badge.stability-medium {
      color: var(--accent-yellow);
      border-color: var(--accent-yellow-dim);
      background: rgba(255, 204, 0, 0.1);
      font-weight: 600;
    }

    .badge.stability-low {
      color: var(--accent-red);
      border-color: var(--accent-red-dim);
      background: rgba(255, 68, 102, 0.1);
      font-weight: 600;
    }

    .trend {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
    }

    .trend.slower { color: var(--accent-orange); }
    .trend.faster { color: var(--accent-green); }
    .trend.stable { color: var(--text-muted); }

    .expand-icon {
      color: var(--text-muted);
      transition: transform 0.2s ease;
      font-size: 0.75rem;
    }

    .test-card.expanded .expand-icon {
      transform: rotate(90deg);
    }

    /* Test Details */
    .test-details {
      display: none;
      padding: 1rem 1.25rem;
      border-top: 1px solid var(--border-subtle);
      background: var(--bg-secondary);
    }

    .test-card.expanded .test-details {
      display: block;
      animation: slideDown 0.2s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .detail-section {
      margin-bottom: 1rem;
    }

    .detail-section:last-child {
      margin-bottom: 0;
    }

    .detail-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .detail-label .icon {
      font-size: 1rem;
    }

    .error-box {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      background: rgba(255, 68, 102, 0.1);
      border: 1px solid var(--accent-red-dim);
      border-radius: 8px;
      padding: 1rem;
      color: var(--accent-red);
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .stack-box {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      padding: 1rem;
      color: var(--text-secondary);
      overflow-x: auto;
      max-height: 200px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .ai-box {
      background: linear-gradient(135deg, rgba(0, 170, 255, 0.1) 0%, rgba(170, 102, 255, 0.1) 100%);
      border: 1px solid var(--accent-blue-dim);
      border-radius: 8px;
      padding: 1rem;
      color: var(--text-primary);
      font-size: 0.9rem;
      position: relative;
    }

    .ai-box::before {
      content: '';
      position: absolute;
      top: -1px;
      left: 20px;
      right: 20px;
      height: 2px;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
      border-radius: 2px;
    }

    /* AI Markdown Rendering */
    .ai-markdown p { margin: 0.5rem 0; }
    .ai-markdown p:first-child { margin-top: 0; }
    .ai-markdown p:last-child { margin-bottom: 0; }

    .ai-markdown .ai-heading {
      margin: 0.75rem 0 0.35rem;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .ai-markdown .ai-h1,
    .ai-markdown .ai-h2 { font-size: 1.05rem; }
    .ai-markdown .ai-h3 { font-size: 1rem; }
    .ai-markdown .ai-h4,
    .ai-markdown .ai-h5,
    .ai-markdown .ai-h6 { font-size: 0.95rem; }

    .ai-markdown .ai-list {
      margin: 0.5rem 0;
      padding-left: 1.25rem;
    }
    .ai-markdown .ai-list li { margin: 0.15rem 0; }

    .ai-markdown .ai-inline-code {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.85em;
      background: rgba(0, 0, 0, 0.25);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      padding: 0.1rem 0.35rem;
      color: var(--text-primary);
      white-space: nowrap;
    }

    .ai-markdown .ai-code-block {
      margin: 0.75rem 0;
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      overflow: hidden;
      background: var(--bg-primary);
      position: relative;
    }

    .ai-markdown .ai-code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.45rem 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
      background: rgba(0, 0, 0, 0.15);
    }

    .ai-markdown .ai-code-lang {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .ai-markdown .copy-btn {
      background: transparent;
      border: 1px solid var(--border-subtle);
      color: var(--text-muted);
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
    }

    .ai-markdown .copy-btn:hover {
      background: var(--border-subtle);
      color: var(--text-primary);
    }

    .ai-markdown .copy-btn.copied {
      background: var(--accent-green);
      border-color: var(--accent-green);
      color: var(--bg-primary);
    }

    .ai-markdown pre {
      margin: 0;
      padding: 0.85rem 0.95rem;
      overflow-x: auto;
    }

    .ai-markdown pre code {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--text-secondary);
      white-space: pre;
      display: block;
    }

    /* Network Logs Section */
    .network-logs-section {
      margin-top: 1rem;
    }

    .network-logs-section .detail-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .network-summary {
      font-size: 0.8rem;
      color: var(--text-muted);
      font-weight: normal;
      margin-left: 0.5rem;
    }

    .network-error-count {
      color: var(--accent-red);
      margin-left: 0.5rem;
    }

    .network-slowest {
      color: var(--accent-orange);
      margin-left: 0.5rem;
    }

    .network-status-summary {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }

    .network-status-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
    }

    .network-status-badge.success { border-color: var(--accent-green); color: var(--accent-green); }
    .network-status-badge.redirect { border-color: var(--accent-orange); color: var(--accent-orange); }
    .network-status-badge.error { border-color: var(--accent-red); color: var(--accent-red); }

    .network-entries {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 350px;
      overflow-y: auto;
      padding: 2px;
    }

    .network-entry {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .network-entry.error {
      border-left: 3px solid var(--accent-red);
    }

    .network-entry-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      cursor: pointer;
      transition: background 0.2s ease;
      min-height: 36px;
      box-sizing: border-box;
    }

    .network-entry-header:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .network-method {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 3px;
      min-width: 45px;
      text-align: center;
      flex-shrink: 0;
    }

    .network-method.get { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .network-method.post { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .network-method.put { background: rgba(249, 115, 22, 0.2); color: #f97316; }
    .network-method.patch { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
    .network-method.delete { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

    .network-url {
      flex: 1;
      min-width: 0;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 12px;
      color: var(--text-secondary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .network-status {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .network-status.success { color: var(--accent-green); }
    .network-status.redirect { color: var(--accent-orange); }
    .network-status.error { color: var(--accent-red); }

    .network-duration {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 11px;
      color: var(--text-muted);
      min-width: 50px;
      text-align: right;
      flex-shrink: 0;
    }

    .network-duration.slow {
      color: var(--accent-orange);
    }

    .network-size {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 10px;
      color: var(--text-muted);
      min-width: 50px;
      text-align: right;
      flex-shrink: 0;
    }

    .network-expand-icon {
      font-size: 10px;
      color: var(--text-muted);
      transition: transform 0.2s ease;
      flex-shrink: 0;
    }

    .network-entry.expanded .network-expand-icon {
      transform: rotate(90deg);
    }

    .network-entry-details {
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid var(--border-subtle);
    }

    .network-timing-bar {
      display: flex;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      background: var(--border-subtle);
      margin-bottom: 12px;
    }

    .timing-segment {
      height: 100%;
      min-width: 2px;
    }

    .network-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
      margin-bottom: 12px;
    }

    .network-meta-item {
      display: flex;
      gap: 6px;
      font-size: 12px;
    }

    .network-meta-item .meta-label {
      color: var(--text-muted);
    }

    .network-meta-item .meta-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      color: var(--text-secondary);
    }

    .network-body {
      margin-top: 8px;
    }

    .network-body-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .network-body-content {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 11px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      padding: 8px;
      margin: 0;
      overflow-x: auto;
      max-height: 150px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .duration-compare {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Step Timings */
    .steps-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .step-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-primary);
      border-radius: 6px;
      border: 1px solid var(--border-subtle);
    }

    .step-row.slowest {
      border-color: var(--accent-orange);
      background: rgba(255, 136, 68, 0.1);
    }

    .step-bar-container {
      flex: 1;
      height: 6px;
      background: var(--border-subtle);
      border-radius: 3px;
      overflow: hidden;
    }

    .step-bar {
      height: 100%;
      background: var(--accent-blue);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .step-row.slowest .step-bar {
      background: var(--accent-orange);
    }

    .step-title {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-secondary);
      min-width: 0;
      flex: 2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .step-row.slowest .step-title {
      color: var(--accent-orange);
    }

    .step-duration {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      min-width: 60px;
      text-align: right;
    }

    .step-row.slowest .step-duration {
      color: var(--accent-orange);
      font-weight: 600;
    }

    .slowest-badge {
      font-size: 0.65rem;
      padding: 0.15rem 0.4rem;
      background: var(--accent-orange);
      color: var(--bg-primary);
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    /* File Groups */
    .file-group {
      margin-bottom: 1rem;
    }

    .file-group-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 0.5rem;
      transition: all 0.2s;
    }

    .file-group-header:hover {
      border-color: var(--border-glow);
    }

    .file-group-header .expand-icon {
      transition: transform 0.2s;
    }

    .file-group.collapsed .file-group-header .expand-icon {
      transform: rotate(-90deg);
    }

    .file-group-name {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.9rem;
      color: var(--text-primary);
      flex: 1;
    }

    .file-group-stats {
      display: flex;
      gap: 0.5rem;
      font-size: 0.75rem;
    }

    .file-group-stat {
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
    }

    .file-group-stat.passed { color: var(--accent-green); background: rgba(0, 255, 136, 0.1); }
    .file-group-stat.failed { color: var(--accent-red); background: rgba(255, 68, 102, 0.1); }

    .file-group-content {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding-left: 1rem;
    }

    .file-group.collapsed .file-group-content {
      display: none;
    }

    /* Screenshot Display */
    .screenshot-box {
      margin-top: 0.5rem;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border-subtle);
    }

    .screenshot-box img {
      width: 100%;
      height: auto;
      display: block;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .screenshot-box img:hover {
      transform: scale(1.02);
    }

    /* Screenshot fallback for CSP-blocked images */
    .screenshot-fallback {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 2rem;
      background: var(--bg-secondary);
      border: 2px dashed var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .download-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--accent-blue);
      color: white;
      border: none;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .download-btn:hover {
      background: #0095e0;
    }

    /* Gallery fallback for CSP-blocked images */
    .gallery-fallback {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      height: 100%;
      min-height: 120px;
      background: var(--bg-secondary);
      border: 2px dashed var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.75rem;
    }

    .download-btn-small {
      padding: 0.3rem 0.6rem;
      background: var(--accent-blue);
      color: white;
      border: none;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.7rem;
      cursor: pointer;
    }

    .download-btn-small:hover {
      background: #0095e0;
    }

    .attachments {
      display: flex;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .trace-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .trace-row {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.75rem;
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      background: var(--bg-primary);
    }

    .trace-meta {
      min-width: 0;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .trace-file {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 0;
    }

    .trace-file-name {
      font-weight: 600;
      color: var(--text-primary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .trace-path {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .trace-actions {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
      padding-top: 0.1rem;
    }

    .trace-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .trace-row {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.75rem;
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      background: var(--bg-primary);
    }

    .trace-meta {
      min-width: 0;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .trace-file {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 0;
    }

    .trace-file-name {
      font-weight: 600;
      color: var(--text-primary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .trace-path {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .trace-actions {
      display: flex;
      gap: 0.5rem;
      flex-shrink: 0;
      padding-top: 0.1rem;
    }

    .attachment-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      color: var(--accent-blue);
      text-decoration: none;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      transition: all 0.2s;
    }

    .attachment-link:hover {
      border-color: var(--accent-blue);
      background: rgba(0, 170, 255, 0.1);
    }

    .export-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .export-btn:hover {
      background: var(--bg-card-hover);
      border-color: var(--accent-blue);
      color: var(--accent-blue);
    }

    /* Gallery Styles */
    .gallery-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
    }

    .gallery-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .gallery-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .gallery-filters {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .gallery-filter-btn {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      border: 1px solid var(--border-subtle);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .gallery-filter-btn:hover {
      border-color: var(--border-glow);
      color: var(--text-primary);
    }

    .gallery-filter-btn.active {
      background: var(--text-primary);
      color: var(--bg-primary);
      border-color: var(--text-primary);
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }

    .gallery-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .gallery-item:hover {
      border-color: var(--border-glow);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .gallery-item-preview {
      position: relative;
      width: 100%;
      height: 150px;
      overflow: hidden;
      background: var(--bg-primary);
    }

    .gallery-item-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-item-preview.video-preview,
    .gallery-item-preview.trace-preview {
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
    }

    .gallery-item-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .gallery-item:hover .gallery-item-overlay {
      opacity: 1;
    }

    .gallery-item-icon {
      font-size: 2rem;
    }

    .gallery-item-info {
      padding: 0.75rem;
    }

    .gallery-item-title {
      font-size: 0.75rem;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 0.25rem;
    }

    .gallery-item-status {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      display: inline-block;
    }

    .gallery-item-status.passed {
      color: var(--accent-green);
      background: rgba(0, 255, 136, 0.1);
    }

    .gallery-item-status.failed {
      color: var(--accent-red);
      background: rgba(255, 68, 102, 0.1);
    }

    .gallery-item-status.skipped {
      color: var(--text-muted);
      background: rgba(90, 90, 112, 0.1);
    }

    .gallery-item-link {
      display: inline-block;
      margin-top: 0.5rem;
      font-size: 0.7rem;
      color: var(--accent-blue);
      text-decoration: none;
    }

    .gallery-item-link:hover {
      text-decoration: underline;
    }

    /* Trace-specific styling */
    .trace-item .gallery-item-preview {
      background: linear-gradient(135deg, #1e3a5f, #0f1922);
    }

    .trace-icon-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .trace-file-icon {
      font-size: 2.5rem;
      filter: grayscale(0.3);
    }

    .trace-file-type {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--accent-blue);
      background: rgba(59, 130, 246, 0.1);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .gallery-trace-download {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--text-primary);
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.05));
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 6px;
      text-decoration: none;
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .gallery-trace-download:hover {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.25), rgba(59, 130, 246, 0.15));
      border-color: rgba(59, 130, 246, 0.5);
      transform: translateY(-1px);
    }

    .download-icon {
      font-size: 1rem;
      display: flex;
      align-items: center;
    }

    /* Lightbox */
    .lightbox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    .lightbox-close {
      position: absolute;
      top: 2rem;
      right: 2rem;
      font-size: 3rem;
      color: var(--text-primary);
      cursor: pointer;
      line-height: 1;
    }

    .lightbox-content {
      max-width: 90%;
      max-height: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .lightbox-img {
      max-width: 100%;
      max-height: 70vh;
      object-fit: contain;
      border-radius: 8px;
    }

    .lightbox-info {
      text-align: center;
    }

    .lightbox-test-title {
      font-size: 1.25rem;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .lightbox-status {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.875rem;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      display: inline-block;
    }

    .lightbox-nav {
      display: flex;
      gap: 1rem;
    }

    .lightbox-prev,
    .lightbox-next {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      color: var(--text-primary);
      font-size: 1.5rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .lightbox-prev:hover,
    .lightbox-next:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-glow);
    }

    /* Comparison Styles */
    .comparison-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
    }

    .comparison-header {
      margin-bottom: 1.5rem;
    }

    .comparison-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .comparison-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
    }

    .comparison-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .comparison-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .comparison-card-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .comparison-card-value {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .comparison-card-value.positive {
      color: var(--accent-green);
    }

    .comparison-card-value.negative {
      color: var(--accent-red);
    }

    .comparison-delta {
      display: block;
      font-size: 0.75rem;
      margin-top: 0.25rem;
      font-weight: 400;
    }

    .comparison-delta.neutral {
      color: var(--text-muted);
    }

    .comparison-details {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .comparison-section-wrapper {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      overflow: hidden;
    }

    .comparison-section-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .comparison-section-header:hover {
      background: var(--bg-card-hover);
    }

    .comparison-section-header.failure-section {
      border-left: 3px solid var(--accent-red);
    }

    .comparison-section-header.fixed-section {
      border-left: 3px solid var(--accent-green);
    }

    .comparison-section-header.regression-section {
      border-left: 3px solid var(--accent-orange);
    }

    .comparison-section-header.improvement-section {
      border-left: 3px solid var(--accent-blue);
    }

    .comparison-section-header.new-section {
      border-left: 3px solid var(--accent-purple);
    }

    .comparison-section-title {
      flex: 1;
      font-weight: 600;
      color: var(--text-primary);
    }

    .comparison-section-count {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      padding: 0.2rem 0.6rem;
      background: var(--bg-primary);
      border-radius: 4px;
      color: var(--text-secondary);
    }

    .comparison-section-content {
      padding: 0.5rem;
      border-top: 1px solid var(--border-subtle);
    }

    .comparison-item {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .comparison-item:last-child {
      margin-bottom: 0;
    }

    .comparison-item-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .comparison-item-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .comparison-item-status.passed {
      background: var(--accent-green);
    }

    .comparison-item-status.failed {
      background: var(--accent-red);
    }

    .comparison-item-status.skipped {
      background: var(--text-muted);
    }

    .comparison-item-info {
      flex: 1;
      min-width: 0;
    }

    .comparison-item-title {
      font-size: 0.875rem;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .comparison-item-file {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .comparison-item-duration-badge {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      background: var(--bg-secondary);
      border-radius: 4px;
      color: var(--text-secondary);
    }

    .comparison-item-details {
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
    }

    .comparison-item-duration {
      color: var(--text-muted);
    }

    .comparison-item-change {
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-weight: 600;
    }

    .comparison-item-change.positive {
      color: var(--accent-green);
      background: rgba(0, 255, 136, 0.1);
    }

    .comparison-item-change.negative {
      color: var(--accent-orange);
      background: rgba(255, 136, 68, 0.1);
    }

    .comparison-item-error {
      margin-top: 0.5rem;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      color: var(--accent-red);
      background: rgba(255, 68, 102, 0.1);
      padding: 0.5rem;
      border-radius: 4px;
      border: 1px solid var(--accent-red-dim);
    }

    /* ============================================
       TOAST NOTIFICATIONS
    ============================================ */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }

    .toast {
      background: var(--bg-card);
      border: 1px solid var(--border-glow);
      border-radius: 8px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transform: translateX(120%);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      pointer-events: auto;
      max-width: 320px;
    }

    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    .toast-icon {
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .toast-message {
      font-size: 0.85rem;
      color: var(--text-primary);
    }

    .toast.success { border-color: var(--accent-green); }
    .toast.success .toast-icon { color: var(--accent-green); }
    .toast.error { border-color: var(--accent-red); }
    .toast.error .toast-icon { color: var(--accent-red); }
    .toast.info { border-color: var(--accent-blue); }
    .toast.info .toast-icon { color: var(--accent-blue); }

    /* ============================================
       THEME DROPDOWN
    ============================================ */
    .theme-dropdown {
      position: relative;
      display: inline-block;
    }

    .theme-toggle {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 0.85rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .theme-toggle:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-glow);
      color: var(--text-primary);
    }

    .theme-toggle-icon { font-size: 1rem; }
    .theme-label { font-size: 0.8rem; }

    .theme-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 4px;
      background: var(--bg-card);
      border: 1px solid var(--border-glow);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      min-width: 120px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all 0.2s ease;
    }

    .theme-dropdown.open .theme-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .theme-menu-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 0.85rem;
    }

    .theme-menu-item:first-child { border-radius: 8px 8px 0 0; }
    .theme-menu-item:last-child { border-radius: 0 0 8px 8px; }

    .theme-menu-item:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
    }

    .theme-menu-item.active {
      background: var(--bg-card-hover);
      color: var(--accent-blue);
    }

    .theme-menu-item.active::after {
      content: '';
      margin-left: auto;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .theme-label { display: none; }
    }

    /* ============================================
       ACCESSIBILITY - FOCUS INDICATORS
    ============================================ */
    *:focus-visible {
      outline: 2px solid var(--accent-blue);
      outline-offset: 2px;
    }

    button:focus-visible,
    .filter-chip:focus-visible,
    .nav-item:focus-visible,
    .test-card:focus-visible,
    .gallery-item:focus-visible {
      outline: 2px solid var(--accent-blue);
      outline-offset: 2px;
      box-shadow: 0 0 0 4px rgba(0, 170, 255, 0.2);
    }

    /* Skip to main content link for screen readers */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--accent-blue);
      color: white;
      padding: 8px 16px;
      z-index: 10001;
      text-decoration: none;
      font-weight: 600;
      border-radius: 0 0 8px 0;
      transition: top 0.3s ease;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Visually hidden but accessible to screen readers */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* ============================================
       EMPTY STATE UI
    ============================================ */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem 2rem;
      text-align: center;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .empty-state-message {
      font-size: 0.9rem;
      max-width: 300px;
      line-height: 1.5;
    }

    .empty-state-action {
      margin-top: 1rem;
      padding: 8px 16px;
      background: var(--accent-blue);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      transition: background 0.2s ease;
    }

    .empty-state-action:hover {
      background: var(--accent-blue-dim);
    }

    /* ============================================
       MOBILE RESPONSIVE - PERSISTENT SIDEBAR
    ============================================ */
    @media (max-width: 768px) {
      :root {
        --sidebar-width: 200px;
      }

      .app-shell {
        grid-template-columns: var(--sidebar-width) 1fr;
      }

      .app-shell.sidebar-collapsed {
        grid-template-columns: 0 1fr;
      }

      .app-shell.sidebar-collapsed .sidebar {
        transform: translateX(-100%);
      }

      .sidebar {
        width: var(--sidebar-width);
      }

      /* Hide overlay on mobile - sidebar is persistent */
      .sidebar-overlay {
        display: none;
      }

      .top-bar-left .breadcrumbs {
        display: none;
      }

      .search-label, .btn-label, .search-kbd {
        display: none;
      }

      .filter-chips {
        flex-wrap: wrap;
      }

      /* Compact sidebar elements */
      .sidebar-progress {
        padding: 0.75rem;
      }

      .progress-ring-container {
        width: 60px;
        height: 60px;
      }

      .progress-ring {
        width: 60px;
        height: 60px;
      }

      .progress-ring circle {
        cx: 30;
        cy: 30;
        r: 25;
      }

      .progress-ring-value {
        font-size: 0.9rem;
      }

      .nav-item {
        padding: 0.5rem 0.6rem;
        font-size: 0.8rem;
      }

      .nav-icon {
        font-size: 0.9rem;
      }

      .mini-stat {
        padding: 0.4rem;
      }

      .mini-stat-value {
        font-size: 0.85rem;
      }

      .mini-stat-label {
        font-size: 0.55rem;
      }
    }

    /* ============================================
       SMOOTH TRANSITIONS
    ============================================ */
    .test-card,
    .gallery-item,
    .nav-item,
    .filter-chip,
    .sidebar,
    .main-panel {
      transition: all 0.2s ease;
    }

    .view-panel {
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .test-card-details {
      animation: slideDown 0.2s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; max-height: 0; }
      to { opacity: 1; max-height: 2000px; }
    }

    /* ============================================
       PRINT STYLESHEET
    ============================================ */
    @media print {
      body {
        background: white;
        color: black;
        overflow: visible;
        height: auto;
      }

      .app-shell {
        display: block;
      }

      .sidebar,
      .top-bar,
      .filter-chips,
      .search-trigger,
      .theme-toggle,
      .toast-container,
      .lightbox {
        display: none !important;
      }

      .main-panel {
        padding: 0;
        overflow: visible;
        height: auto;
      }

      .test-card {
        break-inside: avoid;
        page-break-inside: avoid;
        border: 1px solid #ccc;
        margin-bottom: 1rem;
      }

      .test-card-details {
        display: block !important;
        max-height: none !important;
      }

      .view-panel {
        display: block !important;
      }

      a {
        text-decoration: underline;
      }

      .progress-ring,
      .trend-section,
      .gallery-section {
        break-inside: avoid;
        page-break-inside: avoid;
      }
    }

    /* ============================================
       CSV EXPORT BUTTON
    ============================================ */
    .export-dropdown {
      position: relative;
      display: inline-block;
    }

    .export-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 4px;
      background: var(--bg-card);
      border: 1px solid var(--border-glow);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      min-width: 140px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all 0.2s ease;
    }

    .export-dropdown.open .export-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .export-menu-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 0.85rem;
    }

    .export-menu-item:first-child {
      border-radius: 8px 8px 0 0;
    }

    .export-menu-item:last-child {
      border-radius: 0 0 8px 8px;
    }

    .export-menu-item:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
    }

    /* ============================================
       CI INFO BAR
    ============================================ */
    .ci-info-bar {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 6px 20px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-subtle);
      font-size: 0.75rem;
      color: var(--text-secondary);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
    }
    .ci-provider {
      background: var(--accent-blue);
      color: #fff;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.65rem;
      letter-spacing: 0.5px;
    }
    .ci-item { display: flex; align-items: center; gap: 4px; }
    .ci-label { color: var(--text-muted); }
    .ci-info-bar code {
      background: var(--bg-card);
      padding: 1px 6px;
      border-radius: 3px;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
    }

    /* ============================================
       STEP TIMELINE / FLAMECHART
    ============================================ */
    .step-timeline {
      position: relative;
      width: 100%;
      height: 40px;
      background: var(--bg-secondary);
      border-radius: 6px;
      overflow: hidden;
      margin: 8px 0;
      cursor: default;
    }
    .step-timeline-bar {
      position: absolute;
      top: 0;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      color: var(--text-primary);
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      padding: 0 4px;
      transition: opacity 0.15s;
      cursor: pointer;
      border-right: 1px solid var(--bg-primary);
    }
    .step-timeline-bar:hover {
      opacity: 0.85;
      z-index: 1;
      outline: 2px solid var(--text-primary);
    }
    .step-timeline-bar.cat-navigation { background: #3b82f6; }
    .step-timeline-bar.cat-assertion { background: #22c55e; }
    .step-timeline-bar.cat-action { background: #a855f7; }
    .step-timeline-bar.cat-api { background: #f59e0b; }
    .step-timeline-bar.cat-wait { background: #6b7280; }
    .step-timeline-bar.cat-other { background: #64748b; }
    .step-timeline-legend {
      display: flex;
      gap: 12px;
      margin-top: 4px;
      font-size: 0.65rem;
      color: var(--text-muted);
      flex-wrap: wrap;
    }
    .step-timeline-legend-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .step-timeline-legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 2px;
    }

    /* ============================================
       ENHANCED TREND CHARTS
    ============================================ */
    .trend-moving-avg {
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .chart-anomaly-marker {
      stroke: var(--accent-red);
      stroke-width: 2;
      fill: none;
    }
    .chart-bar-anomaly {
      stroke: var(--accent-red) !important;
      stroke-width: 2 !important;
      stroke-dasharray: 4 2;
    }
    .trend-avg-label {
      font-size: 9px;
      fill: var(--accent-yellow);
      font-style: italic;
    }

    /* ============================================
       FAILURE DIFF VIEW
    ============================================ */
    .diff-container {
      background: var(--bg-secondary);
      border-radius: 8px;
      overflow: hidden;
      margin: 8px 0;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      border: 1px solid var(--border-subtle);
    }
    .diff-header {
      display: flex;
      gap: 8px;
      padding: 8px 12px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-subtle);
      font-size: 0.7rem;
      color: var(--text-muted);
    }
    .diff-line {
      padding: 2px 12px;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .diff-line.diff-expected {
      background: rgba(255, 68, 102, 0.1);
      color: var(--accent-red);
    }
    .diff-line.diff-expected::before {
      content: "- ";
      opacity: 0.5;
    }
    .diff-line.diff-actual {
      background: rgba(0, 255, 136, 0.1);
      color: var(--accent-green);
    }
    .diff-line.diff-actual::before {
      content: "+ ";
      opacity: 0.5;
    }
    .diff-line.diff-same {
      color: var(--text-muted);
    }
    .diff-line.diff-same::before {
      content: "  ";
      opacity: 0.5;
    }

    /* ============================================
       KEYBOARD SHORTCUTS
    ============================================ */
    .keyboard-hints {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 16px 20px;
      font-size: 0.75rem;
      color: var(--text-secondary);
      z-index: 1000;
      display: none;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      max-width: 320px;
    }
    .keyboard-hints.visible { display: block; }
    .keyboard-hints h4 {
      margin: 0 0 8px;
      color: var(--text-primary);
      font-size: 0.8rem;
    }
    .keyboard-hint-row {
      display: flex;
      justify-content: space-between;
      padding: 3px 0;
    }
    .keyboard-hint-row kbd {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      padding: 1px 6px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      min-width: 24px;
      text-align: center;
    }

    /* ============================================
       VIRTUAL SCROLLING
    ============================================ */
    .virtual-scroll-container {
      height: calc(100vh - 200px);
      overflow-y: auto;
      position: relative;
    }
    .virtual-scroll-spacer {
      width: 100%;
    }
    .virtual-scroll-viewport {
      position: absolute;
      width: 100%;
    }
    .test-list-item-count {
      padding: 8px 16px;
      font-size: 0.75rem;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border-subtle);
    }

    /* ============================================
       EXPORTABLE SUMMARY CARD
    ============================================ */
    .summary-export-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .summary-export-modal.visible { display: flex; }
    .summary-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 32px;
      max-width: 480px;
      width: 100%;
      text-align: center;
      box-shadow: 0 16px 64px rgba(0,0,0,0.4);
    }
    .summary-card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    .summary-card-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 20px;
    }
    .summary-card-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    .summary-stat {
      text-align: center;
    }
    .summary-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
    }
    .summary-stat-value.passed { color: var(--accent-green); }
    .summary-stat-value.failed { color: var(--accent-red); }
    .summary-stat-value.rate { color: var(--accent-blue); }
    .summary-stat-label {
      font-size: 0.65rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .summary-card-bar {
      height: 8px;
      background: var(--bg-secondary);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    .summary-card-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s;
    }
    .summary-card-footer {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 16px;
    }
    .summary-card-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: var(--bg-secondary);
      color: var(--text-primary);
      cursor: pointer;
      font-size: 0.8rem;
      font-family: 'Space Grotesk', system-ui, sans-serif;
    }
    .summary-card-btn:hover { background: var(--bg-card-hover); }
    .summary-card-btn.primary {
      background: var(--accent-blue);
      color: #fff;
      border-color: var(--accent-blue);
    }

    /* Issue #13: Inline Trace Viewer Styles */
    
    /* Trace Viewer Modal */
    .trace-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .trace-modal.fullscreen {
      padding: 0;
    }

    .trace-modal.fullscreen .trace-modal-content {
      width: 100%;
      height: 100%;
      max-width: none;
      border-radius: 0;
    }

    .trace-modal-content {
      background: var(--bg-primary);
      border-radius: 12px;
      width: 95%;
      height: 92%;
      max-width: 1600px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }

    .trace-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-subtle);
    }

    .trace-modal-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .trace-modal-icon {
      font-size: 1.2rem;
    }

    .trace-header-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .trace-modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-muted);
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      line-height: 1;
      transition: color 0.2s;
      border-radius: 4px;
    }

    .trace-modal-close:hover {
      color: var(--accent-red);
      background: rgba(255, 100, 100, 0.1);
    }

    .trace-modal-body {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    /* Loading State */
    .trace-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      gap: 1rem;
      color: var(--text-muted);
    }

    .trace-loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-subtle);
      border-top-color: var(--accent-blue);
      border-radius: 50%;
      animation: trace-spin 1s linear infinite;
    }

    @keyframes trace-spin {
      to { transform: rotate(360deg); }
    }

    /* Error State */
    .trace-error {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      gap: 1rem;
      padding: 2rem;
      text-align: center;
    }

    .trace-error-icon {
      font-size: 3rem;
    }

    .trace-error p {
      color: var(--text-secondary);
      margin: 0;
    }

    .trace-error-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .trace-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1.2rem;
      background: var(--accent-blue);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .trace-btn:hover {
      background: var(--accent-blue-hover, #0095e0);
      transform: translateY(-1px);
    }

    .trace-btn-small {
      padding: 0.35rem 0.6rem;
      font-size: 0.8rem;
    }

    .trace-btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
    }

    .trace-btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--accent-blue);
    }

    /* Timeline Filmstrip */
    .trace-timeline {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-subtle);
      padding: 0.5rem;
      height: 72px;
      overflow: hidden;
    }

    .trace-timeline-scroll {
      display: flex;
      gap: 4px;
      overflow-x: auto;
      height: 100%;
      align-items: center;
      padding: 0 0.5rem;
      scroll-behavior: smooth;
    }

    .trace-timeline-scroll::-webkit-scrollbar {
      height: 6px;
    }

    .trace-timeline-scroll::-webkit-scrollbar-thumb {
      background: var(--border-subtle);
      border-radius: 3px;
    }

    .trace-timeline-thumb {
      flex-shrink: 0;
      width: 80px;
      height: 56px;
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.2s ease;
      position: relative;
      background: #1a1a2e;
      opacity: 0.6;
    }

    .trace-timeline-thumb:hover {
      border-color: var(--accent-blue);
      transform: scale(1.08);
      opacity: 0.9;
    }

    .trace-timeline-thumb.active {
      border-color: #00d4ff;
      box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.4), 0 0 20px rgba(0, 212, 255, 0.3);
      transform: scale(1.1);
      opacity: 1;
      z-index: 10;
    }

    .trace-timeline-thumb.active::before {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      border: 2px solid #00d4ff;
      border-radius: 6px;
      animation: timeline-pulse 1.5s ease-in-out infinite;
    }

    @keyframes timeline-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .trace-timeline-thumb.has-error {
      border-color: var(--accent-red);
    }

    .trace-timeline-thumb.has-error.active {
      border-color: var(--accent-red);
      box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.4), 0 0 20px rgba(255, 107, 107, 0.3);
    }

    .trace-timeline-thumb.has-error::after {
      content: '';
      position: absolute;
      top: 2px;
      right: 4px;
      color: var(--accent-red);
      font-size: 0.7rem;
      text-shadow: 0 0 4px var(--accent-red);
    }

    .trace-timeline-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .trace-timeline-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      font-size: 0.6rem;
    }

    /* Timeline Slider */
    .trace-timeline-slider-track {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--border-subtle);
      cursor: pointer;
    }

    .trace-timeline-slider-progress {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      background: var(--accent-blue);
      pointer-events: none;
      width: 0%;
    }

    .trace-timeline-slider-thumb {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 12px;
      height: 12px;
      background: var(--accent-blue);
      border: 2px solid white;
      border-radius: 50%;
      cursor: grab;
      z-index: 2;
      left: 0%;
    }

    .trace-timeline-slider-thumb:active {
      cursor: grabbing;
      transform: translate(-50%, -50%) scale(1.2);
    }

    /* Timeline Magnifier */
    .trace-timeline-magnifier {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      padding: 4px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 100;
      pointer-events: none;
    }

    .trace-timeline-magnifier img {
      width: 200px;
      height: 140px;
      object-fit: contain;
      border-radius: 4px;
    }

    .trace-magnifier-time {
      text-align: center;
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Click Position Indicator */
    .trace-click-indicator {
      position: absolute;
      pointer-events: none;
      z-index: 10;
    }

    .trace-click-dot {
      width: 12px;
      height: 12px;
      background: rgba(255, 0, 0, 0.8);
      border: 2px solid white;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .trace-click-ripple {
      width: 30px;
      height: 30px;
      border: 2px solid rgba(255, 0, 0, 0.5);
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: trace-click-ripple 1.5s ease-out infinite;
    }

    @keyframes trace-click-ripple {
      0% {
        width: 12px;
        height: 12px;
        opacity: 1;
      }
      100% {
        width: 40px;
        height: 40px;
        opacity: 0;
      }
    }

    /* Trace Content Layout */
    .trace-content {
      height: 100%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .trace-layout {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* Actions Panel */
    .trace-actions-panel {
      width: 280px;
      min-width: 200px;
      max-width: 400px;
      border-right: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      background: var(--bg-secondary);
    }

    .trace-actions-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-subtle);
    }

    .trace-count {
      background: var(--bg-primary);
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      font-size: 0.7rem;
    }

    /* Action Search */
    .trace-search-wrapper {
      position: relative;
      padding: 0.5rem;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-subtle);
    }

    .trace-search-input {
      width: 100%;
      padding: 0.5rem 2rem 0.5rem 0.75rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.8rem;
      outline: none;
    }

    .trace-search-input:focus {
      border-color: var(--accent-blue);
    }

    .trace-search-clear {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1rem;
      padding: 0.25rem;
    }

    .trace-search-clear:hover {
      color: var(--text-primary);
    }

    .trace-actions-list {
      flex: 1;
      overflow-y: auto;
      padding: 0.5rem;
    }

    .trace-action-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.6rem 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
      margin-bottom: 0.25rem;
    }

    .trace-action-item:hover {
      background: var(--bg-card-hover);
    }

    .trace-action-item.active {
      background: var(--accent-blue);
      color: white;
    }

    .trace-action-item.active .trace-action-time,
    .trace-action-item.active .trace-action-selector {
      color: rgba(255, 255, 255, 0.8);
    }

    .trace-action-item.has-error {
      border-left: 3px solid var(--accent-red);
    }

    .trace-action-item.filtered-out {
      display: none;
    }

    .trace-action-icon {
      font-size: 1rem;
      flex-shrink: 0;
      width: 24px;
      text-align: center;
    }

    .trace-action-info {
      flex: 1;
      min-width: 0;
    }

    .trace-action-name {
      font-size: 0.8rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .trace-action-name mark {
      background: rgba(255, 200, 50, 0.4);
      color: inherit;
      padding: 0 2px;
      border-radius: 2px;
    }

    .trace-action-selector {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.7rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 0.15rem;
    }

    .trace-action-time {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.65rem;
      color: var(--text-muted);
      flex-shrink: 0;
    }

    .trace-action-duration-bar {
      height: 3px;
      background: var(--accent-blue);
      border-radius: 2px;
      margin-top: 4px;
      opacity: 0.5;
    }

    .trace-action-item.active .trace-action-duration-bar {
      background: rgba(255, 255, 255, 0.5);
    }

    /* Resizer */
    .trace-resizer {
      width: 4px;
      background: var(--border-subtle);
      cursor: col-resize;
      transition: background 0.2s;
    }

    .trace-resizer:hover,
    .trace-resizer.active {
      background: var(--accent-blue);
    }

    /* Main Panel */
    .trace-main-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-width: 0;
    }

    /* Screenshot Panel */
    .trace-screenshot-panel {
      flex: 0 0 45%;
      min-height: 150px;
      max-height: 50%;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .trace-snapshot-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(0, 0, 0, 0.5);
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
    }

    .trace-snapshot-btn {
      padding: 0.35rem 0.75rem;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.15s;
    }

    .trace-snapshot-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .trace-snapshot-btn.active {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    .trace-snapshot-hint {
      margin-left: auto;
      font-size: 0.65rem;
      color: rgba(255, 255, 255, 0.4);
    }

    .trace-screenshot-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      padding: 1rem;
    }

    .trace-screenshot {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 4px;
    }

    .trace-screenshot.before-snapshot {
      border: 2px solid #f0ad4e;
    }

    .trace-screenshot.after-snapshot {
      border: 2px solid #5cb85c;
    }

    .trace-no-screenshot {
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    /* Details Panel */
    .trace-details-panel {
      flex: 1;
      min-height: 200px;
      border-top: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: var(--bg-primary);
    }

    .trace-tabs {
      display: flex;
      gap: 0;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-subtle);
      padding: 0 0.5rem;
      flex-wrap: wrap;
    }

    .trace-tab {
      padding: 0.6rem 1rem;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-muted);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .trace-tab:hover {
      color: var(--text-primary);
    }

    .trace-tab.active {
      color: var(--accent-blue);
      border-bottom-color: var(--accent-blue);
    }

    .trace-tab-badge {
      background: var(--accent-blue);
      color: white;
      font-size: 0.65rem;
      padding: 0.1rem 0.4rem;
      border-radius: 8px;
      min-width: 18px;
      text-align: center;
    }

    .trace-tab-badge-error {
      background: var(--accent-red);
    }

    .trace-tab-content {
      flex: 1;
      overflow: hidden;
    }

    .trace-tab-pane {
      display: none;
      height: 100%;
      overflow-y: auto;
      padding: 1rem;
    }

    .trace-tab-pane.active {
      display: block;
    }

    /* Details Content */
    .trace-detail-row {
      display: flex;
      gap: 1rem;
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--border-subtle);
      font-size: 0.8rem;
    }

    .trace-detail-row:last-child {
      border-bottom: none;
    }

    .trace-detail-label {
      color: var(--text-muted);
      width: 100px;
      flex-shrink: 0;
    }

    .trace-detail-value {
      color: var(--text-primary);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      word-break: break-all;
    }

    /* Console Tab */
    .trace-console-controls {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }

    .trace-console-filter {
      padding: 0.3rem 0.6rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      color: var(--text-muted);
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.15s;
    }

    .trace-console-filter:hover {
      border-color: var(--accent-blue);
    }

    .trace-console-filter.active {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    .trace-console-item {
      display: flex;
      gap: 0.75rem;
      padding: 0.5rem;
      font-size: 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
      border-radius: 4px;
      margin-bottom: 0.25rem;
    }

    .trace-console-item.log {
      background: transparent;
    }

    .trace-console-item.info {
      background: rgba(0, 169, 255, 0.05);
      border-left: 3px solid var(--accent-blue);
    }

    .trace-console-item.warning {
      background: rgba(255, 193, 7, 0.1);
      border-left: 3px solid #ffc107;
    }

    .trace-console-item.error {
      background: rgba(255, 100, 100, 0.1);
      border-left: 3px solid var(--accent-red);
    }

    .trace-console-item.debug {
      opacity: 0.6;
    }

    .trace-console-item.filtered-out {
      display: none;
    }

    .trace-console-icon {
      flex-shrink: 0;
      width: 16px;
      text-align: center;
    }

    .trace-console-time {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      color: var(--text-muted);
      flex-shrink: 0;
      min-width: 50px;
    }

    .trace-console-message {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      color: var(--text-primary);
      word-break: break-word;
      flex: 1;
    }

    .trace-console-location {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      color: var(--text-muted);
      font-size: 0.65rem;
      flex-shrink: 0;
    }

    /* Source Tab */
    .trace-source-section {
      margin-bottom: 1.5rem;
    }

    .trace-source-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .trace-source-location {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--text-primary);
      padding: 0.75rem;
      background: var(--bg-card);
      border-radius: 6px;
      border-left: 3px solid var(--accent-blue);
    }

    .trace-stack-frame {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      padding: 0.4rem 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
      color: var(--text-secondary);
    }

    .trace-stack-frame:last-child {
      border-bottom: none;
    }

    .trace-stack-frame.user-code {
      color: var(--text-primary);
      background: var(--bg-card);
    }

    .trace-stack-file {
      color: var(--accent-blue);
    }

    .trace-stack-line {
      color: var(--accent-green);
    }

    /* Network Tab */
    .trace-network-controls {
      margin-bottom: 0.75rem;
    }

    .trace-network-search {
      width: 100%;
      padding: 0.5rem 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.8rem;
      outline: none;
      margin-bottom: 0.5rem;
    }

    .trace-network-search:focus {
      border-color: var(--accent-blue);
    }

    .trace-network-filters {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
    }

    .trace-network-filter {
      padding: 0.25rem 0.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      color: var(--text-muted);
      font-size: 0.65rem;
      cursor: pointer;
      transition: all 0.15s;
    }

    .trace-network-filter:hover {
      border-color: var(--accent-blue);
    }

    .trace-network-filter.active {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    .trace-network-list {
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      overflow: hidden;
    }

    .trace-network-header {
      display: grid;
      grid-template-columns: 60px 1fr 200px 50px 60px;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-card);
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      border-bottom: 1px solid var(--border-subtle);
    }

    .trace-network-header-cell {
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .trace-network-header-cell:hover {
      color: var(--text-primary);
    }

    .trace-network-header-cell.sorted {
      color: var(--accent-blue);
    }

    .trace-network-sort-icon {
      font-size: 0.5rem;
      opacity: 0.5;
    }

    .trace-network-header-cell.sorted .trace-network-sort-icon {
      opacity: 1;
    }

    .trace-network-item {
      display: grid;
      grid-template-columns: 60px 1fr 200px 50px 60px;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      border-bottom: 1px solid var(--border-subtle);
      align-items: center;
      cursor: pointer;
      transition: background 0.15s;
    }

    .trace-network-item:hover {
      background: var(--bg-card-hover);
    }

    .trace-network-item:last-child {
      border-bottom: none;
    }

    .trace-network-item.filtered-out {
      display: none;
    }

    .trace-network-item.expanded {
      background: var(--bg-card);
    }

    .trace-network-method {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-weight: 600;
      color: var(--accent-blue);
    }

    .trace-network-method.post { color: #4caf50; }
    .trace-network-method.put { color: #ff9800; }
    .trace-network-method.delete { color: #f44336; }
    .trace-network-method.patch { color: #9c27b0; }

    .trace-network-url {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .trace-network-waterfall {
      height: 16px;
      display: flex;
      align-items: center;
      position: relative;
    }

    .trace-waterfall-bar {
      height: 8px;
      border-radius: 2px;
      position: absolute;
      min-width: 2px;
    }

    .trace-waterfall-dns { background: #8bc34a; }
    .trace-waterfall-connect { background: #ff9800; }
    .trace-waterfall-ssl { background: #9c27b0; }
    .trace-waterfall-wait { background: #2196f3; }
    .trace-waterfall-receive { background: #00bcd4; }

    .trace-network-status {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      text-align: center;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-size: 0.7rem;
    }

    .trace-network-status.success {
      background: rgba(0, 200, 100, 0.2);
      color: var(--accent-green);
    }

    .trace-network-status.redirect {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
    }

    .trace-network-status.error {
      background: rgba(255, 100, 100, 0.2);
      color: var(--accent-red);
    }

    .trace-network-time {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      color: var(--text-muted);
      text-align: right;
    }

    /* Network Details (expanded) */
    .trace-network-details {
      grid-column: 1 / -1;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-subtle);
      display: none;
    }

    .trace-network-item.expanded .trace-network-details {
      display: block;
    }

    .trace-network-details-section {
      margin-bottom: 1rem;
    }

    .trace-network-details-section:last-child {
      margin-bottom: 0;
    }

    .trace-network-details-title {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 0.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .trace-network-details-title::before {
      content: '';
      font-size: 0.5rem;
      transition: transform 0.15s;
    }

    .trace-network-details-section.expanded .trace-network-details-title::before {
      transform: rotate(90deg);
    }

    .trace-network-details-content {
      display: none;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.75rem;
      background: var(--bg-primary);
      border-radius: 4px;
      padding: 0.5rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .trace-network-details-section.expanded .trace-network-details-content {
      display: block;
    }

    .trace-header-row {
      display: flex;
      padding: 0.2rem 0;
      border-bottom: 1px solid var(--border-subtle);
    }

    .trace-header-row:last-child {
      border-bottom: none;
    }

    .trace-header-name {
      color: var(--accent-blue);
      min-width: 180px;
      flex-shrink: 0;
    }

    .trace-header-value {
      color: var(--text-primary);
      word-break: break-all;
    }

    .trace-request-body {
      white-space: pre-wrap;
      word-break: break-all;
      color: var(--text-primary);
    }

    /* Metadata Tab */
    .trace-metadata-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }

    .trace-metadata-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      padding: 1rem;
    }

    .trace-metadata-card-title {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .trace-metadata-row {
      display: flex;
      justify-content: space-between;
      padding: 0.35rem 0;
      border-bottom: 1px solid var(--border-subtle);
      font-size: 0.8rem;
    }

    .trace-metadata-row:last-child {
      border-bottom: none;
    }

    .trace-metadata-label {
      color: var(--text-muted);
    }

    .trace-metadata-value {
      color: var(--text-primary);
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      text-align: right;
    }

    /* Errors Tab */
    .trace-error-item {
      background: rgba(255, 100, 100, 0.1);
      border: 1px solid rgba(255, 100, 100, 0.3);
      border-radius: 6px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .trace-error-action {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .trace-error-name {
      font-weight: 600;
      color: var(--accent-red);
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }

    .trace-error-message {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--text-primary);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .trace-empty {
      color: var(--text-muted);
      font-size: 0.85rem;
      text-align: center;
      padding: 2rem;
    }

    /* Waterfall legend */
    .trace-waterfall-legend {
      display: flex;
      gap: 1rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-card);
      border-top: 1px solid var(--border-subtle);
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .trace-waterfall-legend-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .trace-waterfall-legend-color {
      width: 12px;
      height: 8px;
      border-radius: 2px;
    }

    /* Attachments Tab */
    .trace-attachments-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }

    .trace-attachment-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.15s;
    }

    .trace-attachment-card:hover {
      border-color: var(--accent-blue);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .trace-attachment-preview {
      height: 120px;
      background: #1a1a2e;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .trace-attachment-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .trace-attachment-preview-icon {
      font-size: 2.5rem;
      opacity: 0.5;
    }

    .trace-attachment-info {
      padding: 0.75rem;
    }

    .trace-attachment-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 0.25rem;
    }

    .trace-attachment-meta {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .trace-attachment-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .trace-attachment-btn {
      flex: 1;
      padding: 0.35rem 0.5rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      color: var(--text-secondary);
      font-size: 0.7rem;
      cursor: pointer;
      text-align: center;
      transition: all 0.15s;
    }

    .trace-attachment-btn:hover {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    /* Image comparison slider */
    .trace-image-compare {
      position: relative;
      overflow: hidden;
      border-radius: 6px;
    }

    .trace-image-compare img {
      display: block;
      width: 100%;
    }

    .trace-image-compare-overlay {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 50%;
      overflow: hidden;
      border-right: 2px solid var(--accent-blue);
    }

    .trace-image-compare-overlay img {
      position: absolute;
      top: 0;
      left: 0;
      width: 200%;
    }

    .trace-image-compare-slider {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--accent-blue);
      cursor: ew-resize;
      left: 50%;
      transform: translateX(-50%);
    }

    .trace-image-compare-slider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--accent-blue);
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
    }
  

  </style>
</head>
<body>
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- App Shell -->
  <div class="app-shell" role="application">
    <!-- Top Bar -->
    <header class="top-bar">
      <div class="top-bar-left">
        <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle Sidebar (B)" aria-label="Toggle sidebar navigation" aria-expanded="true" aria-controls="sidebar">
          <span class="hamburger-icon" aria-hidden="true"></span>
        </button>
        <div class="logo">
          <div class="logo-text">
            <span class="logo-title">StageWright Local</span>
            <span class="logo-subtitle">Get your test stage right.</span>
          </div>
        </div>
        <nav class="breadcrumbs">
          <span class="breadcrumb active" data-view="tests">Tests</span>
          <span class="breadcrumb-separator"></span>
          <span class="breadcrumb" id="breadcrumb-detail"></span>
        </nav>
      </div>
      <div class="top-bar-right">
        <button class="search-trigger" onclick="openSearch()" title="Search (K)" aria-label="Search tests">
          <span class="search-icon-btn"></span>
          <span class="search-label">Search...</span>
          <kbd class="search-kbd">K</kbd>
        </button>
        <div class="export-dropdown" id="exportDropdown">
          <button class="top-bar-btn" onclick="toggleExportMenu()" title="Export" aria-haspopup="true" aria-expanded="false">
            <span></span>
            <span class="btn-label">Export</span>
          </button>
          <div class="export-menu" role="menu">
            <button class="export-menu-item" onclick="exportJSON()" role="menuitem">
              <span></span> JSON
            </button>
            <button class="export-menu-item" onclick="exportCSV()" role="menuitem">
              <span></span> CSV
            </button>
            <button class="export-menu-item" onclick="showSummaryExport()" role="menuitem">
              <span></span> Summary Card
            </button>
          </div>
        </div>
        <div class="theme-dropdown" id="themeDropdown">
          <button class="theme-toggle" onclick="toggleThemeMenu()" title="Theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false">
            <span class="theme-toggle-icon" id="themeIcon"></span>
            <span class="theme-label" id="themeLabel">Dark</span>
          </button>
          <div class="theme-menu" role="menu">
            <button class="theme-menu-item" onclick="setTheme('system')" role="menuitem" data-theme="system">
              <span></span> System
            </button>
            <button class="theme-menu-item" onclick="setTheme('light')" role="menuitem" data-theme="light">
              <span></span> Light
            </button>
            <button class="theme-menu-item" onclick="setTheme('dark')" role="menuitem" data-theme="dark">
              <span></span> Dark
            </button>
          </div>
        </div>
        <div class="timestamp">7/2/2026, 9:51:06 am</div>
      </div>
    </header>

    

    <!-- Mobile sidebar overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Toast notifications container -->
    <div class="toast-container" id="toastContainer" aria-live="polite"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <!-- Progress Ring -->
      <div class="sidebar-progress">
        <div class="progress-ring-container clickable" onclick="switchView('tests')" title="View all tests" role="button" tabindex="0">
          <svg class="progress-ring" width="80" height="80">
            <circle class="progress-ring-bg" cx="40" cy="40" r="34"/>
            <circle class="progress-ring-fill" cx="40" cy="40" r="34"
                    stroke-dasharray="213.6"
                    stroke-dashoffset="0.0"/>
          </svg>
          <div class="progress-ring-value">100%</div>
        </div>
        <div class="progress-label">Pass Rate</div>
      </div>

      <!-- Quick Stats -->
      <div class="sidebar-stats" role="group" aria-label="Test statistics">
        <button class="mini-stat passed" onclick="filterTests('passed')" title="Passed tests" aria-label="1 passed tests - click to filter">
          <span class="mini-stat-value">1</span>
          <span class="mini-stat-label">Passed</span>
        </button>
        <button class="mini-stat failed" onclick="filterTests('failed')" title="Failed tests" aria-label="0 failed tests - click to filter">
          <span class="mini-stat-value">0</span>
          <span class="mini-stat-label">Failed</span>
        </button>
        <button class="mini-stat flaky" onclick="filterTests('flaky')" title="Flaky tests" aria-label="0 flaky tests - click to filter">
          <span class="mini-stat-value">0</span>
          <span class="mini-stat-label">Flaky</span>
        </button>
      </div>

      <!-- Navigation -->
      <nav class="sidebar-nav" aria-label="Main navigation">
        <div class="nav-section-title" id="nav-section-label">Navigation</div>
        <div role="tablist" aria-labelledby="nav-section-label">
          <button class="nav-item active" data-view="overview" onclick="switchView('overview')" role="tab" aria-selected="true" aria-controls="view-overview">
            <span class="nav-icon" aria-hidden="true"></span>
            <span class="nav-label">Overview</span>
          </button>
          <button class="nav-item" data-view="tests" onclick="switchView('tests')" role="tab" aria-selected="false" aria-controls="view-tests">
            <span class="nav-icon" aria-hidden="true"></span>
            <span class="nav-label">Tests</span>
            <span class="nav-badge" aria-label="1 total tests">1</span>
          </button>
          <button class="nav-item" data-view="trends" onclick="switchView('trends')" role="tab" aria-selected="false" aria-controls="view-trends">
            <span class="nav-icon" aria-hidden="true"></span>
            <span class="nav-label">Trends</span>
          </button>
          
          
          <button class="nav-item" data-view="gallery" onclick="switchView('gallery')" role="tab" aria-selected="false" aria-controls="view-gallery">
            <span class="nav-icon" aria-hidden="true"></span>
            <span class="nav-label">Gallery</span>
          </button>
          
        </div>
      </nav>

      <!-- Filters -->
      <div class="sidebar-filters" role="region" aria-label="Test filters">
        <div class="nav-section-title">Filters <button class="clear-filters-btn" onclick="clearAllFilters()" title="Clear all filters" aria-label="Clear all filters"></button></div>
        
        <div class="filter-group" data-group="status" role="group" aria-label="Status filters">
          <div class="filter-group-title" id="status-filter-label">Status</div>
          <div class="filter-chips" role="group" aria-labelledby="status-filter-label">
            <button class="filter-chip" data-filter="passed" data-group="status" onclick="toggleFilter(this)" aria-pressed="false">Passed</button>
            <button class="filter-chip" data-filter="failed" data-group="status" onclick="toggleFilter(this)" aria-pressed="false">Failed</button>
            <button class="filter-chip" data-filter="skipped" data-group="status" onclick="toggleFilter(this)" aria-pressed="false">Skipped</button>
          </div>
        </div>
        <div class="filter-group" data-group="health" role="group" aria-label="Health filters">
          <div class="filter-group-title" id="health-filter-label">Health</div>
          <div class="filter-chips" role="group" aria-labelledby="health-filter-label">
            <button class="filter-chip" data-filter="flaky" data-group="health" onclick="toggleFilter(this)" aria-pressed="false">Flaky (0)</button>
            <button class="filter-chip" data-filter="slow" data-group="health" onclick="toggleFilter(this)" aria-pressed="false">Slow (0)</button>
            <button class="filter-chip" data-filter="new" data-group="health" onclick="toggleFilter(this)" aria-pressed="false">New (1)</button>
          </div>
        </div>
        <div class="filter-group" data-group="grade" role="group" aria-label="Grade filters">
          <div class="filter-group-title" id="grade-filter-label">Grade</div>
          <div class="filter-chips grade-chips" role="group" aria-labelledby="grade-filter-label">
            <button class="filter-chip grade-a" data-filter="grade-a" data-group="grade" onclick="toggleFilter(this)" aria-pressed="false" aria-label="Grade A">A</button>
            <button class="filter-chip grade-b" data-filter="grade-b" data-group="grade" onclick="toggleFilter(this)" aria-pressed="false" aria-label="Grade B">B</button>
            <button class="filter-chip grade-c" data-filter="grade-c" data-group="grade" onclick="toggleFilter(this)" aria-pressed="false" aria-label="Grade C">C</button>
            <button class="filter-chip grade-d" data-filter="grade-d" data-group="grade" onclick="toggleFilter(this)" aria-pressed="false" aria-label="Grade D">D</button>
            <button class="filter-chip grade-f" data-filter="grade-f" data-group="grade" onclick="toggleFilter(this)" aria-pressed="false" aria-label="Grade F">F</button>
          </div>
        </div>
        
        <div class="filter-group" data-group="suite" role="group" aria-label="Suite filters">
          <div class="filter-group-title" id="suite-filter-label">Suite</div>
          <div class="filter-chips suite-chips" role="group" aria-labelledby="suite-filter-label">
            <button class="filter-chip suite-chip" data-filter="suite-signInTest.spec.ts" data-group="suite" data-suite-name="signInTest.spec.ts" onclick="toggleFilter(this)" aria-pressed="false" title="signInTest.spec.ts (1 tests)">signInTest.s... (1)</button>
          </div>
        </div>
        
        
      </div>

      <!-- File Tree -->
      <div class="sidebar-files">
        <div class="nav-section-title">Specs</div>
        <div class="file-tree">
          
      <div class="file-tree-item all-passed" data-file="signInTest.spec.ts" onclick="filterByFile('signInTest.spec.ts')">
        <span class="file-tree-icon"></span>
        <span class="file-tree-name" title="signInTest.spec.ts">signInTest.spec.ts</span>
        <span class="file-tree-stats">
          <span class="file-stat passed">1</span>
          
        </span>
      </div>
    
        </div>
      </div>

      <!-- Duration -->
      <div class="sidebar-footer">
        <div class="run-duration">
          <span class="duration-icon"></span>
          <span class="duration-value">5.1s</span>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content" id="main-content" tabindex="-1" aria-label="Test report content">
      <!-- Overview View -->
      <section class="view-panel" id="view-overview" role="tabpanel" aria-label="Overview">
        <div class="view-header">
          <h2 class="view-title">Overview</h2>
        </div>
        <div class="overview-content">
          
    <!-- Hero Stats Row -->
    <div class="hero-stats">
      <div class="hero-stat-card health excellent">
        <div class="health-gauge">
          <svg class="health-ring" viewBox="0 0 100 100">
            <circle class="health-ring-bg" cx="50" cy="50" r="42" />
            <circle class="health-ring-fill" cx="50" cy="50" r="42" 
                    stroke-dasharray="264 264"
                    stroke-dashoffset="0" />
          </svg>
          <div class="health-score">
            <span class="health-grade">A</span>
            <span class="health-value">100</span>
          </div>
        </div>
        <div class="hero-stat-info">
          <div class="hero-stat-label">Suite Health</div>
          <div class="health-breakdown">
            <span>Pass: 100%</span>
            <span>Stability: 100%</span>
            <span>Perf: 100%</span>
          </div>
        </div>
      </div>

      <div class="hero-stat-card">
        <div class="hero-stat-main">
          <div class="hero-stat-value">100%</div>
          
        </div>
        <div class="hero-stat-label">Pass Rate</div>
        <div class="hero-stat-detail">1/1 tests</div>
      </div>

      <div class="hero-stat-card">
        <div class="hero-stat-main">
          <div class="hero-stat-value">5.1s</div>
          
        </div>
        <div class="hero-stat-label">Duration</div>
        <div class="hero-stat-detail">Total run time</div>
      </div>

      <div class="hero-stat-card mini-comparison">
        <div class="mini-bars">
          <div class="mini-bar-row clickable" onclick="filterByStatus('passed')" title="View passed tests" role="button" tabindex="0">
            <span class="mini-bar-label">Passed</span>
            <div class="mini-bar-track">
              <div class="mini-bar passed" style="width: 100.0%"></div>
            </div>
            <span class="mini-bar-value">1</span>
          </div>
          <div class="mini-bar-row clickable" onclick="filterByStatus('failed')" title="View failed tests" role="button" tabindex="0">
            <span class="mini-bar-label">Failed</span>
            <div class="mini-bar-track">
              <div class="mini-bar failed" style="width: 0.0%"></div>
            </div>
            <span class="mini-bar-value">0</span>
          </div>
          <div class="mini-bar-row clickable" onclick="filterByStatus('skipped')" title="View skipped tests" role="button" tabindex="0">
            <span class="mini-bar-label">Skipped</span>
            <div class="mini-bar-track">
              <div class="mini-bar skipped" style="width: 0.0%"></div>
            </div>
            <span class="mini-bar-value">0</span>
          </div>
        </div>
      </div>
    </div>

    

    

    <!-- Quick Insights -->
    <div class="overview-section">
      <div class="section-header">
        <span class="section-icon"></span>
        <span class="section-title">Quick Insights</span>
      </div>
      <div class="insights-grid">
        
          <div class="insight-card" onclick="selectTest('_firefox__signInTest_spec_ts__Login_with_valid_credentials'); switchView('tests');">
            <div class="insight-icon"></div>
            <div class="insight-content">
              <div class="insight-label">Slowest Test</div>
              <div class="insight-title">Login with valid credentials</div>
              <div class="insight-value">2.4s</div>
            </div>
          </div>
        
        
        <div class="insight-card clickable" onclick="switchView('tests')" title="View all tests">
          <div class="insight-icon"></div>
          <div class="insight-content">
            <div class="insight-label">Test Distribution</div>
            <div class="insight-mini-stats">
              <span class="mini-stat"><span class="dot passed"></span>1 passed</span>
              <span class="mini-stat"><span class="dot failed"></span>0 failed</span>
              <span class="mini-stat"><span class="dot skipped"></span>0 skipped</span>
            </div>
          </div>
        </div>
        <div class="insight-card clickable" onclick="switchView('trends')" title="View trends">
          <div class="insight-icon"></div>
          <div class="insight-content">
            <div class="insight-label">Pass Rate Trend</div>
            <div class="mini-sparkline">
              <span class="no-data">No history available</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  
        </div>
      </section>

      <!-- Tests View (Master-Detail) -->
      <section class="view-panel" id="view-tests" role="tabpanel" aria-label="Tests" style="display: none;">
        <div class="master-detail-layout">
          <!-- Test List (Master) -->
          <div class="test-list-panel">
            <div class="test-list-header">
              <div class="test-list-tabs" role="tablist" aria-label="Test grouping options">
                <button class="tab-btn active" data-tab="all" onclick="switchTestTab('all')" role="tab" aria-selected="true" aria-controls="tab-all">All Tests</button>
                <button class="tab-btn" data-tab="by-file" onclick="switchTestTab('by-file')" role="tab" aria-selected="false" aria-controls="tab-by-file">By Spec</button>
                <button class="tab-btn" data-tab="by-status" onclick="switchTestTab('by-status')" role="tab" aria-selected="false" aria-controls="tab-by-status">By Status</button>
                <button class="tab-btn" data-tab="by-stability" onclick="switchTestTab('by-stability')" role="tab" aria-selected="false" aria-controls="tab-by-stability">By Stability</button>
              </div>
              <div class="test-list-search">
                <input type="text" class="inline-search" placeholder="Filter tests..." oninput="searchTests(this.value)" aria-label="Filter tests by name">
              </div>
            </div>
            <div class="test-list-content">
              <!-- Empty state for no results -->
              <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-state-icon"></div>
                <div class="empty-state-title">No tests found</div>
                <div class="empty-state-message">No tests match your current filters. Try adjusting your search or filter criteria.</div>
                <button class="empty-state-action" onclick="clearAllFilters()">Clear filters</button>
              </div>
              <!-- All Tests Tab -->
              <div class="test-tab-content active" id="tab-all" role="tabpanel" aria-labelledby="tab-all-label">
                <div role="list" aria-label="All tests">
                  
      <div class="test-list-item passed"
           id="list-item-_firefox__signInTest_spec_ts__Login_with_valid_credentials"
           role="listitem"
           aria-label="Login with valid credentials - Passed"
           data-testid="[firefox] signInTest.spec.ts::Login with valid credentials"
           data-status="passed"
           data-flaky="false"
           data-slow="false"
           data-new="true"
           data-new-failure="false"
           data-regression="false"
           data-fixed="false"
           data-file="signInTest.spec.ts"
           data-grade="A"
           data-tags=""
           data-suite="signInTest.spec.ts"
           data-suites="signInTest.spec.ts"
           onclick="selectTest('_firefox__signInTest_spec_ts__Login_with_valid_credentials')"
           tabindex="0"
           onkeydown="if(event.key==='Enter')selectTest('_firefox__signInTest_spec_ts__Login_with_valid_credentials')">
        <div class="test-item-status" aria-hidden="true">
          <div class="status-dot passed"></div>
        </div>
        <div class="test-item-info">
          <div class="test-item-title">Login with valid credentials</div>
          <div class="test-item-file">signInTest.spec.ts</div>
        </div>
        <div class="test-item-meta">
          
          
          
          <span class="stability-badge grade-a">A</span>
          <span class="test-item-duration">2.4s</span>
          
          
          <span class="test-item-badge new">New</span>
        </div>
      </div>
    
                </div>
              </div>
              <!-- By Spec Tab -->
              <div class="test-tab-content" id="tab-by-file" role="tabpanel" aria-labelledby="tab-by-file-label">
                
    <div id="group-signInTest_spec_ts" class="file-group">
      <div class="file-group-header" onclick="toggleGroup('signInTest_spec_ts')">
        <span class="expand-icon"></span>
        <span class="file-group-name"> signInTest.spec.ts</span>
        <div class="file-group-stats">
          <span class="file-group-stat passed">1 passed</span>
          
        </div>
      </div>
      <div class="file-group-content">
        
        <div class="test-list-item passed" 
             id="list-item-_firefox__signInTest_spec_ts__Login_with_valid_credentials"
             data-testid="[firefox] signInTest.spec.ts::Login with valid credentials"
             data-status="passed"
             data-flaky="false"
             data-slow="false"
             data-new="true"
             data-new-failure="false"
             data-regression="false"
             data-fixed="false"
             data-file="signInTest.spec.ts"
             data-grade="A"
             onclick="selectTest('_firefox__signInTest_spec_ts__Login_with_valid_credentials')">
          <div class="test-item-status">
            <div class="status-dot passed"></div>
          </div>
          <div class="test-item-info">
            <div class="test-item-title">Login with valid credentials</div>
          </div>
          <div class="test-item-meta">
            
            
            
            <span class="stability-badge grade-a">A</span>
            <span class="test-item-duration">2.4s</span>
            
            
            <span class="test-item-badge new">New</span>
          </div>
        </div>
      
      </div>
    </div>
  
              </div>
              <!-- By Status Tab -->
              <div class="test-tab-content" id="tab-by-status" role="tabpanel" aria-labelledby="tab-by-status-label">
                <div class="status-group failed-group">
                  <div class="status-group-header">
                    <span class="status-group-dot failed"></span>
                    <span class="status-group-title">Failed (0)</span>
                  </div>
                  
                </div>
                <div class="status-group passed-group">
                  <div class="status-group-header">
                    <span class="status-group-dot passed"></span>
                    <span class="status-group-title">Passed (1)</span>
                  </div>
                  
      <div class="test-list-item passed"
           id="list-item-_firefox__signInTest_spec_ts__Login_with_valid_credentials"
           role="listitem"
           aria-label="Login with valid credentials - Passed"
           data-testid="[firefox] signInTest.spec.ts::Login with valid credentials"
           data-status="passed"
           data-flaky="false"
           data-slow="false"
           data-new="true"
           data-new-failure="false"
           data-regression="false"
           data-fixed="false"
           data-file="signInTest.spec.ts"
           data-grade="A"
           data-tags=""
           data-suite="signInTest.spec.ts"
           data-suites="signInTest.spec.ts"
           onclick="selectTest('_firefox__signInTest_spec_ts__Login_with_valid_credentials')"
           tabindex="0"
           onkeydown="if(event.key==='Enter')selectTest('_firefox__signInTest_spec_ts__Login_with_valid_credentials')">
        <div class="test-item-status" aria-hidden="true">
          <div class="status-dot passed"></div>
        </div>
        <div class="test-item-info">
          <div class="test-item-title">Login with valid credentials</div>
          <div class="test-item-file">signInTest.spec.ts</div>
        </div>
        <div class="test-item-meta">
          
          
          
          <span class="stability-badge grade-a">A</span>
          <span class="test-item-duration">2.4s</span>
          
          
          <span class="test-item-badge new">New</span>
        </div>
      </div>
    
                </div>
                <div class="status-group skipped-group">
                  <div class="status-group-header">
                    <span class="status-group-dot skipped"></span>
                    <span class="status-group-title">Skipped (0)</span>
                  </div>
                  
                </div>
              </div>
              <!-- By Stability Tab -->
              <div class="test-tab-content" id="tab-by-stability">
                
                    <div class="stability-group grade-a-group">
                      <div class="stability-group-header">
                        <span class="stability-badge a">A</span>
                        <span class="stability-group-title">Grade A (1)</span>
                      </div>
                      
      <div class="test-list-item passed"
           id="list-item-_firefox__signInTest_spec_ts__Login_with_valid_credentials"
           role="listitem"
           aria-label="Login with valid credentials - Passed"
           data-testid="[firefox] signInTest.spec.ts::Login with valid credentials"
           data-status="passed"
           data-flaky="false"
           data-slow="false"
           data-new="true"
           data-new-failure="false"
           data-regression="false"
           data-fixed="false"
           data-file="signInTest.spec.ts"
           data-grade="A"
           data-tags=""
           data-suite="signInTest.spec.ts"
           data-suites="signInTest.spec.ts"
           onclick="selectTest('_firefox__signInTest_spec_ts__Login_with_valid_credentials')"
           tabindex="0"
           onkeydown="if(event.key==='Enter')selectTest('_firefox__signInTest_spec_ts__Login_with_valid_credentials')">
        <div class="test-item-status" aria-hidden="true">
          <div class="status-dot passed"></div>
        </div>
        <div class="test-item-info">
          <div class="test-item-title">Login with valid credentials</div>
          <div class="test-item-file">signInTest.spec.ts</div>
        </div>
        <div class="test-item-meta">
          
          
          
          <span class="stability-badge grade-a">A</span>
          <span class="test-item-duration">2.4s</span>
          
          
          <span class="test-item-badge new">New</span>
        </div>
      </div>
    
                    </div>
                  
              </div>
            </div>
          </div>

          <!-- Test Detail (Detail) -->
          <div class="test-detail-panel" id="test-detail-panel">
            <div class="detail-placeholder">
              <div class="placeholder-icon"></div>
              <div class="placeholder-text">Select a test to view details</div>
              <div class="placeholder-hint">Click on any test in the list</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Trends View -->
      <section class="view-panel" id="view-trends" role="tabpanel" aria-label="Trends" style="display: none;">
        <div class="view-header">
          <h2 class="view-title">Trends</h2>
        </div>
        <div class="trends-content">
          
      <div class="trend-section">
        <div class="trend-header">
          <div class="trend-title"> Test Run Trends</div>
          <div class="trend-subtitle">Collecting data...</div>
        </div>
        <div class="trend-message">
          <p> <strong>Trends will appear after 2+ test runs.</strong></p>
          <p>Run your tests again to start seeing historical trends, pass rates, and performance patterns.</p>
          <p style="font-size: 0.85em; opacity: 0.7;">Make sure your <code>historyFile</code> option points to a persistent location.</p>
        </div>
      </div>
    
        </div>
      </section>

      <!-- Comparison View -->
      

      <!-- Gallery View -->
      
      <section class="view-panel" id="view-gallery" role="tabpanel" aria-label="Gallery" style="display: none;">
        <div class="view-header">
          <h2 class="view-title">Attachments Gallery</h2>
        </div>
        <div class="gallery-content">
          
        </div>
      </section>
      
    </main>
  </div>

  <!-- Search Modal -->
  <div class="search-modal" id="search-modal" role="dialog" aria-modal="true" aria-labelledby="search-modal-title" aria-hidden="true">
    <div class="search-modal-backdrop" onclick="closeSearch()"></div>
    <div class="search-modal-content">
      <div class="search-modal-header">
        <span class="search-modal-icon" aria-hidden="true"></span>
        <label for="search-modal-input" class="visually-hidden" id="search-modal-title">Search tests</label>
        <input type="text" class="search-modal-input" id="search-modal-input" placeholder="Search tests..." oninput="handleSearchInput(this.value)" aria-describedby="search-modal-hint">
        <span id="search-modal-hint" class="visually-hidden">Press Escape to close</span>
        <kbd class="search-modal-esc" aria-hidden="true">ESC</kbd>
      </div>
      <div class="search-modal-results" id="search-modal-results" role="listbox" aria-label="Search results"></div>
    </div>
  </div>

  <!-- Issue #13: Inline Trace Viewer Modal -->
  
  <div id="traceViewerModal" class="trace-modal" onclick="if(event.target === this) closeTraceModal()">
    <div class="trace-modal-content">
      <div class="trace-modal-header">
        <h3 class="trace-modal-title">
          <span class="trace-modal-icon"></span>
          <span id="traceViewerTitle">Trace Viewer</span>
        </h3>
        <div class="trace-header-controls">
          <button class="trace-btn trace-btn-small trace-btn-secondary" onclick="toggleFullscreen()" title="Toggle fullscreen">
            <span id="fullscreenIcon"></span>
          </button>
          <button class="trace-modal-close" onclick="closeTraceModal()" aria-label="Close">&times;</button>
        </div>
      </div>
      <div class="trace-modal-body">
        <!-- Loading State -->
        <div id="traceLoading" class="trace-loading">
          <div class="trace-loading-spinner"></div>
          <p>Loading trace...</p>
        </div>

        <!-- Error State -->
        <div id="traceError" class="trace-error" style="display: none;">
          <div class="trace-error-icon"></div>
          <p id="traceErrorMessage">Failed to load trace</p>
          <div class="trace-error-actions">
            <button onclick="document.getElementById('traceFileInput').click()" class="trace-btn">
               Load from file
            </button>
            <button id="traceCopyCmd" class="trace-btn trace-btn-secondary">
               Copy CLI command
            </button>
          </div>
          <input type="file" id="traceFileInput" accept=".zip" style="display: none;" onchange="loadTraceFromFile(this.files[0])">
        </div>

        <!-- Trace Content -->
        <div id="traceContent" class="trace-content" style="display: none;">
          <!-- Timeline Filmstrip with Slider -->
          <div id="traceTimeline" class="trace-timeline">
            <div class="trace-timeline-scroll" id="traceTimelineScroll">
              <!-- Thumbnails inserted by JS -->
            </div>
            <div class="trace-timeline-slider-track" id="traceSliderTrack">
              <div class="trace-timeline-slider-thumb" id="traceSliderThumb"></div>
              <div class="trace-timeline-slider-progress" id="traceSliderProgress"></div>
            </div>
            <!-- Hover magnification preview -->
            <div class="trace-timeline-magnifier" id="traceTimelineMagnifier" style="display: none;">
              <img id="traceMagnifierImg" src="" alt="Preview" />
              <div class="trace-magnifier-time" id="traceMagnifierTime"></div>
            </div>
          </div>

          <div class="trace-layout">
            <!-- Actions Panel -->
            <div class="trace-actions-panel" id="traceActionsPanel">
              <div class="trace-actions-header">
                <span>Actions</span>
                <span id="traceActionCount" class="trace-count"></span>
              </div>
              <!-- Action Search -->
              <div class="trace-search-wrapper">
                <input type="text" id="traceActionSearch" class="trace-search-input" placeholder="Filter actions..." oninput="filterTraceActions(this.value)">
                <button class="trace-search-clear" id="traceSearchClear" onclick="clearActionSearch()" style="display: none;">&times;</button>
              </div>
              <div id="traceActionsList" class="trace-actions-list"></div>
            </div>

            <!-- Resizer -->
            <div class="trace-resizer" id="traceResizer"></div>

            <!-- Main View -->
            <div class="trace-main-panel">
              <!-- Screenshot/Preview with Before/After controls -->
              <div class="trace-screenshot-panel">
                <div class="trace-snapshot-controls" id="traceSnapshotControls" style="display: none;">
                  <button class="trace-snapshot-btn active" data-snapshot="after" onclick="switchSnapshot('after')">
                    After
                  </button>
                  <button class="trace-snapshot-btn" data-snapshot="before" onclick="switchSnapshot('before')">
                    Before
                  </button>
                  <span class="trace-snapshot-hint">Press B/A keys</span>
                </div>
                <div class="trace-screenshot-container" id="traceScreenshotContainer">
                  <img id="traceScreenshot" class="trace-screenshot" src="" alt="Action screenshot" />
                  <!-- Click position indicator -->
                  <div id="traceClickIndicator" class="trace-click-indicator" style="display: none;">
                    <div class="trace-click-dot"></div>
                    <div class="trace-click-ripple"></div>
                  </div>
                  <div id="traceNoScreenshot" class="trace-no-screenshot">
                    <span>No screenshot for this action</span>
                  </div>
                </div>
              </div>

              <!-- Details Tabs -->
              <div class="trace-details-panel">
                <div class="trace-tabs">
                  <button class="trace-tab active" data-tab="details" onclick="switchTraceTab('details')">Details</button>
                  <button class="trace-tab" data-tab="console" onclick="switchTraceTab('console')">
                    Console
                    <span id="traceConsoleCount" class="trace-tab-badge" style="display: none;"></span>
                  </button>
                  <button class="trace-tab" data-tab="source" onclick="switchTraceTab('source')">Source</button>
                  <button class="trace-tab" data-tab="network" onclick="switchTraceTab('network')">Network</button>
                  <button class="trace-tab" data-tab="metadata" onclick="switchTraceTab('metadata')">Metadata</button>
                  <button class="trace-tab" data-tab="errors" onclick="switchTraceTab('errors')">
                    Errors
                    <span id="traceErrorCount" class="trace-tab-badge trace-tab-badge-error" style="display: none;"></span>
                  </button>
                  <button class="trace-tab" data-tab="attachments" onclick="switchTraceTab('attachments')">
                    Attachments
                    <span id="traceAttachmentCount" class="trace-tab-badge" style="display: none;"></span>
                  </button>
                </div>
                <div class="trace-tab-content">
                  <div id="traceTabDetails" class="trace-tab-pane active">
                    <div id="traceDetailsContent"></div>
                  </div>
                  <div id="traceTabConsole" class="trace-tab-pane">
                    <div class="trace-console-controls">
                      <button class="trace-console-filter active" data-level="all" onclick="filterConsole('all')">All</button>
                      <button class="trace-console-filter" data-level="error" onclick="filterConsole('error')">Errors</button>
                      <button class="trace-console-filter" data-level="warning" onclick="filterConsole('warning')">Warnings</button>
                      <button class="trace-console-filter" data-level="log" onclick="filterConsole('log')">Info</button>
                    </div>
                    <div id="traceConsoleContent"></div>
                  </div>
                  <div id="traceTabSource" class="trace-tab-pane">
                    <div id="traceSourceContent"></div>
                  </div>
                  <div id="traceTabNetwork" class="trace-tab-pane">
                    <div class="trace-network-controls">
                      <input type="text" id="traceNetworkSearch" class="trace-network-search" placeholder="Filter by URL..." oninput="filterNetwork(this.value)">
                      <div class="trace-network-filters">
                        <button class="trace-network-filter active" data-type="all" onclick="filterNetworkType('all')">All</button>
                        <button class="trace-network-filter" data-type="xhr" onclick="filterNetworkType('xhr')">XHR</button>
                        <button class="trace-network-filter" data-type="doc" onclick="filterNetworkType('doc')">Doc</button>
                        <button class="trace-network-filter" data-type="css" onclick="filterNetworkType('css')">CSS</button>
                        <button class="trace-network-filter" data-type="js" onclick="filterNetworkType('js')">JS</button>
                        <button class="trace-network-filter" data-type="img" onclick="filterNetworkType('img')">Img</button>
                      </div>
                    </div>
                    <div id="traceNetworkContent"></div>
                  </div>
                  <div id="traceTabMetadata" class="trace-tab-pane">
                    <div id="traceMetadataContent"></div>
                  </div>
                  <div id="traceTabErrors" class="trace-tab-pane">
                    <div id="traceErrorsContent"></div>
                  </div>
                  <div id="traceTabAttachments" class="trace-tab-pane">
                    <div id="traceAttachmentsContent"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  

  <!-- Hidden data containers for detail rendering -->
  <div id="test-cards-data" style="display: none;">
    
    <div id="card-_firefox__signInTest_spec_ts__Login_with_valid_credentials" class="test-card"
         data-status="passed"
         data-flaky="false"
         data-unstable="false"
         data-slow="false"
         data-new="true"
         data-grade="A" data-suite="signInTest.spec.ts" data-suites="signInTest.spec.ts" data-browser="firefox" data-project="firefox">
      <div class="test-card-header" onclick="toggleDetails('_firefox__signInTest_spec_ts__Login_with_valid_credentials', event)">
        <div class="test-card-left">
          <div class="status-indicator passed"></div>
          <div class="test-info">
            <div class="test-title-row">
              <span class="test-title">Login with valid credentials</span>
              <span class="test-suite-badge" title="Suite: signInTest.spec.ts">signInTest.spec.ts</span>
            </div>
            <div class="test-meta-row">
              <span class="test-file">signInTest.spec.ts</span>
            </div>
              <div class="test-badges-row">
                <span class="test-browser-badge" title="Browser: firefox"> firefox</span>
              </div>
          </div>
        </div>
        <div class="test-card-right">
          <span class="test-duration">2.4s</span>
          <span class="badge stability-high" title="Stability Score: 100/100 (Flakiness: 100, Performance: 100, Reliability: 100)">A (100)</span>
          <span class="badge new">New</span>
          <span class="trend stable"> Baseline</span>
          <span class="expand-icon"></span>
        </div>
      </div>
      <div class="test-details"><div class="details-body" data-details-body>
      <div class="detail-section">
        <div class="detail-label"><span class="icon"></span> Step Timeline</div>
        <div class="step-timeline"><div class="step-timeline-bar cat-other" style="left: 0.0%; width: 21.1%;" title="Launch browser (627ms)">Launch browser</div><div class="step-timeline-bar cat-other" style="left: 21.1%; width: 3.4%;" title="Create context (102ms)"></div><div class="step-timeline-bar cat-other" style="left: 24.6%; width: 46.9%;" title="Create page (1.4s)">Create page</div><div class="step-timeline-bar cat-navigation" style="left: 71.4%; width: 18.0%;" title="Navigate to &quot;/&quot; (534ms)">Navigate to &quot;/&quot;</div><div class="step-timeline-bar cat-action" style="left: 89.4%; width: 3.4%;" title="Fill &quot;standard_user&quot; locator(&#039;#user-name&#039;) (102ms)"></div><div class="step-timeline-bar cat-action" style="left: 92.9%; width: 1.0%;" title="Fill &quot;secret_sauce&quot; locator(&#039;#password&#039;) (30ms)"></div><div class="step-timeline-bar cat-action" style="left: 93.9%; width: 4.9%;" title="Click locator(&#039;#login-button&#039;) (145ms)"></div><div class="step-timeline-bar cat-other" style="left: 98.8%; width: 1.2%;" title="Close context (37ms)"></div></div>
        <div class="step-timeline-legend"><span class="step-timeline-legend-item"><span class="step-timeline-legend-dot" style="background: #64748b"></span>Other</span><span class="step-timeline-legend-item"><span class="step-timeline-legend-dot" style="background: #3b82f6"></span>Navigation</span><span class="step-timeline-legend-item"><span class="step-timeline-legend-dot" style="background: #a855f7"></span>Action</span></div>
        <div class="steps-container" style="margin-top: 8px;">
          
            <div class="step-row ">
              <span class="step-title" title="Launch browser">Launch browser</span>
              <div class="step-bar-container">
                <div class="step-bar" style="width: 45.0%"></div>
              </div>
              <span class="step-duration">627ms</span>
              
            </div>
          
            <div class="step-row ">
              <span class="step-title" title="Create context">Create context</span>
              <div class="step-bar-container">
                <div class="step-bar" style="width: 7.3%"></div>
              </div>
              <span class="step-duration">102ms</span>
              
            </div>
          
            <div class="step-row slowest">
              <span class="step-title" title="Create page">Create page</span>
              <div class="step-bar-container">
                <div class="step-bar" style="width: 100.0%"></div>
              </div>
              <span class="step-duration">1.4s</span>
              <span class="slowest-badge">Slowest</span>
            </div>
          
            <div class="step-row ">
              <span class="step-title" title="Navigate to &quot;/&quot;">Navigate to &quot;/&quot;</span>
              <div class="step-bar-container">
                <div class="step-bar" style="width: 38.4%"></div>
              </div>
              <span class="step-duration">534ms</span>
              
            </div>
          
            <div class="step-row ">
              <span class="step-title" title="Fill &quot;standard_user&quot; locator(&#039;#user-name&#039;)">Fill &quot;standard_user&quot; locator(&#039;#user-name&#039;)</span>
              <div class="step-bar-container">
                <div class="step-bar" style="width: 7.3%"></div>
              </div>
              <span class="step-duration">102ms</span>
              
            </div>
          
            <div class="step-row ">
              <span class="step-title" title="Fill &quot;secret_sauce&quot; locator(&#039;#password&#039;)">Fill &quot;secret_sauce&quot; locator(&#039;#password&#039;)</span>
              <div class="step-bar-container">
                <div class="step-bar" style="width: 2.2%"></div>
              </div>
              <span class="step-duration">30ms</span>
              
            </div>
          
            <div class="step-row ">
              <span class="step-title" title="Click locator(&#039;#login-button&#039;)">Click locator(&#039;#login-button&#039;)</span>
              <div class="step-bar-container">
                <div class="step-bar" style="width: 10.4%"></div>
              </div>
              <span class="step-duration">145ms</span>
              
            </div>
          
            <div class="step-row ">
              <span class="step-title" title="Close context">Close context</span>
              <div class="step-bar-container">
                <div class="step-bar" style="width: 2.7%"></div>
              </div>
              <span class="step-duration">37ms</span>
              
            </div>
          
        </div>
      </div>
    </div></div>
    </div>
  
  </div>

  <!-- Issue #13: JSZip library for trace extraction -->
  <script>
    // JSZip v3.10.1 - inlined for self-contained reports
    
/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}}(function(){return function s(a,o,h){function u(r,e){if(!o[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return u(t||e)},i,i.exports,s,a,o,h)}return o[r].exports}for(var l="function"==typeof require&&require,e=0;e<h.length;e++)u(h[e]);return u}({1:[function(e,t,r){"use strict";var d=e("./utils"),c=e("./support"),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,n,i,s,a,o,h=[],u=0,l=e.length,f=l,c="string"!==d.getTypeOf(e);u<e.length;)f=l-u,n=c?(t=e[u++],r=u<l?e[u++]:0,u<l?e[u++]:0):(t=e.charCodeAt(u++),r=u<l?e.charCodeAt(u++):0,u<l?e.charCodeAt(u++):0),i=t>>2,s=(3&t)<<4|r>>4,a=1<f?(15&r)<<2|n>>6:64,o=2<f?63&n:64,h.push(p.charAt(i)+p.charAt(s)+p.charAt(a)+p.charAt(o));return h.join("")},r.decode=function(e){var t,r,n,i,s,a,o=0,h=0,u="data:";if(e.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var l,f=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===p.charAt(64)&&f--,e.charAt(e.length-2)===p.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(l=c.uint8array?new Uint8Array(0|f):new Array(0|f);o<e.length;)t=p.indexOf(e.charAt(o++))<<2|(i=p.indexOf(e.charAt(o++)))>>4,r=(15&i)<<4|(s=p.indexOf(e.charAt(o++)))>>2,n=(3&s)<<6|(a=p.indexOf(e.charAt(o++))),l[h++]=t,64!==s&&(l[h++]=r),64!==a&&(l[h++]=n);return l}},{"./support":30,"./utils":32}],2:[function(e,t,r){"use strict";var n=e("./external"),i=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function o(e,t,r,n,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=n,this.compressedContent=i}o.prototype={getContentWorker:function(){var e=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(e,t,r){return e.pipe(new s).pipe(new a("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){"use strict";var n=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){"use strict";var n=e("./utils");var o=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==n.getTypeOf(e)?function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){"use strict";var n=null;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:37}],7:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),s=e("./utils"),a=e("./stream/GenericWorker"),o=n?"uint8array":"array";function h(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",s.inherits(h,a),h.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,e.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},r.compressWorker=function(e){return new h("Deflate",e)},r.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){"use strict";function A(e,t){var r,n="";for(r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n}function n(e,t,r,n,i,s){var a,o,h=e.file,u=e.compression,l=s!==O.utf8encode,f=I.transformTo("string",s(h.name)),c=I.transformTo("string",O.utf8encode(h.name)),d=h.comment,p=I.transformTo("string",s(d)),m=I.transformTo("string",O.utf8encode(d)),_=c.length!==h.name.length,g=m.length!==d.length,b="",v="",y="",w=h.dir,k=h.date,x={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(x.crc32=e.crc32,x.compressedSize=e.compressedSize,x.uncompressedSize=e.uncompressedSize);var S=0;t&&(S|=8),l||!_&&!g||(S|=2048);var z=0,C=0;w&&(z|=16),"UNIX"===i?(C=798,z|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(h.unixPermissions,w)):(C=20,z|=function(e){return 63&(e||0)}(h.dosPermissions)),a=k.getUTCHours(),a<<=6,a|=k.getUTCMinutes(),a<<=5,a|=k.getUTCSeconds()/2,o=k.getUTCFullYear()-1980,o<<=4,o|=k.getUTCMonth()+1,o<<=5,o|=k.getUTCDate(),_&&(v=A(1,1)+A(B(f),4)+c,b+="up"+A(v.length,2)+v),g&&(y=A(1,1)+A(B(p),4)+m,b+="uc"+A(y.length,2)+y);var E="";return E+="\n\0",E+=A(S,2),E+=u.magic,E+=A(a,2),E+=A(o,2),E+=A(x.crc32,4),E+=A(x.compressedSize,4),E+=A(x.uncompressedSize,4),E+=A(f.length,2),E+=A(b.length,2),{fileRecord:R.LOCAL_FILE_HEADER+E+f+b,dirRecord:R.CENTRAL_FILE_HEADER+A(C,2)+E+A(p.length,2)+"\0\0\0\0"+A(z,4)+A(n,4)+f+b+p}}var I=e("../utils"),i=e("../stream/GenericWorker"),O=e("../utf8"),B=e("../crc32"),R=e("../signature");function s(e,t,r,n){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}I.inherits(s,i),s.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,i.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-n-1))/r:100}}))},s.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=n(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},s.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=n(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return R.DATA_DESCRIPTOR+A(e.crc32,4)+A(e.compressedSize,4)+A(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},s.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,n=function(e,t,r,n,i){var s=I.transformTo("string",i(n));return R.CENTRAL_DIRECTORY_END+"\0\0\0\0"+A(e,2)+A(e,2)+A(t,4)+A(r,4)+A(s.length,2)+s}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},s.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},s.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},s.prototype.error=function(e){var t=this._sources;if(!i.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},s.prototype.lock=function(){i.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=s},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){"use strict";var u=e("../compressions"),n=e("./ZipFileWorker");r.generateWorker=function(e,a,t){var o=new n(a.streamFiles,t,a.platform,a.encodeFileName),h=0;try{e.forEach(function(e,t){h++;var r=function(e,t){var r=e||t,n=u[r];if(!n)throw new Error(r+" is not a valid compression method !");return n}(t.options.compression,a.compression),n=t.options.compressionOptions||a.compressionOptions||{},i=t.dir,s=t.date;t._compressWorker(r,n).withStreamInfo("file",{name:e,dir:i,date:s,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(o)}),o.entriesCount=h}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.1",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){"use strict";var u=e("./utils"),i=e("./external"),n=e("./utf8"),s=e("./zipEntries"),a=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function f(n){return new i.Promise(function(e,t){var r=n.decompressed.getContentWorker().pipe(new a);r.on("error",function(e){t(e)}).on("end",function(){r.streamInfo.crc32!==n.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}t.exports=function(e,o){var h=this;return o=u.extend(o||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),l.isNode&&l.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):u.prepareContent("the loaded zip file",e,!0,o.optimizedBinaryString,o.base64).then(function(e){var t=new s(o);return t.load(e),t}).then(function(e){var t=[i.Promise.resolve(e)],r=e.files;if(o.checkCRC32)for(var n=0;n<r.length;n++)t.push(f(r[n]));return i.Promise.all(t)}).then(function(e){for(var t=e.shift(),r=t.files,n=0;n<r.length;n++){var i=r[n],s=i.fileNameStr,a=u.resolve(i.fileNameStr);h.file(a,i.decompressed,{binary:!0,optimizedBinaryString:!0,date:i.date,dir:i.dir,comment:i.fileCommentStr.length?i.fileCommentStr:null,unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions,createFolders:o.createFolders}),i.dir||(h.file(a).unsafeOriginalName=s)}return t.zipComment.length&&(h.comment=t.zipComment),h})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../stream/GenericWorker");function s(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(s,i),s.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){"use strict";var i=e("readable-stream").Readable;function n(e,t,r){i.call(this,t),this._helper=e;var n=this;e.on("data",function(e,t){n.push(e)||n._helper.pause(),r&&r(t)}).on("error",function(e){n.emit("error",e)}).on("end",function(){n.push(null)})}e("../utils").inherits(n,i),n.prototype._read=function(){this._helper.resume()},t.exports=n},{"../utils":32,"readable-stream":16}],14:[function(e,t,r){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){"use strict";function s(e,t,r){var n,i=u.getTypeOf(t),s=u.extend(r||{},f);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(e=g(e)),s.createFolders&&(n=_(e))&&b.call(this,n,!0);var a="string"===i&&!1===s.binary&&!1===s.base64;r&&void 0!==r.binary||(s.binary=!a),(t instanceof c&&0===t.uncompressedSize||s.dir||!t||0===t.length)&&(s.base64=!1,s.binary=!0,t="",s.compression="STORE",i="string");var o=null;o=t instanceof c||t instanceof l?t:p.isNode&&p.isStream(t)?new m(e,t):u.prepareContent(e,t,s.binary,s.optimizedBinaryString,s.base64);var h=new d(e,o,s);this.files[e]=h}var i=e("./utf8"),u=e("./utils"),l=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),f=e("./defaults"),c=e("./compressedObject"),d=e("./zipObject"),o=e("./generate"),p=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),_=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},b=function(e,t){return t=void 0!==t?t:f.createFolders,e=g(e),this.files[e]||s.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function h(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var n={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,n;for(t in this.files)n=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,n)},filter:function(r){var n=[];return this.forEach(function(e,t){r(e,t)&&n.push(t)}),n},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,s.call(this,e,t,r),this;if(h(e)){var n=e;return this.filter(function(e,t){return!t.dir&&n.test(e)})}var i=this.files[this.root+e];return i&&!i.dir?i:null},folder:function(r){if(!r)return this;if(h(r))return this.filter(function(e,t){return t.dir&&r.test(e)});var e=this.root+r,t=b.call(this,e),n=this.clone();return n.root=t.name,n},remove:function(r){r=this.root+r;var e=this.files[r];if(e||("/"!==r.slice(-1)&&(r+="/"),e=this.files[r]),e&&!e.dir)delete this.files[r];else for(var t=this.filter(function(e,t){return t.name.slice(0,r.length)===r}),n=0;n<t.length;n++)delete this.files[t[n].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=u.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");u.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"";t=o.generateWorker(this,r,n)}catch(e){(t=new l("error")).error(e)}return new a(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=n},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){"use strict";t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===t&&this.data[s+1]===r&&this.data[s+2]===n&&this.data[s+3]===i)return s-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&r===s[1]&&n===s[2]&&i===s[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){"use strict";var n=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,r){"use strict";var n=e("./Uint8ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){"use strict";var n=e("./ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../support"),s=e("./ArrayReader"),a=e("./StringReader"),o=e("./NodeBufferReader"),h=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new o(e):i.uint8array?new h(n.transformTo("uint8array",e)):new s(n.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../utils");function s(e){n.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(s,n),s.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,n),s.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function s(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(s,i),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function s(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}n.inherits(s,i),s.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,t,r){"use strict";var h=e("../utils"),i=e("./ConvertWorker"),s=e("./GenericWorker"),u=e("../base64"),n=e("../support"),a=e("../external"),o=null;if(n.nodestream)try{o=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function l(e,o){return new a.Promise(function(t,r){var n=[],i=e._internalType,s=e._outputType,a=e._mimeType;e.on("data",function(e,t){n.push(e),o&&o(t)}).on("error",function(e){n=[],r(e)}).on("end",function(){try{var e=function(e,t,r){switch(e){case"blob":return h.newBlob(h.transformTo("arraybuffer",t),r);case"base64":return u.encode(t);default:return h.transformTo(e,t)}}(s,function(e,t){var r,n=0,i=null,s=0;for(r=0;r<t.length;r++)s+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(i=new Uint8Array(s),r=0;r<t.length;r++)i.set(t[r],n),n+=t[r].length;return i;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(i,n),a);t(e)}catch(e){r(e)}n=[]}).resume()})}function f(e,t,r){var n=t;switch(t){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=t,this._mimeType=r,h.checkSupport(n),this._worker=e.pipe(new i(n)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}f.prototype={accumulate:function(e){return l(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,function(e){t.call(r,e.data,e.meta)}):this._worker.on(e,function(){h.delay(t,arguments,r)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new o(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer="undefined"!=typeof Buffer,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=0===new Blob([n],{type:"application/zip"}).size}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),r.blob=0===i.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,s){"use strict";for(var o=e("./utils"),h=e("./support"),r=e("./nodejsUtils"),n=e("./stream/GenericWorker"),u=new Array(256),i=0;i<256;i++)u[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;u[254]=u[254]=1;function a(){n.call(this,"utf-8 decode"),this.leftOver=null}function l(){n.call(this,"utf-8 encode")}s.utf8encode=function(e){return h.nodebuffer?r.newBufferFrom(e,"utf-8"):function(e){var t,r,n,i,s,a=e.length,o=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=h.uint8array?new Uint8Array(o):new Array(o),i=s=0;s<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t}(e)},s.utf8decode=function(e){return h.nodebuffer?o.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,n,i,s=e.length,a=new Array(2*s);for(t=r=0;t<s;)if((n=e[t++])<128)a[r++]=n;else if(4<(i=u[n]))a[r++]=65533,t+=i-1;else{for(n&=2===i?31:3===i?15:7;1<i&&t<s;)n=n<<6|63&e[t++],i--;1<i?a[r++]=65533:n<65536?a[r++]=n:(n-=65536,a[r++]=55296|n>>10&1023,a[r++]=56320|1023&n)}return a.length!==r&&(a.subarray?a=a.subarray(0,r):a.length=r),o.applyFromCharCode(a)}(e=o.transformTo(h.uint8array?"uint8array":"array",e))},o.inherits(a,n),a.prototype.processChunk=function(e){var t=o.transformTo(h.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(h.uint8array){var r=t;(t=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var n=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+u[e[r]]>t?r:t}(t),i=t;n!==t.length&&(h.uint8array?(i=t.subarray(0,n),this.leftOver=t.subarray(n,t.length)):(i=t.slice(0,n),this.leftOver=t.slice(n,t.length))),this.push({data:s.utf8decode(i),meta:e.meta})},a.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=a,o.inherits(l,n),l.prototype.processChunk=function(e){this.push({data:s.utf8encode(e.data),meta:e.meta})},s.Utf8EncodeWorker=l},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,a){"use strict";var o=e("./support"),h=e("./base64"),r=e("./nodejsUtils"),u=e("./external");function n(e){return e}function l(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}e("setimmediate"),a.newBlob=function(t,r){a.checkSupport("blob");try{return new Blob([t],{type:r})}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(r)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var i={stringifyByChunk:function(e,t,r){var n=[],i=0,s=e.length;if(s<=r)return String.fromCharCode.apply(null,e);for(;i<s;)"array"===t||"nodebuffer"===t?n.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,s)))):n.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,s)))),i+=r;return n.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(e){return!1}}()}};function s(e){var t=65536,r=a.getTypeOf(e),n=!0;if("uint8array"===r?n=i.applyCanBeUsed.uint8array:"nodebuffer"===r&&(n=i.applyCanBeUsed.nodebuffer),n)for(;1<t;)try{return i.stringifyByChunk(e,r,t)}catch(e){t=Math.floor(t/2)}return i.stringifyByChar(e)}function f(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}a.applyFromCharCode=s;var c={};c.string={string:n,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,r.allocBuffer(e.length))}},c.array={string:s,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(e)}},c.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return f(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return r.newBufferFrom(new Uint8Array(e))}},c.uint8array={string:s,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return r.newBufferFrom(e)}},c.nodebuffer={string:s,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return f(e,new Uint8Array(e.length))},nodebuffer:n},a.transformTo=function(e,t){if(t=t||"",!e)return t;a.checkSupport(e);var r=a.getTypeOf(t);return c[r][e](t)},a.resolve=function(e){for(var t=e.split("/"),r=[],n=0;n<t.length;n++){var i=t[n];"."===i||""===i&&0!==n&&n!==t.length-1||(".."===i?r.pop():r.push(i))}return r.join("/")},a.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":o.nodebuffer&&r.isBuffer(e)?"nodebuffer":o.uint8array&&e instanceof Uint8Array?"uint8array":o.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(e){if(!o[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return n},a.delay=function(e,t,r){setImmediate(function(){e.apply(r||null,t||[])})},a.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},a.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},a.prepareContent=function(r,e,n,i,s){return u.Promise.resolve(e).then(function(n){return o.blob&&(n instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(n)))&&"undefined"!=typeof FileReader?new u.Promise(function(t,r){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){r(e.target.error)},e.readAsArrayBuffer(n)}):n}).then(function(e){var t=a.getTypeOf(e);return t?("arraybuffer"===t?e=a.transformTo("uint8array",e):"string"===t&&(s?e=h.decode(e):n&&!0!==i&&(e=function(e){return l(e,o.uint8array?new Uint8Array(e.length):new Array(e.length))}(e))),e):u.Promise.reject(new Error("Can't read the data of '"+r+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),i=e("./utils"),s=e("./signature"),a=e("./zipEntry"),o=e("./support");function h(e){this.files=[],this.loadOptions=e}h.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=o.uint8array?"uint8array":"array",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=t-r;if(0<n)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),s=e("./utils"),i=e("./compressedObject"),a=e("./crc32"),o=e("./utf8"),h=e("./compressions"),u=e("./support");function l(e,t){this.options=e,this.loadOptions=t}l.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in h)if(Object.prototype.hasOwnProperty.call(h,t)&&h[t].magic===e)return h[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),r=e.readInt(2),n=e.readData(r),this.extraFields[t]={id:t,length:r,value:n};e.setIndex(i)},handleUTF8:function(){var e=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=s.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var i=s.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(i)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:a(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:a(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readData(e.length-5))}return null}},t.exports=l},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){"use strict";function n(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var s=e("./stream/StreamHelper"),i=e("./stream/DataWorker"),a=e("./utf8"),o=e("./compressedObject"),h=e("./stream/GenericWorker");n.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var n="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var i=!this._dataBinary;i&&!n&&(t=t.pipe(new a.Utf8EncodeWorker)),!i&&n&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(e){(t=new h("error")).error(e)}return new s(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof o&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof h?this._data:new i(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<u.length;f++)n.prototype[u[f]]=l;t.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,l,t){(function(t){"use strict";var r,n,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var i=0,s=new e(u),a=t.document.createTextNode("");s.observe(a,{characterData:!0}),r=function(){a.data=i=++i%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var o=new t.MessageChannel;o.port1.onmessage=u,r=function(){o.port2.postMessage(0)}}var h=[];function u(){var e,t;n=!0;for(var r=h.length;r;){for(t=h,h=[],e=-1;++e<r;)t[e]();r=h.length}n=!1}l.exports=function(e){1!==h.push(e)||n||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){"use strict";var i=e("immediate");function u(){}var l={},s=["REJECTED"],a=["FULFILLED"],n=["PENDING"];function o(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=n,this.queue=[],this.outcome=void 0,e!==u&&d(this,e)}function h(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function f(t,r,n){i(function(){var e;try{e=r(n)}catch(e){return l.reject(t,e)}e===t?l.reject(t,new TypeError("Cannot resolve promise with itself")):l.resolve(t,e)})}function c(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(t,e){var r=!1;function n(e){r||(r=!0,l.reject(t,e))}function i(e){r||(r=!0,l.resolve(t,e))}var s=p(function(){e(i,n)});"error"===s.status&&n(s.value)}function p(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=o).prototype.finally=function(t){if("function"!=typeof t)return this;var r=this.constructor;return this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})})},o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var r=new this.constructor(u);this.state!==n?f(r,this.state===a?e:t,this.outcome):this.queue.push(new h(r,e,t));return r},h.prototype.callFulfilled=function(e){l.resolve(this.promise,e)},h.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},h.prototype.callRejected=function(e){l.reject(this.promise,e)},h.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},l.resolve=function(e,t){var r=p(c,t);if("error"===r.status)return l.reject(e,r.value);var n=r.value;if(n)d(e,n);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},l.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},o.resolve=function(e){if(e instanceof this)return e;return l.resolve(new this(u),e)},o.reject=function(e){var t=new this(u);return l.reject(t,e)},o.all=function(e){var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var s=new Array(n),a=0,t=-1,o=new this(u);for(;++t<n;)h(e[t],t);return o;function h(e,t){r.resolve(e).then(function(e){s[t]=e,++a!==n||i||(i=!0,l.resolve(o,s))},function(e){i||(i=!0,l.reject(o,e))})}},o.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var i=-1,s=new this(u);for(;++i<r;)a=e[i],t.resolve(a).then(function(e){n||(n=!0,l.resolve(s,e))},function(e){n||(n=!0,l.reject(s,e))});var a;return s}},{immediate:36}],38:[function(e,t,r){"use strict";var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){"use strict";var a=e("./zlib/deflate"),o=e("./utils/common"),h=e("./utils/strings"),i=e("./zlib/messages"),s=e("./zlib/zstream"),u=Object.prototype.toString,l=0,f=-1,c=0,d=8;function p(e){if(!(this instanceof p))return new p(e);this.options=o.assign({level:f,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==l)throw new Error(i[r]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?h.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=a.deflateSetDictionary(this.strm,n))!==l)throw new Error(i[r]);this._dict_set=!0}}function n(e,t){var r=new p(t);if(r.push(e,!0),r.err)throw r.msg||i[r.err];return r.result}p.prototype.push=function(e,t){var r,n,i=this.strm,s=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=h.string2buf(e):"[object ArrayBuffer]"===u.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new o.Buf8(s),i.next_out=0,i.avail_out=s),1!==(r=a.deflate(i,n))&&r!==l)return this.onEnd(r),!(this.ended=!0);0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(h.buf2binstring(o.shrinkBuf(i.output,i.next_out))):this.onData(o.shrinkBuf(i.output,i.next_out)))}while((0<i.avail_in||0===i.avail_out)&&1!==r);return 4===n?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l):2!==n||(this.onEnd(l),!(i.avail_out=0))},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=p,r.deflate=n,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){"use strict";var c=e("./zlib/inflate"),d=e("./utils/common"),p=e("./utils/strings"),m=e("./zlib/constants"),n=e("./zlib/messages"),i=e("./zlib/zstream"),s=e("./zlib/gzheader"),_=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var r=c.inflateInit2(this.strm,t.windowBits);if(r!==m.Z_OK)throw new Error(n[r]);this.header=new s,c.inflateGetHeader(this.strm,this.header)}function o(e,t){var r=new a(t);if(r.push(e,!0),r.err)throw r.msg||n[r.err];return r.result}a.prototype.push=function(e,t){var r,n,i,s,a,o,h=this.strm,u=this.options.chunkSize,l=this.options.dictionary,f=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?m.Z_FINISH:m.Z_NO_FLUSH,"string"==typeof e?h.input=p.binstring2buf(e):"[object ArrayBuffer]"===_.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new d.Buf8(u),h.next_out=0,h.avail_out=u),(r=c.inflate(h,m.Z_NO_FLUSH))===m.Z_NEED_DICT&&l&&(o="string"==typeof l?p.string2buf(l):"[object ArrayBuffer]"===_.call(l)?new Uint8Array(l):l,r=c.inflateSetDictionary(this.strm,o)),r===m.Z_BUF_ERROR&&!0===f&&(r=m.Z_OK,f=!1),r!==m.Z_STREAM_END&&r!==m.Z_OK)return this.onEnd(r),!(this.ended=!0);h.next_out&&(0!==h.avail_out&&r!==m.Z_STREAM_END&&(0!==h.avail_in||n!==m.Z_FINISH&&n!==m.Z_SYNC_FLUSH)||("string"===this.options.to?(i=p.utf8border(h.output,h.next_out),s=h.next_out-i,a=p.buf2string(h.output,i),h.next_out=s,h.avail_out=u-s,s&&d.arraySet(h.output,h.output,i,s,0),this.onData(a)):this.onData(d.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(f=!0)}while((0<h.avail_in||0===h.avail_out)&&r!==m.Z_STREAM_END);return r===m.Z_STREAM_END&&(n=m.Z_FINISH),n===m.Z_FINISH?(r=c.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===m.Z_OK):n!==m.Z_SYNC_FLUSH||(this.onEnd(m.Z_OK),!(h.avail_out=0))},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===m.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=a,r.inflate=o,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},r.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){var t,r,n,i,s,a;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)s=e[t],a.set(s,i),i+=s.length;return a}},s={arraySet:function(e,t,r,n,i){for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],42:[function(e,t,r){"use strict";var h=e("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var u=new h.Buf8(256),n=0;n<256;n++)u[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function l(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,h.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}u[254]=u[254]=1,r.string2buf=function(e){var t,r,n,i,s,a=e.length,o=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new h.Buf8(o),i=s=0;s<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t},r.buf2binstring=function(e){return l(e,e.length)},r.binstring2buf=function(e){for(var t=new h.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,s,a=t||e.length,o=new Array(2*a);for(r=n=0;r<a;)if((i=e[r++])<128)o[n++]=i;else if(4<(s=u[i]))o[n++]=65533,r+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&r<a;)i=i<<6|63&e[r++],s--;1<s?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return l(o,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+u[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,s=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(i=i+t[n++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16|0}},{}],44:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){"use strict";var o=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,n){var i=o,s=n+r;e^=-1;for(var a=n;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,r){"use strict";var h,c=e("../utils/common"),u=e("./trees"),d=e("./adler32"),p=e("./crc32"),n=e("./messages"),l=0,f=4,m=0,_=-2,g=-1,b=4,i=2,v=8,y=9,s=286,a=30,o=19,w=2*s+1,k=15,x=3,S=258,z=S+x+1,C=42,E=113,A=1,I=2,O=3,B=4;function R(e,t){return e.msg=n[t],t}function T(e){return(e<<1)-(4<e?9:0)}function D(e){for(var t=e.length;0<=--t;)e[t]=0}function F(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(c.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function N(e,t){u._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,F(e.strm)}function U(e,t){e.pending_buf[e.pending++]=t}function P(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function L(e,t){var r,n,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,h=e.strstart>e.w_size-z?e.strstart-(e.w_size-z):0,u=e.window,l=e.w_mask,f=e.prev,c=e.strstart+S,d=u[s+a-1],p=u[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(r=t)+a]===p&&u[r+a-1]===d&&u[r]===u[s]&&u[++r]===u[s+1]){s+=2,r++;do{}while(u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&u[++s]===u[++r]&&s<c);if(n=S-(c-s),s=c-S,a<n){if(e.match_start=t,o<=(a=n))break;d=u[s+a-1],p=u[s+a]}}}while((t=f[t&l])>h&&0!=--i);return a<=e.lookahead?a:e.lookahead}function j(e){var t,r,n,i,s,a,o,h,u,l,f=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-z)){for(c.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=r=e.hash_size;n=e.head[--t],e.head[t]=f<=n?n-f:0,--r;);for(t=r=f;n=e.prev[--t],e.prev[t]=f<=n?n-f:0,--r;);i+=f}if(0===e.strm.avail_in)break;if(a=e.strm,o=e.window,h=e.strstart+e.lookahead,u=i,l=void 0,l=a.avail_in,u<l&&(l=u),r=0===l?0:(a.avail_in-=l,c.arraySet(o,a.input,a.next_in,l,h),1===a.state.wrap?a.adler=d(a.adler,o,l,h):2===a.state.wrap&&(a.adler=p(a.adler,o,l,h)),a.next_in+=l,a.total_in+=l,l),e.lookahead+=r,e.lookahead+e.insert>=x)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+x-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<x)););}while(e.lookahead<z&&0!==e.strm.avail_in)}function Z(e,t){for(var r,n;;){if(e.lookahead<z){if(j(e),e.lookahead<z&&t===l)return A;if(0===e.lookahead)break}if(r=0,e.lookahead>=x&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-z&&(e.match_length=L(e,r)),e.match_length>=x)if(n=u._tr_tally(e,e.strstart-e.match_start,e.match_length-x),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=x){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=e.strstart<x-1?e.strstart:x-1,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}function W(e,t){for(var r,n,i;;){if(e.lookahead<z){if(j(e),e.lookahead<z&&t===l)return A;if(0===e.lookahead)break}if(r=0,e.lookahead>=x&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=x-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-z&&(e.match_length=L(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===x&&4096<e.strstart-e.match_start)&&(e.match_length=x-1)),e.prev_length>=x&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-x,n=u._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-x),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=x-1,e.strstart++,n&&(N(e,!1),0===e.strm.avail_out))return A}else if(e.match_available){if((n=u._tr_tally(e,0,e.window[e.strstart-1]))&&N(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return A}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=u._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<x-1?e.strstart:x-1,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}function M(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new c.Buf16(2*w),this.dyn_dtree=new c.Buf16(2*(2*a+1)),this.bl_tree=new c.Buf16(2*(2*o+1)),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new c.Buf16(k+1),this.heap=new c.Buf16(2*s+1),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new c.Buf16(2*s+1),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function G(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=i,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?C:E,e.adler=2===t.wrap?0:1,t.last_flush=l,u._tr_init(t),m):R(e,_)}function K(e){var t=G(e);return t===m&&function(e){e.window_size=2*e.w_size,D(e.head),e.max_lazy_match=h[e.level].max_lazy,e.good_match=h[e.level].good_length,e.nice_match=h[e.level].nice_length,e.max_chain_length=h[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=x-1,e.match_available=0,e.ins_h=0}(e.state),t}function Y(e,t,r,n,i,s){if(!e)return _;var a=1;if(t===g&&(t=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||y<i||r!==v||n<8||15<n||t<0||9<t||s<0||b<s)return R(e,_);8===n&&(n=9);var o=new H;return(e.state=o).strm=e,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+x-1)/x),o.window=new c.Buf8(2*o.w_size),o.head=new c.Buf16(o.hash_size),o.prev=new c.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new c.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=s,o.method=r,K(e)}h=[new M(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(j(e),0===e.lookahead&&t===l)return A;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,N(e,!1),0===e.strm.avail_out))return A;if(e.strstart-e.block_start>=e.w_size-z&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):(e.strstart>e.block_start&&(N(e,!1),e.strm.avail_out),A)}),new M(4,4,8,4,Z),new M(4,5,16,8,Z),new M(4,6,32,32,Z),new M(4,4,16,16,W),new M(8,16,32,32,W),new M(8,16,128,128,W),new M(8,32,128,256,W),new M(32,128,258,1024,W),new M(32,258,258,4096,W)],r.deflateInit=function(e,t){return Y(e,t,v,15,8,0)},r.deflateInit2=Y,r.deflateReset=K,r.deflateResetKeep=G,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?_:(e.state.gzhead=t,m):_},r.deflate=function(e,t){var r,n,i,s;if(!e||!e.state||5<t||t<0)return e?R(e,_):_;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==f)return R(e,0===e.avail_out?-5:_);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===C)if(2===n.wrap)e.adler=0,U(n,31),U(n,139),U(n,8),n.gzhead?(U(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),U(n,255&n.gzhead.time),U(n,n.gzhead.time>>8&255),U(n,n.gzhead.time>>16&255),U(n,n.gzhead.time>>24&255),U(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),U(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(U(n,255&n.gzhead.extra.length),U(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=p(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(U(n,0),U(n,0),U(n,0),U(n,0),U(n,0),U(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),U(n,3),n.status=E);else{var a=v+(n.w_bits-8<<4)<<8;a|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=E,P(n,a),0!==n.strstart&&(P(n,e.adler>>>16),P(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending!==n.pending_buf_size));)U(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,U(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),F(e),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,U(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>i&&(e.adler=p(e.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&F(e),n.pending+2<=n.pending_buf_size&&(U(n,255&e.adler),U(n,e.adler>>8&255),e.adler=0,n.status=E)):n.status=E),0!==n.pending){if(F(e),0===e.avail_out)return n.last_flush=-1,m}else if(0===e.avail_in&&T(t)<=T(r)&&t!==f)return R(e,-5);if(666===n.status&&0!==e.avail_in)return R(e,-5);if(0!==e.avail_in||0!==n.lookahead||t!==l&&666!==n.status){var o=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(j(e),0===e.lookahead)){if(t===l)return A;break}if(e.match_length=0,r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}(n,t):3===n.strategy?function(e,t){for(var r,n,i,s,a=e.window;;){if(e.lookahead<=S){if(j(e),e.lookahead<=S&&t===l)return A;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=x&&0<e.strstart&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){s=e.strstart+S;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s);e.match_length=S-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=x?(r=u._tr_tally(e,1,e.match_length-x),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=u._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(N(e,!1),0===e.strm.avail_out))return A}return e.insert=0,t===f?(N(e,!0),0===e.strm.avail_out?O:B):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?A:I}(n,t):h[n.level].func(n,t);if(o!==O&&o!==B||(n.status=666),o===A||o===O)return 0===e.avail_out&&(n.last_flush=-1),m;if(o===I&&(1===t?u._tr_align(n):5!==t&&(u._tr_stored_block(n,0,0,!1),3===t&&(D(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),F(e),0===e.avail_out))return n.last_flush=-1,m}return t!==f?m:n.wrap<=0?1:(2===n.wrap?(U(n,255&e.adler),U(n,e.adler>>8&255),U(n,e.adler>>16&255),U(n,e.adler>>24&255),U(n,255&e.total_in),U(n,e.total_in>>8&255),U(n,e.total_in>>16&255),U(n,e.total_in>>24&255)):(P(n,e.adler>>>16),P(n,65535&e.adler)),F(e),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?m:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==C&&69!==t&&73!==t&&91!==t&&103!==t&&t!==E&&666!==t?R(e,_):(e.state=null,t===E?R(e,-3):m):_},r.deflateSetDictionary=function(e,t){var r,n,i,s,a,o,h,u,l=t.length;if(!e||!e.state)return _;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==C||r.lookahead)return _;for(1===s&&(e.adler=d(e.adler,t,l,0)),r.wrap=0,l>=r.w_size&&(0===s&&(D(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new c.Buf8(r.w_size),c.arraySet(u,t,l-r.w_size,r.w_size,0),t=u,l=r.w_size),a=e.avail_in,o=e.next_in,h=e.input,e.avail_in=l,e.next_in=0,e.input=t,j(r);r.lookahead>=x;){for(n=r.strstart,i=r.lookahead-(x-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+x-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--i;);r.strstart=n,r.lookahead=x-1,j(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=x-1,r.match_available=0,e.next_in=o,e.input=h,e.avail_in=a,r.wrap=s,m},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,s,a,o,h,u,l,f,c,d,p,m,_,g,b,v,y,w,k,x,S,z,C;r=e.state,n=e.next_in,z=e.input,i=n+(e.avail_in-5),s=e.next_out,C=e.output,a=s-(t-e.avail_out),o=s+(e.avail_out-257),h=r.dmax,u=r.wsize,l=r.whave,f=r.wnext,c=r.window,d=r.hold,p=r.bits,m=r.lencode,_=r.distcode,g=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;e:do{p<15&&(d+=z[n++]<<p,p+=8,d+=z[n++]<<p,p+=8),v=m[d&g];t:for(;;){if(d>>>=y=v>>>24,p-=y,0===(y=v>>>16&255))C[s++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=m[(65535&v)+(d&(1<<y)-1)];continue t}if(32&y){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}w=65535&v,(y&=15)&&(p<y&&(d+=z[n++]<<p,p+=8),w+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=z[n++]<<p,p+=8,d+=z[n++]<<p,p+=8),v=_[d&b];r:for(;;){if(d>>>=y=v>>>24,p-=y,!(16&(y=v>>>16&255))){if(0==(64&y)){v=_[(65535&v)+(d&(1<<y)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(k=65535&v,p<(y&=15)&&(d+=z[n++]<<p,(p+=8)<y&&(d+=z[n++]<<p,p+=8)),h<(k+=d&(1<<y)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=y,p-=y,(y=s-a)<k){if(l<(y=k-y)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(S=c,(x=0)===f){if(x+=u-y,y<w){for(w-=y;C[s++]=c[x++],--y;);x=s-k,S=C}}else if(f<y){if(x+=u+f-y,(y-=f)<w){for(w-=y;C[s++]=c[x++],--y;);if(x=0,f<w){for(w-=y=f;C[s++]=c[x++],--y;);x=s-k,S=C}}}else if(x+=f-y,y<w){for(w-=y;C[s++]=c[x++],--y;);x=s-k,S=C}for(;2<w;)C[s++]=S[x++],C[s++]=S[x++],C[s++]=S[x++],w-=3;w&&(C[s++]=S[x++],1<w&&(C[s++]=S[x++]))}else{for(x=s-k;C[s++]=C[x++],C[s++]=C[x++],C[s++]=C[x++],2<(w-=3););w&&(C[s++]=C[x++],1<w&&(C[s++]=C[x++]))}break}}break}}while(n<i&&s<o);n-=w=p>>3,d&=(1<<(p-=w<<3))-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<o?o-s+257:257-(s-o),r.hold=d,r.bits=p}},{}],49:[function(e,t,r){"use strict";var I=e("../utils/common"),O=e("./adler32"),B=e("./crc32"),R=e("./inffast"),T=e("./inftrees"),D=1,F=2,N=0,U=-2,P=1,n=852,i=592;function L(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new I.Buf16(320),this.work=new I.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=P,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new I.Buf32(n),t.distcode=t.distdyn=new I.Buf32(i),t.sane=1,t.back=-1,N):U}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):U}function h(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?U:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):U}function u(e,t){var r,n;return e?(n=new s,(e.state=n).window=null,(r=h(e,t))!==N&&(e.state=null),r):U}var l,f,c=!0;function j(e){if(c){var t;for(l=new I.Buf32(512),f=new I.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(T(D,e.lens,0,288,l,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;T(F,e.lens,0,32,f,0,e.work,{bits:5}),c=!1}e.lencode=l,e.lenbits=9,e.distcode=f,e.distbits=5}function Z(e,t,r,n){var i,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new I.Buf8(s.wsize)),n>=s.wsize?(I.arraySet(s.window,t,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(n<(i=s.wsize-s.wnext)&&(i=n),I.arraySet(s.window,t,r-n,i,s.wnext),(n-=i)?(I.arraySet(s.window,t,r-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}r.inflateReset=o,r.inflateReset2=h,r.inflateResetKeep=a,r.inflateInit=function(e){return u(e,15)},r.inflateInit2=u,r.inflate=function(e,t){var r,n,i,s,a,o,h,u,l,f,c,d,p,m,_,g,b,v,y,w,k,x,S,z,C=0,E=new I.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return U;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,i=e.output,h=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,f=o,c=h,x=N;e:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(2&r.wrap&&35615===u){E[r.check=0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0),l=u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&u)){e.msg="unknown compression method",r.mode=30;break}if(l-=4,k=8+(15&(u>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<k,e.adler=r.check=1,r.mode=512&u?10:12,l=u=0;break;case 2:for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(r.flags=u,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0,r.mode=3;case 3:for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,E[2]=u>>>16&255,E[3]=u>>>24&255,r.check=B(r.check,E,4,0)),l=u=0,r.mode=4;case 4:for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(E[0]=255&u,E[1]=u>>>8&255,r.check=B(r.check,E,2,0)),l=u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(o<(d=r.length)&&(d=o),d&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),I.arraySet(r.head.extra,n,s,d,k)),512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=B(r.check,n,d,s)),o-=d,s+=d,k)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}l=u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}e.adler=r.check=L(u),l=u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){u>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}switch(r.last=1&u,l-=1,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(j(r),r.mode=20,6!==t)break;u>>>=2,l-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&u,l=u=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(d=r.length){if(o<d&&(d=o),h<d&&(d=h),0===d)break e;I.arraySet(i,n,s,d,a),o-=d,s+=d,h-=d,a+=d,r.length-=d;break}r.mode=12;break;case 17:for(;l<14;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.lens[A[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,S={bits:r.lenbits},x=T(0,r.lens,0,19,r.lencode,0,r.work,S),r.lenbits=S.bits,x){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(C=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(b<16)u>>>=_,l-=_,r.lens[r.have++]=b;else{if(16===b){for(z=_+2;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u>>>=_,l-=_,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}k=r.lens[r.have-1],d=3+(3&u),u>>>=2,l-=2}else if(17===b){for(z=_+3;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}l-=_,k=0,d=3+(7&(u>>>=_)),u>>>=3,l-=3}else{for(z=_+7;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}l-=_,k=0,d=11+(127&(u>>>=_)),u>>>=7,l-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=k}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,S={bits:r.lenbits},x=T(D,r.lens,0,r.nlen,r.lencode,0,r.work,S),r.lenbits=S.bits,x){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,S={bits:r.distbits},x=T(F,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,S),r.distbits=S.bits,x){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=o&&258<=h){e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,R(e,c),a=e.next_out,i=e.output,h=e.avail_out,s=e.next_in,n=e.input,o=e.avail_in,u=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;g=(C=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(g&&0==(240&g)){for(v=_,y=g,w=b;g=(C=r.lencode[w+((u&(1<<v+y)-1)>>v)])>>>16&255,b=65535&C,!(v+(_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}u>>>=v,l-=v,r.back+=v}if(u>>>=_,l-=_,r.back+=_,r.length=b,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=12;break}if(64&g){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(z=r.extra;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(C=r.distcode[u&(1<<r.distbits)-1])>>>16&255,b=65535&C,!((_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(0==(240&g)){for(v=_,y=g,w=b;g=(C=r.distcode[w+((u&(1<<v+y)-1)>>v)])>>>16&255,b=65535&C,!(v+(_=C>>>24)<=l);){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}u>>>=v,l-=v,r.back+=v}if(u>>>=_,l-=_,r.back+=_,64&g){e.msg="invalid distance code",r.mode=30;break}r.offset=b,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(z=r.extra;l<z;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===h)break e;if(d=c-h,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}p=d>r.wnext?(d-=r.wnext,r.wsize-d):r.wnext-d,d>r.length&&(d=r.length),m=r.window}else m=i,p=a-r.offset,d=r.length;for(h<d&&(d=h),h-=d,r.length-=d;i[a++]=m[p++],--d;);0===r.length&&(r.mode=21);break;case 26:if(0===h)break e;i[a++]=r.length,h--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===o)break e;o--,u|=n[s++]<<l,l+=8}if(c-=h,e.total_out+=c,r.total+=c,c&&(e.adler=r.check=r.flags?B(r.check,i,c,a-c):O(r.check,i,c,a-c)),c=h,(r.flags?u:L(u))!==r.check){e.msg="incorrect data check",r.mode=30;break}l=u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break e;o--,u+=n[s++]<<l,l+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}l=u=0}r.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;case 32:default:return U}return e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=o,r.hold=u,r.bits=l,(r.wsize||c!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&Z(e,e.output,e.next_out,c-e.avail_out)?(r.mode=31,-4):(f-=e.avail_in,c-=e.avail_out,e.total_in+=f,e.total_out+=c,r.total+=c,r.wrap&&c&&(e.adler=r.check=r.flags?B(r.check,i,c,e.next_out-c):O(r.check,i,c,e.next_out-c)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==f&&0===c||4===t)&&x===N&&(x=-5),x)},r.inflateEnd=function(e){if(!e||!e.state)return U;var t=e.state;return t.window&&(t.window=null),e.state=null,N},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?U:((r.head=t).done=!1,N):U},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?U:11===r.mode&&O(1,t,n,0)!==r.check?-3:Z(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,N):U},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){"use strict";var D=e("../utils/common"),F=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],U=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],P=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,n,i,s,a,o){var h,u,l,f,c,d,p,m,_,g=o.bits,b=0,v=0,y=0,w=0,k=0,x=0,S=0,z=0,C=0,E=0,A=null,I=0,O=new D.Buf16(16),B=new D.Buf16(16),R=null,T=0;for(b=0;b<=15;b++)O[b]=0;for(v=0;v<n;v++)O[t[r+v]]++;for(k=g,w=15;1<=w&&0===O[w];w--);if(w<k&&(k=w),0===w)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(y=1;y<w&&0===O[y];y++);for(k<y&&(k=y),b=z=1;b<=15;b++)if(z<<=1,(z-=O[b])<0)return-1;if(0<z&&(0===e||1!==w))return-1;for(B[1]=0,b=1;b<15;b++)B[b+1]=B[b]+O[b];for(v=0;v<n;v++)0!==t[r+v]&&(a[B[t[r+v]]++]=v);if(d=0===e?(A=R=a,19):1===e?(A=F,I-=257,R=N,T-=257,256):(A=U,R=P,-1),b=y,c=s,S=v=E=0,l=-1,f=(C=1<<(x=k))-1,1===e&&852<C||2===e&&592<C)return 1;for(;;){for(p=b-S,_=a[v]<d?(m=0,a[v]):a[v]>d?(m=R[T+a[v]],A[I+a[v]]):(m=96,0),h=1<<b-S,y=u=1<<x;i[c+(E>>S)+(u-=h)]=p<<24|m<<16|_|0,0!==u;);for(h=1<<b-1;E&h;)h>>=1;if(0!==h?(E&=h-1,E+=h):E=0,v++,0==--O[b]){if(b===w)break;b=t[r+a[v]]}if(k<b&&(E&f)!==l){for(0===S&&(S=k),c+=y,z=1<<(x=b-S);x+S<w&&!((z-=O[x+S])<=0);)x++,z<<=1;if(C+=1<<x,1===e&&852<C||2===e&&592<C)return 1;i[l=E&f]=k<<24|x<<16|c-s|0}}return 0!==E&&(i[c+E]=b-S<<24|64<<16|0),o.bits=k,0}},{"../utils/common":41}],51:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){"use strict";var i=e("../utils/common"),o=0,h=1;function n(e){for(var t=e.length;0<=--t;)e[t]=0}var s=0,a=29,u=256,l=u+1+a,f=30,c=19,_=2*l+1,g=15,d=16,p=7,m=256,b=16,v=17,y=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=new Array(2*(l+2));n(z);var C=new Array(2*f);n(C);var E=new Array(512);n(E);var A=new Array(256);n(A);var I=new Array(a);n(I);var O,B,R,T=new Array(f);function D(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function F(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function N(e){return e<256?E[e]:E[256+(e>>>7)]}function U(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function P(e,t,r){e.bi_valid>d-r?(e.bi_buf|=t<<e.bi_valid&65535,U(e,e.bi_buf),e.bi_buf=t>>d-e.bi_valid,e.bi_valid+=r-d):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function L(e,t,r){P(e,r[2*t],r[2*t+1])}function j(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function Z(e,t,r){var n,i,s=new Array(g+1),a=0;for(n=1;n<=g;n++)s[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=j(s[o]++,o))}}function W(e){var t;for(t=0;t<l;t++)e.dyn_ltree[2*t]=0;for(t=0;t<f;t++)e.dyn_dtree[2*t]=0;for(t=0;t<c;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*m]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function M(e){8<e.bi_valid?U(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function H(e,t,r,n){var i=2*t,s=2*r;return e[i]<e[s]||e[i]===e[s]&&n[t]<=n[r]}function G(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&H(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!H(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function K(e,t,r){var n,i,s,a,o=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0===n?L(e,i,t):(L(e,(s=A[i])+u+1,t),0!==(a=w[s])&&P(e,i-=I[s],a),L(e,s=N(--n),r),0!==(a=k[s])&&P(e,n-=T[s],a)),o<e.last_lit;);L(e,m,t)}function Y(e,t){var r,n,i,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,h=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=_,r=0;r<h;r++)0!==s[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;1<=r;r--)G(e,s,r);for(i=h;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],G(e,s,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,s[2*i]=s[2*r]+s[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,s[2*r+1]=s[2*n+1]=i,e.heap[1]=i++,G(e,s,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,s,a,o,h=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,f=t.stat_desc.has_stree,c=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(s=0;s<=g;s++)e.bl_count[s]=0;for(h[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<_;r++)p<(s=h[2*h[2*(n=e.heap[r])+1]+1]+1)&&(s=p,m++),h[2*n+1]=s,u<n||(e.bl_count[s]++,a=0,d<=n&&(a=c[n-d]),o=h[2*n],e.opt_len+=o*(s+a),f&&(e.static_len+=o*(l[2*n+1]+a)));if(0!==m){do{for(s=p-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[p]--,m-=2}while(0<m);for(s=p;0!==s;s--)for(n=e.bl_count[s];0!==n;)u<(i=e.heap[--r])||(h[2*i+1]!==s&&(e.opt_len+=(s-h[2*i+1])*h[2*i],h[2*i+1]=s),n--)}}(e,t),Z(s,u,e.bl_count)}function X(e,t,r){var n,i,s=-1,a=t[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++o<h&&i===a||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[2*b]++):o<=10?e.bl_tree[2*v]++:e.bl_tree[2*y]++,s=i,u=(o=0)===a?(h=138,3):i===a?(h=6,3):(h=7,4))}function V(e,t,r){var n,i,s=-1,a=t[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++o<h&&i===a)){if(o<u)for(;L(e,i,e.bl_tree),0!=--o;);else 0!==i?(i!==s&&(L(e,i,e.bl_tree),o--),L(e,b,e.bl_tree),P(e,o-3,2)):o<=10?(L(e,v,e.bl_tree),P(e,o-3,3)):(L(e,y,e.bl_tree),P(e,o-11,7));s=i,u=(o=0)===a?(h=138,3):i===a?(h=6,3):(h=7,4)}}n(T);var q=!1;function J(e,t,r,n){P(e,(s<<1)+(n?1:0),3),function(e,t,r,n){M(e),n&&(U(e,r),U(e,~r)),i.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){q||(function(){var e,t,r,n,i,s=new Array(g+1);for(n=r=0;n<a-1;n++)for(I[n]=r,e=0;e<1<<w[n];e++)A[r++]=n;for(A[r-1]=n,n=i=0;n<16;n++)for(T[n]=i,e=0;e<1<<k[n];e++)E[i++]=n;for(i>>=7;n<f;n++)for(T[n]=i<<7,e=0;e<1<<k[n]-7;e++)E[256+i++]=n;for(t=0;t<=g;t++)s[t]=0;for(e=0;e<=143;)z[2*e+1]=8,e++,s[8]++;for(;e<=255;)z[2*e+1]=9,e++,s[9]++;for(;e<=279;)z[2*e+1]=7,e++,s[7]++;for(;e<=287;)z[2*e+1]=8,e++,s[8]++;for(Z(z,l+1,s),e=0;e<f;e++)C[2*e+1]=5,C[2*e]=j(e,5);O=new D(z,w,u+1,l,g),B=new D(C,k,0,f,g),R=new D(new Array(0),x,0,c,p)}(),q=!0),e.l_desc=new F(e.dyn_ltree,O),e.d_desc=new F(e.dyn_dtree,B),e.bl_desc=new F(e.bl_tree,R),e.bi_buf=0,e.bi_valid=0,W(e)},r._tr_stored_block=J,r._tr_flush_block=function(e,t,r,n){var i,s,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return h;for(t=32;t<u;t++)if(0!==e.dyn_ltree[2*t])return h;return o}(e)),Y(e,e.l_desc),Y(e,e.d_desc),a=function(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),Y(e,e.bl_desc),t=c-1;3<=t&&0===e.bl_tree[2*S[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==t?J(e,t,r,n):4===e.strategy||s===i?(P(e,2+(n?1:0),3),K(e,z,C)):(P(e,4+(n?1:0),3),function(e,t,r,n){var i;for(P(e,t-257,5),P(e,r-1,5),P(e,n-4,4),i=0;i<n;i++)P(e,e.bl_tree[2*S[i]+1],3);V(e,e.dyn_ltree,t-1),V(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),K(e,e.dyn_ltree,e.dyn_dtree)),W(e),n&&M(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(A[r]+u+1)]++,e.dyn_dtree[2*N(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){P(e,2,3),L(e,m,z),function(e){16===e.bi_valid?(U(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,r){(function(e){!function(r,n){"use strict";if(!r.setImmediate){var i,s,t,a,o=1,h={},u=!1,l=r.document,e=Object.getPrototypeOf&&Object.getPrototypeOf(r);e=e&&e.setTimeout?e:r,i="[object process]"==={}.toString.call(r.process)?function(e){process.nextTick(function(){c(e)})}:function(){if(r.postMessage&&!r.importScripts){var e=!0,t=r.onmessage;return r.onmessage=function(){e=!1},r.postMessage("","*"),r.onmessage=t,e}}()?(a="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",d,!1):r.attachEvent("onmessage",d),function(e){r.postMessage(a+e,"*")}):r.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){c(e.data)},function(e){t.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(s=l.documentElement,function(e){var t=l.createElement("script");t.onreadystatechange=function(){c(e),t.onreadystatechange=null,s.removeChild(t),t=null},s.appendChild(t)}):function(e){setTimeout(c,0,e)},e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var n={callback:e,args:t};return h[o]=n,i(o),o++},e.clearImmediate=f}function f(e){delete h[e]}function c(e){if(u)setTimeout(c,0,e);else{var t=h[e];if(t){u=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{f(e),u=!1}}}}function d(e){e.source===r&&"string"==typeof e.data&&0===e.data.indexOf(a)&&c(+e.data.slice(a.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)});

  </script>

  <script>
    const tests = [{"testId":"[firefox] signInTest.spec.ts::Login with valid credentials","title":"Login with valid credentials","file":"signInTest.spec.ts","status":"passed","duration":2377,"retry":0,"steps":[{"title":"Launch browser","duration":627,"category":"pw:api"},{"title":"Create context","duration":102,"category":"pw:api"},{"title":"Create page","duration":1392,"category":"pw:api","isSlowest":true},{"title":"Navigate to \"/\"","duration":534,"category":"pw:api"},{"title":"Fill \"standard_user\" locator('#user-name')","duration":102,"category":"pw:api"},{"title":"Fill \"secret_sauce\" locator('#password')","duration":30,"category":"pw:api"},{"title":"Click locator('#login-button')","duration":145,"category":"pw:api"},{"title":"Close context","duration":37,"category":"pw:api"}],"history":[],"suite":"signInTest.spec.ts","suites":["signInTest.spec.ts"],"browser":"firefox","project":"firefox","outcome":"expected","expectedStatus":"passed","flakinessIndicator":" New","performanceTrend":" Baseline","retryInfo":{"totalRetries":0,"passedOnRetry":-1,"failedRetries":0,"retryPattern":[true],"needsAttention":false},"stabilityScore":{"overall":100,"flakiness":100,"performance":100,"reliability":100,"grade":"A","needsAttention":false},"attachments":{"screenshots":[],"videos":[],"traces":[],"custom":[]}}];
    const stats = {"passed":1,"failed":0,"skipped":0,"flaky":0,"slow":0,"newTests":1,"total":1,"passRate":100,"gradeA":1,"gradeB":0,"gradeC":0,"gradeD":0,"gradeF":0,"totalDuration":5123};
    const traceViewerEnabled = true;
    const historyDrilldownEnabled = false;
    const historyRunSnapshots = {};
    const detailsBodyCache = new WeakMap();
    let currentView = 'overview';
    let selectedTestId = null;
    let currentTestTab = 'all';

    /* ============================================
       APP SHELL NAVIGATION
    ============================================ */

    function toggleSidebar() {
      const appShell = document.querySelector('.app-shell');
      const toggleBtn = document.querySelector('.sidebar-toggle');

      // Same collapse behavior for all screen sizes
      appShell.classList.toggle('sidebar-collapsed');
      const isExpanded = !appShell.classList.contains('sidebar-collapsed');
      if (toggleBtn) toggleBtn.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');
    }

    function switchView(view) {
      // Update nav items and ARIA states
      document.querySelectorAll('.nav-item').forEach(item => {
        const isActive = item.dataset.view === view;
        item.classList.toggle('active', isActive);
        item.setAttribute('aria-selected', isActive ? 'true' : 'false');
      });

      // Hide all view panels
      document.querySelectorAll('.view-panel').forEach(panel => {
        panel.style.display = 'none';
      });

      // Show selected view
      const viewPanel = document.getElementById('view-' + view);
      if (viewPanel) {
        viewPanel.style.display = 'block';
      }

      // Update breadcrumb
      const breadcrumbDetail = document.getElementById('breadcrumb-detail');
      if (breadcrumbDetail) {
        breadcrumbDetail.textContent = view.charAt(0).toUpperCase() + view.slice(1);
      }

      currentView = view;
    }

    // Track global historical run selection
    let globalHistoricalRunId = null;
    let globalHistoricalRunLabel = '';

    function loadHistoricalRun(runId, label) {
      if (!historyDrilldownEnabled) {
        alert('History drilldown is not enabled. Set enableHistoryDrilldown: true in reporter options.');
        return;
      }

      const runData = historyRunSnapshots[runId];
      if (!runData || !runData.tests) {
        alert('No snapshot data available for this run. Historical snapshots may not have been saved for this run.');
        return;
      }

      // Set global historical run
      globalHistoricalRunId = runId;
      globalHistoricalRunLabel = label;

      // Show history banner
      showGlobalHistoryBanner(label);

      // Switch to tests view
      switchView('tests');
      switchTestTab('all');

      // Auto-select the first test to show historical data
      const firstTestItem = document.querySelector('.test-list-item');
      if (firstTestItem) {
        const testId = firstTestItem.id.replace('list-item-', '');
        selectTest(testId);
      }
    }

    function showGlobalHistoryBanner(label) {
      const viewHeader = document.querySelector('#view-tests .view-header');
      if (viewHeader) {
        let historyBanner = viewHeader.querySelector('.history-banner');
        if (!historyBanner) {
          historyBanner = document.createElement('div');
          historyBanner.className = 'history-banner';
          viewHeader.appendChild(historyBanner);
        }
        historyBanner.innerHTML = `
          <span class="history-banner-icon"></span>
          <span class="history-banner-text">Viewing run: <strong>${label}</strong>  Each test shows this run's data. Use per-test history dots to compare.</span>
          <button class="history-banner-close" onclick="exitGlobalHistoricalView()">Back to Current Run</button>
        `;
        historyBanner.style.display = 'flex';
      }
    }

    function exitGlobalHistoricalView() {
      globalHistoricalRunId = null;
      globalHistoricalRunLabel = '';

      // Hide history banner
      const historyBanner = document.querySelector('.history-banner');
      if (historyBanner) {
        historyBanner.style.display = 'none';
      }

      // Reset all test cards to current state
      document.querySelectorAll('.test-card').forEach(card => {
        const testIdEl = card.querySelector('.history-dot[data-testid]');
        const testId = testIdEl ? testIdEl.getAttribute('data-testid') : null;
        if (testId) {
          resetCardToCurrentState(card, testId);
        }
      });

      // Re-select current test to refresh detail panel
      if (selectedTestId) {
        selectTest(selectedTestId);
      }
    }

    function resetCardToCurrentState(card, testId) {
      const details = card.querySelector('.test-details');
      const body = details ? details.querySelector('[data-details-body]') : null;
      if (body) {
        const original = detailsBodyCache.get(body);
        if (typeof original === 'string') {
          body.innerHTML = original;
        }
      }
      clearSelectedDots(card);
      clearSelectedDurationBars(card);
      showBackButton(card, false);
      restoreTrendUI(card, testId);
    }

    function applyHistoricalRunToCard(card, testId, runId) {
      const runData = getRunSnapshot(runId);
      const snapshot = runData && runData.tests ? runData.tests[testId] : null;
      
      if (!snapshot) {
        // No data for this test in this run - might be a new test
        return false;
      }

      const details = card.querySelector('.test-details');
      const body = details ? details.querySelector('[data-details-body]') : null;
      if (!body) return false;

      // Cache original content
      if (!detailsBodyCache.has(body)) {
        detailsBodyCache.set(body, body.innerHTML);
      }

      // Find and select the appropriate history dot
      const dots = card.querySelectorAll('.history-dot[data-runid]');
      let matchingDot = null;
      dots.forEach(d => {
        if (d.getAttribute('data-runid') === runId) {
          matchingDot = d;
        }
      });

      clearSelectedDots(card);
      clearSelectedDurationBars(card);
      if (matchingDot) {
        matchingDot.classList.add('selected');
      }

      // Render snapshot body
      const testModel = getTestModel(testId);
      const avg = testModel ? computeAvgDurationFromHistory(testModel) : 0;
      body.innerHTML = renderSnapshotBody(snapshot, avg);

      // Update trend UI
      updateTrendUI(card, testId, runId, snapshot.duration);
      showBackButton(card, true);

      return true;
    }

    function switchTestTab(tab) {
      // Update tab buttons and ARIA states
      document.querySelectorAll('.tab-btn').forEach(btn => {
        const isActive = btn.dataset.tab === tab;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
      });

      // Hide all tab content
      document.querySelectorAll('.test-tab-content').forEach(content => {
        content.classList.remove('active');
      });

      // Show selected tab
      const tabContent = document.getElementById('tab-' + tab);
      if (tabContent) {
        tabContent.classList.add('active');
      }

      currentTestTab = tab;
    }

    function selectTest(testId) {
      // Update selection in list
      document.querySelectorAll('.test-list-item').forEach(item => {
        item.classList.toggle('selected', item.id === 'list-item-' + testId);
      });

      // Find test data - use same sanitization as TypeScript sanitizeId()
      const test = tests.find(t => {
        const id = String(t.testId || '').replace(/[^a-zA-Z0-9]/g, '_');
        return id === testId;
      });

      if (!test) {
        return;
      }

      selectedTestId = testId;

      // Get the pre-rendered card from hidden container - use getElementById for reliability
      const cardId = 'card-' + testId;
      const cardHtml = document.getElementById(cardId);
      const detailPanel = document.getElementById('test-detail-panel');

      if (cardHtml && detailPanel) {
        // Clone and display the card
        const clone = cardHtml.cloneNode(true);
        clone.classList.add('expanded');
        clone.style.display = 'block';

        // Make sure test-details is visible
        const details = clone.querySelector('.test-details');
        if (details) {
          details.style.display = 'block';
        }

        // Remove expand icon and onclick since card is always expanded in detail panel
        const expandIcon = clone.querySelector('.expand-icon');
        if (expandIcon) expandIcon.remove();
        const header = clone.querySelector('.test-card-header');
        if (header) header.removeAttribute('onclick');

        detailPanel.innerHTML = '';
        detailPanel.appendChild(clone);

        // If global historical run is set, apply it to this card
        // Use test.testId (original) not testId (sanitized) for snapshot lookup
        if (globalHistoricalRunId) {
          applyHistoricalRunToCard(clone, test.testId, globalHistoricalRunId);
        }

        // Update breadcrumb
        const breadcrumbDetail = document.getElementById('breadcrumb-detail');
        if (breadcrumbDetail) {
          breadcrumbDetail.textContent = test.title;
        }
      } else {
        // Fallback: render basic details if card not found
        const detailPanel = document.getElementById('test-detail-panel');
        if (detailPanel) {
          const statusClass = test.status === 'passed' ? 'passed' : test.status === 'skipped' ? 'skipped' : 'failed';
          detailPanel.innerHTML = `
            <div class="detail-view-content">
              <div class="detail-view-header">
                <div class="detail-status-indicator ${statusClass}"></div>
                <div class="detail-info">
                  <h2 class="detail-title">${escapeHtmlUnsafe(test.title)}</h2>
                  <div class="detail-file">${escapeHtmlUnsafe(test.file)}</div>
                </div>
                <div class="detail-duration">${formatDurationMs(test.duration)}</div>
              </div>
              ${test.error ? `
                <div class="detail-section">
                  <div class="detail-label"><span class="icon"></span> Error</div>
                  <div class="error-box">${escapeHtmlUnsafe(test.error)}</div>
                </div>
              ` : ''}
              ${test.steps && test.steps.length > 0 ? `
                <div class="detail-section">
                  <div class="detail-label"><span class="icon"></span> Steps (${test.steps.length})</div>
                  <div class="steps-container">
                    ${test.steps.map(step => `
                      <div class="step-row ${step.isSlowest ? 'slowest' : ''}">
                        <span class="step-title">${escapeHtmlUnsafe(step.title)}</span>
                        <span class="step-duration">${formatDurationMs(step.duration)}</span>
                      </div>
                    `).join('')}
                  </div>
                </div>
              ` : ''}
              ${test.aiSuggestion ? `
                <div class="detail-section">
                  <div class="detail-label"><span class="icon"></span> AI Suggestion</div>
                  <div class="ai-box">${escapeHtmlUnsafe(test.aiSuggestion)}</div>
                </div>
              ` : ''}
            </div>
          `;
        }
      }
    }

    function filterByFile(file) {
      // Clear all filters first
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.classList.remove('active');
      });
      document.querySelector('.filter-chip[data-filter="all"]')?.classList.add('active');

      // Switch to tests view
      switchView('tests');

      // Filter test list items by file
      document.querySelectorAll('.test-list-item').forEach(item => {
        const itemFile = item.dataset.file;
        item.style.display = (itemFile === file) ? 'flex' : 'none';
      });

      // Update active file in tree
      document.querySelectorAll('.file-tree-item').forEach(item => {
        item.classList.toggle('active', item.dataset.file === file);
      });
    }

    function filterByStatus(status) {
      // Switch to tests view first
      switchView('tests');

      // Clear all filters and activate the matching status filter
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.classList.remove('active');
        chip.setAttribute('aria-pressed', 'false');
      });

      // Find and activate the matching status filter chip
      const statusChip = document.querySelector('.filter-chip[data-filter="' + status + '"]');
      if (statusChip) {
        statusChip.classList.add('active');
        statusChip.setAttribute('aria-pressed', 'true');
      }

      // Apply filter to test cards and list items
      applyFilters();
    }

    /* ============================================
       SEARCH FUNCTIONALITY
    ============================================ */

    function openSearch() {
      const modal = document.getElementById('search-modal');
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
      document.getElementById('search-modal-input').focus();
    }

    function closeSearch() {
      const modal = document.getElementById('search-modal');
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
      document.getElementById('search-modal-input').value = '';
      document.getElementById('search-modal-results').innerHTML = '';
    }

    function handleSearchInput(query) {
      const resultsContainer = document.getElementById('search-modal-results');
      if (!query.trim()) {
        resultsContainer.innerHTML = '';
        return;
      }

      const lowerQuery = query.toLowerCase();
      const matches = tests.filter(t => {
        return t.title.toLowerCase().includes(lowerQuery) ||
               t.file.toLowerCase().includes(lowerQuery);
      }).slice(0, 10);

      resultsContainer.innerHTML = matches.map(t => {
        const statusClass = t.status === 'passed' ? 'passed' : t.status === 'skipped' ? 'skipped' : 'failed';
        // Use same sanitizeId logic as TypeScript: replace all non-alphanumeric with underscore
        const testId = String(t.testId || '').replace(/[^a-zA-Z0-9]/g, '_');
        return `
          <div class="search-result-item" onclick="selectSearchResult('${testId}')">
            <div class="status-dot ${statusClass}"></div>
            <div class="search-result-info">
              <div class="search-result-title">${escapeHtmlUnsafe(t.title)}</div>
              <div class="search-result-file">${escapeHtmlUnsafe(t.file)}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function selectSearchResult(testId) {
      closeSearch();
      switchView('tests');
      selectTest(testId);
    }

    /* ============================================
       FILTER FUNCTIONALITY (updated for new layout)
    ============================================ */

    function searchTests(query) {
      const lowerQuery = query.toLowerCase();

      // Filter test list items
      document.querySelectorAll('.test-list-item').forEach(item => {
        const title = item.querySelector('.test-item-title')?.textContent?.toLowerCase() || '';
        const file = item.querySelector('.test-item-file')?.textContent?.toLowerCase() || '';
        const matches = title.includes(lowerQuery) || file.includes(lowerQuery);
        item.style.display = matches ? 'flex' : 'none';
      });

      // Also handle old test-card format for grouped view
      document.querySelectorAll('.test-card').forEach(card => {
        const title = card.querySelector('.test-title')?.textContent?.toLowerCase() || '';
        const file = card.querySelector('.test-file')?.textContent?.toLowerCase() || '';
        const matches = title.includes(lowerQuery) || file.includes(lowerQuery);
        card.style.display = matches ? 'block' : 'none';
      });

      // Also show/hide file groups if all tests are hidden
      document.querySelectorAll('.file-group').forEach(group => {
        const hasVisible = Array.from(group.querySelectorAll('.test-card')).some(
          card => card.style.display !== 'none'
        );
        group.style.display = hasVisible ? 'block' : 'none';
      });

      // Check for empty state
      checkEmptyState();
    }

    // Active filters state - organized by group
    const activeFilters = {
      attention: new Set(),
      status: new Set(),
      health: new Set(),
      grade: new Set(),
      suite: new Set(),
      tag: new Set()
    };

    function toggleFilter(chip) {
      const filter = chip.dataset.filter;
      const group = chip.dataset.group;

      // Toggle the filter in the appropriate group
      if (activeFilters[group].has(filter)) {
        activeFilters[group].delete(filter);
        chip.classList.remove('active');
        chip.setAttribute('aria-pressed', 'false');
      } else {
        activeFilters[group].add(filter);
        chip.classList.add('active');
        chip.setAttribute('aria-pressed', 'true');
      }

      applyFilters();
    }

    function clearAllFilters() {
      activeFilters.attention.clear();
      activeFilters.status.clear();
      activeFilters.health.clear();
      activeFilters.grade.clear();
      activeFilters.suite.clear();
      activeFilters.tag.clear();
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.classList.remove('active');
        chip.setAttribute('aria-pressed', 'false');
      });
      applyFilters();
    }

    function applyFilters() {
      const hasAttentionFilters = activeFilters.attention.size > 0;
      const hasStatusFilters = activeFilters.status.size > 0;
      const hasHealthFilters = activeFilters.health.size > 0;
      const hasGradeFilters = activeFilters.grade.size > 0;
      const hasSuiteFilters = activeFilters.suite.size > 0;
      const hasTagFilters = activeFilters.tag.size > 0;
      const hasAnyFilter = hasAttentionFilters || hasStatusFilters || hasHealthFilters || hasGradeFilters || hasSuiteFilters || hasTagFilters;

      // Helper to check if element matches suite filter
      function matchesSuiteFilter(el) {
        if (!hasSuiteFilters) return true;
        const suiteData = el.dataset.suite || '';
        const suitesData = el.dataset.suites || '';
        for (const filter of activeFilters.suite) {
          const suiteName = filter.replace('suite-', '');
          if (suiteData === suiteName || suitesData.split(',').includes(suiteName)) return true;
        }
        return false;
      }

      // Helper to check if element matches tag filter
      function matchesTagFilter(el) {
        if (!hasTagFilters) return true;
        const tagsData = el.dataset.tags || '';
        const tags = tagsData.split(',').filter(t => t);
        for (const filter of activeFilters.tag) {
          const tagName = filter.replace('tag-', '');
          if (tags.includes(tagName)) return true;
        }
        return false;
      }

      // Filter test list items
      document.querySelectorAll('.test-list-item').forEach(item => {
        const status = item.dataset.status;
        const isFlaky = item.dataset.flaky === 'true';
        const isSlow = item.dataset.slow === 'true';
        const isNew = item.dataset.new === 'true';
        const isNewFailure = item.dataset.newFailure === 'true';
        const isRegression = item.dataset.regression === 'true';
        const isFixed = item.dataset.fixed === 'true';
        const grade = item.dataset.grade;

        // If no filters active, show all
        if (!hasAnyFilter) {
          item.style.display = 'flex';
          return;
        }

        // Check each filter group (OR within group, AND between groups)
        let matchesAttention = !hasAttentionFilters;
        let matchesStatus = !hasStatusFilters;
        let matchesHealth = !hasHealthFilters;
        let matchesGrade = !hasGradeFilters;

        // Attention group - OR logic
        if (hasAttentionFilters) {
          matchesAttention =
            (activeFilters.attention.has('new-failure') && isNewFailure) ||
            (activeFilters.attention.has('regression') && isRegression) ||
            (activeFilters.attention.has('fixed') && isFixed);
        }

        // Status group - OR logic
        if (hasStatusFilters) {
          matchesStatus =
            (activeFilters.status.has('passed') && status === 'passed') ||
            (activeFilters.status.has('failed') && (status === 'failed' || status === 'timedOut')) ||
            (activeFilters.status.has('skipped') && status === 'skipped');
        }

        // Health group - OR logic
        if (hasHealthFilters) {
          matchesHealth =
            (activeFilters.health.has('flaky') && isFlaky) ||
            (activeFilters.health.has('slow') && isSlow) ||
            (activeFilters.health.has('new') && isNew);
        }

        // Grade group - OR logic
        if (hasGradeFilters) {
          matchesGrade =
            (activeFilters.grade.has('grade-a') && grade === 'A') ||
            (activeFilters.grade.has('grade-b') && grade === 'B') ||
            (activeFilters.grade.has('grade-c') && grade === 'C') ||
            (activeFilters.grade.has('grade-d') && grade === 'D') ||
            (activeFilters.grade.has('grade-f') && grade === 'F');
        }

        // Suite and Tag groups
        const matchesSuite = matchesSuiteFilter(item);
        const matchesTag = matchesTagFilter(item);

        // AND between groups
        const show = matchesAttention && matchesStatus && matchesHealth && matchesGrade && matchesSuite && matchesTag;
        item.style.display = show ? 'flex' : 'none';
      });

      // Also filter test-cards in hidden container and file groups
      document.querySelectorAll('.test-card').forEach(card => {
        const status = card.dataset.status;
        const isFlaky = card.dataset.flaky === 'true';
        const isSlow = card.dataset.slow === 'true';
        const isNew = card.dataset.new === 'true';
        const isNewFailure = card.dataset.newFailure === 'true';
        const isRegression = card.dataset.regression === 'true';
        const isFixed = card.dataset.fixed === 'true';
        const grade = card.dataset.grade;

        if (!hasAnyFilter) {
          card.style.display = 'block';
          return;
        }

        let matchesAttention = !hasAttentionFilters;
        let matchesStatus = !hasStatusFilters;
        let matchesHealth = !hasHealthFilters;
        let matchesGrade = !hasGradeFilters;

        if (hasAttentionFilters) {
          matchesAttention =
            (activeFilters.attention.has('new-failure') && isNewFailure) ||
            (activeFilters.attention.has('regression') && isRegression) ||
            (activeFilters.attention.has('fixed') && isFixed);
        }

        if (hasStatusFilters) {
          matchesStatus =
            (activeFilters.status.has('passed') && status === 'passed') ||
            (activeFilters.status.has('failed') && (status === 'failed' || status === 'timedOut')) ||
            (activeFilters.status.has('skipped') && status === 'skipped');
        }

        if (hasHealthFilters) {
          matchesHealth =
            (activeFilters.health.has('flaky') && isFlaky) ||
            (activeFilters.health.has('slow') && isSlow) ||
            (activeFilters.health.has('new') && isNew);
        }

        if (hasGradeFilters) {
          matchesGrade =
            (activeFilters.grade.has('grade-a') && grade === 'A') ||
            (activeFilters.grade.has('grade-b') && grade === 'B') ||
            (activeFilters.grade.has('grade-c') && grade === 'C') ||
            (activeFilters.grade.has('grade-d') && grade === 'D') ||
            (activeFilters.grade.has('grade-f') && grade === 'F');
        }

        // Suite and Tag groups
        const matchesSuite = matchesSuiteFilter(card);
        const matchesTag = matchesTagFilter(card);

        const show = matchesAttention && matchesStatus && matchesHealth && matchesGrade && matchesSuite && matchesTag;
        card.style.display = show ? 'block' : 'none';
      });

      // Update group visibility
      document.querySelectorAll('.file-group').forEach(group => {
        const hasVisible = Array.from(group.querySelectorAll('.test-list-item, .test-card')).some(
          el => el.style.display !== 'none'
        );
        group.style.display = hasVisible ? 'block' : 'none';
      });

      // Clear file tree selection
      document.querySelectorAll('.file-tree-item').forEach(item => {
        item.classList.remove('active');
      });

      // Check for empty state
      checkEmptyState();
    }

    function checkEmptyState() {
      const visibleItems = document.querySelectorAll('.test-list-item:not([style*="display: none"])');
      const emptyState = document.getElementById('emptyState');
      const tabs = document.querySelectorAll('.test-tab-content');

      if (visibleItems.length === 0) {
        emptyState.style.display = 'flex';
        tabs.forEach(tab => tab.style.opacity = '0.3');
      } else {
        emptyState.style.display = 'none';
        tabs.forEach(tab => tab.style.opacity = '1');
      }
    }

    // Legacy single-filter function for backward compatibility
    function filterTests(filter) {
      switchView('tests');
      clearAllFilters();
      if (filter !== 'all') {
        const chip = document.querySelector('.filter-chip[data-filter="' + filter + '"]');
        if (chip) toggleFilter(chip);
      }
    }

    /* ============================================
       KEYBOARD SHORTCUTS
    ============================================ */

    document.addEventListener('keydown', (e) => {
      // Ignore if typing in input
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        if (e.key === 'Escape') {
          closeSearch();
        }
        return;
      }

      // Command/Ctrl + K for search
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        openSearch();
        return;
      }

      // Command/Ctrl + B for sidebar
      if ((e.metaKey || e.ctrlKey) && e.key === 'b') {
        e.preventDefault();
        toggleSidebar();
        return;
      }

      // Escape to close search
      if (e.key === 'Escape') {
        closeSearch();
      }

      // Arrow navigation in test list
      if (currentView === 'tests') {
        const items = Array.from(document.querySelectorAll('.test-list-item:not([style*="display: none"])'));
        const selectedItem = document.querySelector('.test-list-item.selected');
        let currentIndex = selectedItem ? items.indexOf(selectedItem) : -1;

        if (e.key === 'ArrowDown' || e.key === 'j') {
          e.preventDefault();
          currentIndex = Math.min(currentIndex + 1, items.length - 1);
          if (items[currentIndex]) {
            const testId = items[currentIndex].id.replace('list-item-', '');
            selectTest(testId);
            items[currentIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
          }
        } else if (e.key === 'ArrowUp' || e.key === 'k') {
          e.preventDefault();
          currentIndex = Math.max(currentIndex - 1, 0);
          if (items[currentIndex]) {
            const testId = items[currentIndex].id.replace('list-item-', '');
            selectTest(testId);
            items[currentIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
          }
        }
      }

      // Old keyboard nav for test cards
      const cards = Array.from(document.querySelectorAll('.test-card:not([style*="display: none"])'));
      const focused = document.querySelector('.test-card.keyboard-focus');
      let currentIndex = focused ? cards.indexOf(focused) : -1;

      if (e.key === 'ArrowDown' || e.key === 'j') {
        if (cards.length > 0 && !document.querySelector('.test-list-item.selected')) {
          e.preventDefault();
          if (focused) focused.classList.remove('keyboard-focus');
          currentIndex = Math.min(currentIndex + 1, cards.length - 1);
          if (cards[currentIndex]) {
            cards[currentIndex].classList.add('keyboard-focus');
            cards[currentIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
          }
        }
      } else if (e.key === 'ArrowUp' || e.key === 'k') {
        if (cards.length > 0 && !document.querySelector('.test-list-item.selected')) {
          e.preventDefault();
          if (focused) focused.classList.remove('keyboard-focus');
          currentIndex = Math.max(currentIndex - 1, 0);
          if (cards[currentIndex]) {
            cards[currentIndex].classList.add('keyboard-focus');
            cards[currentIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
          }
        }
      } else if (e.key === 'Enter' && focused) {
        e.preventDefault();
        const header = focused.querySelector('.test-card-header');
        if (header) header.click();
      } else if (e.key === 'Escape' && focused) {
        focused.classList.remove('keyboard-focus');
      }
    });

    /* ============================================
       EXISTING FUNCTIONS (preserved)
    ============================================ */

    function toggleDetails(id, event) {
      // If called from click event, find the parent card from the clicked element
      // This handles cloned cards in the detail panel that share the same ID
      let card;
      if (event && event.currentTarget) {
        card = event.currentTarget.closest('.test-card');
      }
      if (!card) {
        card = document.getElementById('card-' + id);
      }
      if (card) {
        card.classList.toggle('expanded');
      }
    }

    function toggleGroup(groupId) {
      const group = document.getElementById('group-' + groupId);
      group.classList.toggle('collapsed');
    }

    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.classList.toggle('collapsed');
      }
    }

    function toggleNetworkEntry(entryId) {
      const entry = document.querySelector('[data-entry-id="' + entryId + '"]');
      const details = document.getElementById(entryId + '-details');
      if (entry && details) {
        entry.classList.toggle('expanded');
        details.style.display = details.style.display === 'none' ? 'block' : 'none';
      }
    }

    function copyCode(codeId, btn) {
      const codeEl = document.getElementById(codeId);
      if (!codeEl) return;

      const text = codeEl.textContent || '';
      navigator.clipboard.writeText(text).then(() => {
        btn.textContent = 'Copied!';
        btn.classList.add('copied');
        showToast('Copied to clipboard', 'success');
        setTimeout(() => {
          btn.textContent = 'Copy';
          btn.classList.remove('copied');
        }, 2000);
      }).catch(() => {
        btn.textContent = 'Failed';
        showToast('Failed to copy', 'error');
        setTimeout(() => { btn.textContent = 'Copy'; }, 2000);
      });
    }

    function exportJSON() {
      const data = {
        timestamp: new Date().toISOString(),
        summary: {
          total: tests.length,
          passed: tests.filter(t => t.status === 'passed').length,
          failed: tests.filter(t => t.status === 'failed' || t.status === 'timedOut').length,
          skipped: tests.filter(t => t.status === 'skipped').length,
        },
        tests: tests
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'test-results-' + new Date().toISOString().split('T')[0] + '.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast('JSON exported successfully', 'success');
      closeExportMenu();
    }

    // CSV Export
    function exportCSV() {
      const headers = ['Title', 'File', 'Status', 'Duration (ms)', 'Flakiness Score', 'Stability Grade', 'Retries'];
      const rows = tests.map(t => [
        '"' + (t.title || '').replace(/"/g, '""') + '"',
        '"' + (t.file || '').replace(/"/g, '""') + '"',
        t.status || '',
        t.duration || 0,
        t.flakinessScore || '',
        t.stabilityScore?.grade || '',
        t.retry || 0
      ]);

      const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'test-results-' + new Date().toISOString().split('T')[0] + '.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast('CSV exported successfully', 'success');
      closeExportMenu();
    }

    // Export menu toggle
    function toggleExportMenu() {
      const dropdown = document.getElementById('exportDropdown');
      const btn = dropdown.querySelector('.top-bar-btn');
      dropdown.classList.toggle('open');
      btn.setAttribute('aria-expanded', dropdown.classList.contains('open'));
    }

    function closeExportMenu() {
      const dropdown = document.getElementById('exportDropdown');
      const btn = dropdown.querySelector('.top-bar-btn');
      dropdown.classList.remove('open');
      btn.setAttribute('aria-expanded', 'false');
    }

    // Close export menu when clicking outside
    document.addEventListener('click', (e) => {
      const dropdown = document.getElementById('exportDropdown');
      if (dropdown && !dropdown.contains(e.target)) {
        closeExportMenu();
      }
    });

    // Toast notifications
    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast ' + type;

      const icons = { success: '', error: '', info: '' };
      toast.innerHTML = '<span class="toast-icon">' + (icons[type] || icons.info) + '</span><span class="toast-message">' + message + '</span>';

      container.appendChild(toast);

      // Trigger animation
      requestAnimationFrame(() => {
        toast.classList.add('show');
      });

      // Remove after delay
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Theme dropdown menu
    function toggleThemeMenu() {
      const dropdown = document.getElementById('themeDropdown');
      const btn = dropdown.querySelector('.theme-toggle');
      dropdown.classList.toggle('open');
      btn.setAttribute('aria-expanded', dropdown.classList.contains('open'));
    }

    function closeThemeMenu() {
      const dropdown = document.getElementById('themeDropdown');
      const btn = dropdown.querySelector('.theme-toggle');
      dropdown.classList.remove('open');
      btn.setAttribute('aria-expanded', 'false');
    }

    // Close theme menu when clicking outside
    document.addEventListener('click', (e) => {
      const dropdown = document.getElementById('themeDropdown');
      if (dropdown && !dropdown.contains(e.target)) {
        closeThemeMenu();
      }
    });

    function setTheme(theme) {
      const root = document.documentElement;
      const icon = document.getElementById('themeIcon');
      const label = document.getElementById('themeLabel');

      // Update active state in menu
      document.querySelectorAll('.theme-menu-item').forEach(item => {
        item.classList.toggle('active', item.dataset.theme === theme);
      });

      if (theme === 'light') {
        root.setAttribute('data-theme', 'light');
        icon.textContent = '';
        label.textContent = 'Light';
        localStorage.setItem('theme', 'light');
        showToast('Light theme', 'info');
      } else if (theme === 'dark') {
        root.setAttribute('data-theme', 'dark');
        icon.textContent = '';
        label.textContent = 'Dark';
        localStorage.setItem('theme', 'dark');
        showToast('Dark theme', 'info');
      } else {
        // System/auto
        root.removeAttribute('data-theme');
        icon.textContent = '';
        label.textContent = 'System';
        localStorage.setItem('theme', 'system');
        showToast('Using system theme', 'info');
      }

      closeThemeMenu();
    }

    // Initialize theme from localStorage
    (function initTheme() {
      const saved = localStorage.getItem('theme') || 'system';
      const icon = document.getElementById('themeIcon');
      const label = document.getElementById('themeLabel');

      // Update active state in menu
      document.querySelectorAll('.theme-menu-item').forEach(item => {
        item.classList.toggle('active', item.dataset.theme === saved);
      });

      if (saved === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        if (icon) icon.textContent = '';
        if (label) label.textContent = 'Light';
      } else if (saved === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        if (icon) icon.textContent = '';
        if (label) label.textContent = 'Dark';
      } else {
        // System - CSS handles via prefers-color-scheme
        if (icon) icon.textContent = '';
        if (label) label.textContent = 'System';
      }
    })();

    // Auto-scroll secondary charts to show most recent run
    function scrollChartsToRight() {
      document.querySelectorAll('.secondary-trend-chart').forEach(chart => {
        chart.scrollLeft = chart.scrollWidth;
      });
    }

    function escapeHtmlUnsafe(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

	    function formatDurationMs(ms) {
	      const n = Number(ms) || 0;
	      if (n < 1000) return Math.round(n) + 'ms';
	      if (n < 60000) return (n / 1000).toFixed(1) + 's';
	      return (n / 60000).toFixed(1) + 'm';
	    }

	    function getRunSnapshot(runId) {
	      if (!historyRunSnapshots || !runId) return null;
	      return historyRunSnapshots[runId] || null;
	    }

	    function renderSnapshotBody(snapshot, avgDuration) {
	      const parts = [];

	      if (snapshot.steps && snapshot.steps.length > 0) {
	        const max = snapshot.steps.reduce((m, s) => Math.max(m, Number(s.duration) || 0), 0) || 1;
	        const rows = snapshot.steps.map(step => {
	          const w = Math.max(0, Math.min(100, ((Number(step.duration) || 0) / max) * 100));
	          const slowest = step && step.isSlowest ? true : false;
	          return (
	            '<div class="step-row' + (slowest ? ' slowest' : '') + '">' +
	              '<span class="step-title" title="' + escapeHtmlUnsafe(step.title) + '">' + escapeHtmlUnsafe(step.title) + '</span>' +
	              '<div class="step-bar-container"><div class="step-bar" style="width: ' + w.toFixed(1) + '%"></div></div>' +
	              '<span class="step-duration">' + escapeHtmlUnsafe(formatDurationMs(step.duration)) + '</span>' +
	              (slowest ? '<span class="slowest-badge">Slowest</span>' : '') +
	            '</div>'
	          );
	        }).join('');
        parts.push(
          '<div class="detail-section">' +
            '<div class="detail-label"><span class="icon"></span> Step Timings</div>' +
            '<div class="steps-container">' + rows + '</div>' +
	          '</div>'
	        );
	      }

	      if (snapshot.error) {
	        parts.push(
	          '<div class="detail-section">' +
	            '<div class="detail-label"><span class="icon"></span> Error</div>' +
	            '<div class="error-box">' + escapeHtmlUnsafe(snapshot.error) + '</div>' +
	          '</div>'
	        );
	      }

	      if (snapshot.attachments && snapshot.attachments.screenshots && snapshot.attachments.screenshots.length > 0) {
	        const first = snapshot.attachments.screenshots[0];
	        parts.push(
	          '<div class="detail-section">' +
            '<div class="detail-label"><span class="icon"></span> Screenshot</div>' +
            '<div class="screenshot-box">' +
              '<img src="' + escapeHtmlUnsafe(first) + '" alt="Screenshot" onclick="window.open(this.src, \'_blank\')" onerror="this.style.display=\'none\'; this.nextElementSibling.style.display=\'flex\';"/>' +
              '<div class="screenshot-fallback" style="display:none;">' +
                '<span>Image blocked by security policy</span>' +
                '<a href="' + escapeHtmlUnsafe(first) + '" download class="download-btn">Download Screenshot</a>' +
              '</div>' +
            '</div>' +
          '</div>'
        );
      }

      if (snapshot.attachments && snapshot.attachments.videos && snapshot.attachments.videos.length > 0) {
        parts.push(
          '<div class="detail-section">' +
            '<div class="detail-label"><span class="icon"></span> Attachments</div>' +
            '<div class="attachments">' +
              '<a href="file://' + escapeHtmlUnsafe(snapshot.attachments.videos[0]) + '" class="attachment-link" target="_blank"> Video</a>' +
            '</div>' +
          '</div>'
        );
      }

	      if (snapshot.aiSuggestion) {
	        const aiHtml = snapshot.aiSuggestionHtml
	          ? String(snapshot.aiSuggestionHtml)
	          : escapeHtmlUnsafe(snapshot.aiSuggestion);
	        parts.push(
	          '<div class="detail-section">' +
	            '<div class="detail-label"><span class="icon"></span> AI Suggestion</div>' +
	            '<div class="ai-box ai-markdown">' + aiHtml + '</div>' +
	          '</div>'
	        );
	      }

	      if (Number.isFinite(Number(avgDuration)) && Number(avgDuration) > 0) {
	        parts.push(
	          '<div class="duration-compare">Average: ' +
	            escapeHtmlUnsafe(formatDurationMs(avgDuration)) +
	            '  Current: ' +
	            escapeHtmlUnsafe(formatDurationMs(snapshot.duration)) +
	          '</div>'
	        );
	      }

	      if (parts.length === 0) {
	        parts.push('<div class="duration-compare">No additional data recorded for this run.</div>');
	      }

	      return parts.join('');
	    }

	    function showBackButton(card, show) {
	      const btn = card.querySelector('.history-back-btn');
	      if (!btn) return;
	      btn.style.display = show ? 'inline-flex' : 'none';
	    }

	    function clearSelectedDots(card) {
	      card.querySelectorAll('.history-dot.selected').forEach(d => d.classList.remove('selected'));
	    }

	    function clearSelectedDurationBars(card) {
	      card.querySelectorAll('.duration-bar.selected').forEach(b => b.classList.remove('selected'));
	    }

	    function getTestModel(testId) {
	      return tests.find(t => t && t.testId === testId) || null;
	    }

	    function computeAvgDurationFromHistory(testModel) {
	      const history = Array.isArray(testModel.history) ? testModel.history : [];
	      const nonSkipped = history.filter(h => !h.skipped);
	      if (nonSkipped.length === 0) return 0;
	      return nonSkipped.reduce((sum, h) => sum + (Number(h.duration) || 0), 0) / nonSkipped.length;
	    }

	    function updateTrendUI(card, testId, runId, selectedDuration) {
	      const testModel = getTestModel(testId);
	      if (!testModel) return;

	      const avg = computeAvgDurationFromHistory(testModel);
	      const avgEl = card.querySelector('[data-role="avg-duration"]');
	      const curEl = card.querySelector('[data-role="current-duration"]');
	      if (avgEl) avgEl.textContent = formatDurationMs(avg);
	      if (curEl) curEl.textContent = formatDurationMs(selectedDuration);

	      // Highlight the selected history duration bar (if present)
	      clearSelectedDurationBars(card);
	      if (runId) {
	        const selectedBar = card.querySelector('.duration-bar.history-duration[data-runid="' + CSS.escape(runId) + '"]');
	        if (selectedBar) selectedBar.classList.add('selected');
	      }
	    }

	    function restoreTrendUI(card, testId) {
	      const testModel = getTestModel(testId);
	      if (!testModel) return;

	      const avg = computeAvgDurationFromHistory(testModel);
	      const avgEl = card.querySelector('[data-role="avg-duration"]');
	      const curEl = card.querySelector('[data-role="current-duration"]');
	      if (avgEl) avgEl.textContent = formatDurationMs(avg);
	      if (curEl) curEl.textContent = formatDurationMs(testModel.duration);

	      clearSelectedDurationBars(card);
	    }

	    async function handleHistoryDotClick(dot) {
	      const runId = dot.getAttribute('data-runid');
	      const testId = dot.getAttribute('data-testid');
	      if (!runId || !testId) return;
	      const card = dot.closest('.test-card');
      if (!card) return;
      const details = card.querySelector('.test-details');
      const body = details ? details.querySelector('[data-details-body]') : null;
      if (!body) return;

      if (!detailsBodyCache.has(body)) {
        detailsBodyCache.set(body, body.innerHTML);
      }

	      const runData = getRunSnapshot(runId);
	      const snapshot = runData && runData.tests ? runData.tests[testId] : null;
	      if (!snapshot) {
	        alert('No stored snapshot for this test/run. (Older runs may have stored snapshots for failures only.)');
	        return;
	      }

	      clearSelectedDots(card);
	      clearSelectedDurationBars(card);
	      dot.classList.add('selected');
	      showBackButton(card, true);
	      const testModel = getTestModel(testId);
	      const avg = testModel ? computeAvgDurationFromHistory(testModel) : 0;
	      body.innerHTML = renderSnapshotBody(snapshot, avg);

	      // Sync Duration Trend UI to the selected run.
	      updateTrendUI(card, testId, runId, snapshot.duration);
	    }

	    function handleHistoryBackClick(btn) {
	      const card = btn.closest('.test-card');
	      if (!card) return;
	      const details = card.querySelector('.test-details');
	      const body = details ? details.querySelector('[data-details-body]') : null;
	      if (!body) return;
	      const testId = card.querySelector('.history-dot[data-testid]')?.getAttribute('data-testid') || null;
	      const original = detailsBodyCache.get(body);
	      if (typeof original === 'string') {
	        body.innerHTML = original;
	      }
	      clearSelectedDots(card);
	      clearSelectedDurationBars(card);
	      showBackButton(card, false);

	      if (testId) {
	        restoreTrendUI(card, testId);
	      }
	    }

	    function initHistoryDrilldown() {
	      if (!historyDrilldownEnabled) return;

	      document.addEventListener('click', async (e) => {
        const t = e.target;
        if (!(t instanceof Element)) return;

        const backBtn = t.closest('[data-action="history-back"]');
        if (backBtn) {
          e.preventDefault();
          handleHistoryBackClick(backBtn);
          return;
        }

	        const dot = t.closest('.history-dot[data-runid]');
	        if (dot) {
	          e.preventDefault();
	          handleHistoryDotClick(dot).catch(err => {
	            console.error(err);
	            alert('Unable to load historical run data.');
	          });
	        }
	      });
	    }

    // Run on page load
    window.addEventListener('DOMContentLoaded', () => {
      scrollChartsToRight();
      initHistoryDrilldown();
      if (!traceViewerEnabled) {
        document.querySelectorAll('[data-trace]').forEach(el => {
          el.style.display = 'none';
        });
      }
    });

    // Gallery functions

    let currentLightboxIndex = 0;
    let lightboxItems = [];

    function filterGallery(type) {
      // Update filter buttons
      document.querySelectorAll('.gallery-filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === type);
      });

      // Filter gallery items
      document.querySelectorAll('.gallery-item').forEach(item => {
        const itemType = item.dataset.type;
        item.style.display = (type === 'all' || itemType === type) ? 'block' : 'none';
      });
    }

    function openLightbox(itemId) {
      const lightbox = document.getElementById('lightbox');
      const img = document.getElementById('lightbox-img');
      const title = document.getElementById('lightbox-title');
      const status = document.getElementById('lightbox-status');

      // Build array of only screenshot items (exclude videos and traces from lightbox navigation)
      lightboxItems = Array.from(document.querySelectorAll('.gallery-item[data-type="screenshots"]'))
        .filter(item => item.style.display !== 'none');

      currentLightboxIndex = lightboxItems.findIndex(item => item.dataset.id === itemId);

      if (currentLightboxIndex >= 0) {
        const currentItem = lightboxItems[currentLightboxIndex];
        const imgElement = currentItem.querySelector('img');
        const titleElement = currentItem.querySelector('.gallery-item-title');
        const statusElement = currentItem.querySelector('.gallery-item-status');

        if (!imgElement || !titleElement || !statusElement) return;

        img.src = imgElement.src;
        title.textContent = titleElement.textContent;
        status.textContent = statusElement.textContent;
        status.className = 'lightbox-status ' + (statusElement.className.split(' ')[1] || '');

        lightbox.style.display = 'flex';
      }
    }

    function closeLightbox() {
      document.getElementById('lightbox').style.display = 'none';
    }

    function navigateLightbox(direction) {
      currentLightboxIndex += direction;

      if (currentLightboxIndex < 0) {
        currentLightboxIndex = lightboxItems.length - 1;
      } else if (currentLightboxIndex >= lightboxItems.length) {
        currentLightboxIndex = 0;
      }

      const currentItem = lightboxItems[currentLightboxIndex];
      openLightbox(currentItem.dataset.id);
    }

    // Keyboard navigation for lightbox
    document.addEventListener('keydown', (e) => {
      const lightbox = document.getElementById('lightbox');
      if (lightbox.style.display === 'flex') {
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowLeft') navigateLightbox(-1);
        if (e.key === 'ArrowRight') navigateLightbox(1);
      }
    });
  



    // Chart bar tooltips
    (function initChartTooltips() {
      const tooltip = document.createElement('div');
      tooltip.className = 'chart-tooltip';
      document.body.appendChild(tooltip);

      document.querySelectorAll('.bar-group').forEach(bar => {
        bar.addEventListener('mouseenter', (e) => {
          const text = bar.getAttribute('data-tooltip');
          if (text) {
            tooltip.textContent = text;
            tooltip.style.display = 'block';
          }
        });

        bar.addEventListener('mousemove', (e) => {
          tooltip.style.left = e.pageX + 10 + 'px';
          tooltip.style.top = e.pageY - 30 + 'px';
        });

        bar.addEventListener('mouseleave', () => {
          tooltip.style.display = 'none';
        });
      });
    })();

    /* ============================================
       VIRTUAL SCROLLING / PAGINATION
    ============================================ */
    (function initVirtualScroll() {
      const PAGE_SIZE = 50;
      const listContainer = document.querySelector('#tab-all [role="list"]');
      if (!listContainer) return;

      const allItems = Array.from(listContainer.children);
      if (allItems.length <= PAGE_SIZE) return;

      let visibleCount = PAGE_SIZE;

      // Initially hide items beyond page size
      allItems.forEach((item, i) => {
        if (i >= PAGE_SIZE) item.style.display = 'none';
      });

      // Add count indicator
      const countDiv = document.createElement('div');
      countDiv.className = 'test-list-item-count';
      countDiv.textContent = 'Showing ' + PAGE_SIZE + ' of ' + allItems.length + ' tests';
      listContainer.parentNode.insertBefore(countDiv, listContainer);

      // Add load more button
      const loadMoreBtn = document.createElement('button');
      loadMoreBtn.textContent = 'Load more tests...';
      loadMoreBtn.className = 'summary-card-btn';
      loadMoreBtn.style.cssText = 'margin: 12px auto; display: block;';
      loadMoreBtn.onclick = function() {
        const newCount = Math.min(visibleCount + PAGE_SIZE, allItems.length);
        for (let i = visibleCount; i < newCount; i++) {
          allItems[i].style.display = '';
        }
        visibleCount = newCount;
        countDiv.textContent = 'Showing ' + visibleCount + ' of ' + allItems.length + ' tests';
        if (visibleCount >= allItems.length) {
          loadMoreBtn.style.display = 'none';
          countDiv.textContent = 'Showing all ' + allItems.length + ' tests';
        }
      };
      listContainer.parentNode.appendChild(loadMoreBtn);

      // Listen for filter changes to reset pagination
      const observer = new MutationObserver(() => {
        const visibleItems = allItems.filter(item => !item.classList.contains('filter-hidden'));
        countDiv.textContent = 'Showing ' + visibleItems.length + ' of ' + allItems.length + ' tests';
      });
      observer.observe(listContainer, { childList: false, subtree: true, attributes: true, attributeFilter: ['class', 'style'] });
    })();

    /* ============================================
       KEYBOARD-DRIVEN NAVIGATION
    ============================================ */
    (function initKeyboardNav() {
      // Create keyboard hints panel
      const hints = document.createElement('div');
      hints.className = 'keyboard-hints';
      hints.innerHTML = '<h4>Keyboard Shortcuts</h4>' +
        '<div class="keyboard-hint-row"><span>Navigate tests</span><kbd>j</kbd> <kbd>k</kbd></div>' +
        '<div class="keyboard-hint-row"><span>Next failure</span><kbd>f</kbd></div>' +
        '<div class="keyboard-hint-row"><span>Next flaky</span><kbd>n</kbd></div>' +
        '<div class="keyboard-hint-row"><span>Search</span><kbd>K</kbd></div>' +
        '<div class="keyboard-hint-row"><span>Toggle sidebar</span><kbd>B</kbd></div>' +
        '<div class="keyboard-hint-row"><span>Views (1-5)</span><kbd>1</kbd>-<kbd>5</kbd></div>' +
        '<div class="keyboard-hint-row"><span>Show/hide hints</span><kbd>?</kbd></div>' +
        '<div class="keyboard-hint-row"><span>Export summary</span><kbd>e</kbd></div>';
      document.body.appendChild(hints);

      function getVisibleTestItems() {
        return Array.from(document.querySelectorAll('.test-list-item')).filter(
          el => el.offsetParent !== null && el.style.display !== 'none'
        );
      }

      function getCurrentIndex(items) {
        return items.findIndex(el => el.classList.contains('selected'));
      }

      function selectByIndex(items, idx) {
        if (idx >= 0 && idx < items.length) {
          const testId = items[idx].id.replace('list-item-', '');
          selectTest(testId);
          items[idx].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
      }

      document.addEventListener('keydown', function(e) {
        // Don't handle keys when typing in input fields
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

        const items = getVisibleTestItems();
        const currentIdx = getCurrentIndex(items);

        switch(e.key) {
          case 'j': // Next test
            e.preventDefault();
            if (currentView !== 'tests') switchView('tests');
            selectByIndex(items, currentIdx < 0 ? 0 : currentIdx + 1);
            break;
          case 'k': // Previous test
            e.preventDefault();
            if (currentView !== 'tests') switchView('tests');
            selectByIndex(items, currentIdx < 0 ? 0 : currentIdx - 1);
            break;
          case 'f': // Next failure
            e.preventDefault();
            if (currentView !== 'tests') switchView('tests');
            for (let i = (currentIdx + 1); i < items.length; i++) {
              if (items[i].classList.contains('failed')) {
                selectByIndex(items, i);
                break;
              }
            }
            break;
          case 'n': // Next flaky
            e.preventDefault();
            if (currentView !== 'tests') switchView('tests');
            for (let i = (currentIdx + 1); i < items.length; i++) {
              if (items[i].dataset.flaky === 'true') {
                selectByIndex(items, i);
                break;
              }
            }
            break;
          case '?': // Toggle hints
            e.preventDefault();
            hints.classList.toggle('visible');
            break;
          case 'e': // Export summary
            e.preventDefault();
            if (typeof showSummaryExport === 'function') showSummaryExport();
            break;
          case '1': switchView('overview'); break;
          case '2': switchView('tests'); break;
          case '3': switchView('trends'); break;
          case '4':
            if (document.getElementById('view-comparison')) switchView('comparison');
            break;
          case '5':
            if (document.getElementById('view-gallery')) switchView('gallery');
            break;
          case 'Escape':
            hints.classList.remove('visible');
            break;
        }
      });
    })();

    /* ============================================
       EXPORTABLE SUMMARY CARD
    ============================================ */
    function showSummaryExport() {
      let modal = document.getElementById('summary-export-modal');
      if (modal) {
        modal.classList.add('visible');
        return;
      }

      const passRate = stats.total > 0 ? Math.round((stats.passed / stats.total) * 100) : 0;
      const barColor = passRate >= 90 ? 'var(--accent-green)' : passRate >= 70 ? 'var(--accent-yellow)' : 'var(--accent-red)';
      const timestamp = new Date().toLocaleString();

      modal = document.createElement('div');
      modal.id = 'summary-export-modal';
      modal.className = 'summary-export-modal visible';
      modal.innerHTML =
        '<div class="summary-card">' +
          '<div class="summary-card-title">Test Run Summary</div>' +
          '<div class="summary-card-subtitle">' + timestamp + '</div>' +
          '<div class="summary-card-stats">' +
            '<div class="summary-stat"><div class="summary-stat-value passed">' + stats.passed + '</div><div class="summary-stat-label">Passed</div></div>' +
            '<div class="summary-stat"><div class="summary-stat-value failed">' + stats.failed + '</div><div class="summary-stat-label">Failed</div></div>' +
            '<div class="summary-stat"><div class="summary-stat-value rate">' + passRate + '%</div><div class="summary-stat-label">Pass Rate</div></div>' +
          '</div>' +
          '<div class="summary-card-bar"><div class="summary-card-bar-fill" style="width: ' + passRate + '%; background: ' + barColor + ';"></div></div>' +
          '<div style="font-size: 0.75rem; color: var(--text-muted);">' +
            stats.total + ' total &bull; ' + stats.flaky + ' flaky &bull; ' + stats.slow + ' slow &bull; ' + stats.skipped + ' skipped' +
          '</div>' +
          '<div class="summary-card-footer">' +
            '<button class="summary-card-btn" onclick="closeSummaryExport()">Close</button>' +
            '<button class="summary-card-btn primary" onclick="copySummaryToClipboard()">Copy to Clipboard</button>' +
          '</div>' +
        '</div>';
      modal.addEventListener('click', function(e) { if (e.target === modal) closeSummaryExport(); });
      document.body.appendChild(modal);
    }

    function closeSummaryExport() {
      const modal = document.getElementById('summary-export-modal');
      if (modal) modal.classList.remove('visible');
    }

    function copySummaryToClipboard() {
      const passRate = stats.total > 0 ? Math.round((stats.passed / stats.total) * 100) : 0;
      const text = 'Test Run Summary\n' +
        '\n' +
        'Passed: ' + stats.passed + '/' + stats.total + ' (' + passRate + '%)\n' +
        'Failed: ' + stats.failed + '\n' +
        'Flaky: ' + stats.flaky + '\n' +
        'Slow: ' + stats.slow + '\n' +
        'Duration: ' + document.querySelector('.duration-value')?.textContent + '\n' +
        'Date: ' + new Date().toLocaleString();
      navigator.clipboard.writeText(text).then(() => {
        showToast('Summary copied to clipboard!', 'success');
      }).catch(() => {
        showToast('Failed to copy', 'error');
      });
    }



    // Trace Viewer State
    let traceData = null;
    let traceResources = {};
    let traceScreenshots = new Map();
    let traceAttachments = [];
    let currentActionIndex = 0;
    let currentTracePath = '';
    let currentSnapshotMode = 'after';
    let currentConsoleFilter = 'all';
    let currentNetworkFilter = '';
    let currentNetworkType = 'all';
    let actionSearchTerm = '';
    let maxActionDuration = 0;

    // JSZip is inlined below - no CDN required
    let JSZip = null;

    function initJSZip() {
      if (JSZip) return;
      if (window.JSZip) {
        JSZip = window.JSZip;
        return;
      }
    }

    async function loadJSZip() {
      if (JSZip) return JSZip;
      if (window.JSZip) {
        JSZip = window.JSZip;
        return JSZip;
      }
      throw new Error('JSZip not available');
    }

    function viewTraceFromEl(el) {
      const tracePath = el.dataset.trace;
      if (tracePath) {
        openTraceModal(tracePath);
      }
      return false;
    }

    async function openTraceModal(tracePath) {
      const modal = document.getElementById('traceViewerModal');
      if (!modal) return;

      currentTracePath = tracePath;
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';

      // Update title
      const title = document.getElementById('traceViewerTitle');
      if (title) {
        const fileName = tracePath.split(/[\\/]/).pop() || 'Trace';
        title.textContent = fileName;
      }

      // Show loading
      showTraceState('loading');

      // Set up copy command button
      const copyCmd = document.getElementById('traceCopyCmd');
      if (copyCmd) {
        copyCmd.onclick = () => {
          const cmd = 'npx playwright show-trace "' + tracePath + '"';
          navigator.clipboard.writeText(cmd).then(() => {
            copyCmd.textContent = ' Copied!';
            setTimeout(() => { copyCmd.textContent = ' Copy CLI command'; }, 2000);
          }).catch(() => {
            window.prompt('Run this command:', cmd);
          });
        };
      }

      // file:// protocol cannot use fetch for local files due to browser security
      if (window.location.protocol === 'file:') {
        showTraceError('Cannot load traces via file://. Run: npx playwright-smart-reporter-serve to view with full trace support, or use "Load from file" below.');
        return;
      }

      try {
        console.log('[TraceViewer] Loading JSZip...');
        await loadJSZip();
        console.log('[TraceViewer] JSZip loaded, fetching trace:', tracePath);

        // Fetch the trace file
        const response = await fetch(tracePath);
        console.log('[TraceViewer] Fetch response:', response.status, response.statusText);
        if (!response.ok) throw new Error('Failed to fetch trace: ' + response.status + ' ' + response.statusText);

        const blob = await response.blob();
        console.log('[TraceViewer] Blob size:', blob.size);
        await loadTraceFromBlob(blob);
        console.log('[TraceViewer] Trace loaded successfully');
      } catch (err) {
        console.error('[TraceViewer] Error:', err);
        showTraceError(err.message || 'Failed to load trace');
      }
    }

    async function loadTraceFromFile(file) {
      if (!file) return;
      showTraceState('loading');
      try {
        await loadJSZip();
        await loadTraceFromBlob(file);
      } catch (err) {
        showTraceError(err.message || 'Failed to load trace file');
      }
    }

    async function loadTraceFromBlob(blob) {
      const zip = await JSZip.loadAsync(blob);

      // Find and parse trace file
      let traceContent = null;
      for (const fileName of Object.keys(zip.files)) {
        if (fileName.endsWith('-trace.trace') || fileName === 'trace.trace') {
          traceContent = await zip.files[fileName].async('string');
          break;
        }
      }

      if (!traceContent) {
        if (zip.files['0-trace.trace']) {
          traceContent = await zip.files['0-trace.trace'].async('string');
        }
      }

      if (!traceContent) {
        throw new Error('No trace data found in ZIP');
      }

      // Parse NDJSON trace
      const events = traceContent.trim().split('\n').map(line => {
        try { return JSON.parse(line); } catch { return null; }
      }).filter(Boolean);

      // Extract resources (screenshots)
      traceResources = {};
      traceScreenshots = new Map();
      for (const fileName of Object.keys(zip.files)) {
        if (fileName.startsWith('resources/')) {
          const key = fileName.split('/').pop();
          if (fileName.endsWith('.jpeg') || fileName.endsWith('.png')) {
            const data = await zip.files[fileName].async('base64');
            const ext = fileName.endsWith('.png') ? 'png' : 'jpeg';
            traceResources[key] = 'data:image/' + ext + ';base64,' + data;
          }
        }
      }

      // Parse stack traces if available
      // Format: {"files":["path1.ts"], "stacks":[[callId, [[fileIdx, line, col, func]]]]}
      let stackData = { files: [], stacks: [] };
      if (zip.files['0-trace.stacks']) {
        try {
          const stackContent = await zip.files['0-trace.stacks'].async('string');
          stackData = JSON.parse(stackContent);
        } catch (e) {
          console.warn('[TraceViewer] Failed to parse stacks:', e);
        }
      }

      // Parse network data if available
      // Format: NDJSON with {"type":"resource-snapshot","snapshot":{...HAR entry...}}
      let networkData = [];
      if (zip.files['0-trace.network']) {
        try {
          const networkContent = await zip.files['0-trace.network'].async('string');
          const lines = networkContent.trim().split('\n');
          for (const line of lines) {
            try {
              const entry = JSON.parse(line);
              if (entry.type === 'resource-snapshot' && entry.snapshot) {
                const snap = entry.snapshot;
                const req = snap.request || {};
                const res = snap.response || {};
                const timings = snap.timings || {};
                networkData.push({
                  method: req.method || 'GET',
                  url: req.url || '',
                  status: res.status || 0,
                  statusText: res.statusText || '',
                  time: snap.time || 0,
                  startedDateTime: snap.startedDateTime,
                  timings: {
                    dns: Math.max(0, timings.dns || 0),
                    connect: Math.max(0, timings.connect || 0),
                    ssl: Math.max(0, timings.ssl || 0),
                    wait: Math.max(0, timings.wait || 0),
                    receive: Math.max(0, timings.receive || 0)
                  },
                  requestHeaders: req.headers || [],
                  responseHeaders: res.headers || [],
                  requestBody: req.postData?.text || null,
                  responseSize: res.content?.size || res.bodySize || 0,
                  mimeType: res.content?.mimeType || ''
                });
              }
            } catch {}
          }
        } catch (e) {
          console.warn('[TraceViewer] Failed to parse network data:', e);
        }
      }

      // Process trace data
      traceData = processTraceEvents(events, networkData, stackData);

      // Render
      renderTraceViewer();
      showTraceState('content');
    }

    function processTraceEvents(events, networkData, stackData) {
      const actions = [];
      const logs = [];
      const errors = [];
      const consoleEntries = [];
      const screenshots = new Map();
      let contextInfo = null;
      let metadata = {
        browserName: 'Unknown',
        browserVersion: '',
        viewport: { width: 0, height: 0 },
        platform: 'Unknown',
        locale: '',
        testName: '',
        testFile: '',
        duration: 0
      };

      // Build stack map by callId number
      // Format: stackData = {files: ["path.ts"], stacks: [[callIdNum, [[fileIdx, line, col, func]]]]}
      const stackMap = new Map();
      const stackFiles = stackData.files || [];
      for (const [callIdNum, frames] of (stackData.stacks || [])) {
        // Convert compact frame format to objects
        const frameObjects = (frames || []).map(f => ({
          file: stackFiles[f[0]] || 'unknown',
          line: f[1] || 0,
          column: f[2] || 0,
          function: f[3] || ''
        }));
        stackMap.set(callIdNum, frameObjects);
      }

      // First pass: collect screenshots and context info
      for (const event of events) {
        if (event.type === 'screencast-frame') {
          screenshots.set(event.timestamp, {
            sha1: event.sha1,
            timestamp: event.timestamp
          });
          traceScreenshots.set(event.timestamp, event.sha1);
        }
        if (event.type === 'context-options') {
          contextInfo = event;
          if (event.browserName) metadata.browserName = event.browserName;
          if (event.browserVersion) metadata.browserVersion = event.browserVersion;
          if (event.viewport) metadata.viewport = event.viewport;
          if (event.platform) metadata.platform = event.platform;
          if (event.locale) metadata.locale = event.locale;
        }
        if (event.type === 'stdio') {
          consoleEntries.push({
            type: event.messageType || 'log',
            text: event.text || '',
            timestamp: event.timestamp || 0,
            location: event.location || ''
          });
        }
        if (event.type === 'console') {
          consoleEntries.push({
            type: event.messageType || 'log',
            text: event.text || (event.args ? event.args.map(a => a.preview || a.value || '').join(' ') : ''),
            timestamp: event.timestamp || 0,
            location: event.location ? event.location.url + ':' + event.location.lineNumber : ''
          });
        }
      }

      // Second pass: build actions
      const beforeEvents = new Map();
      let startTime = Infinity;
      let endTime = 0;

      for (const event of events) {
        if (event.type === 'before') {
          beforeEvents.set(event.callId, event);
          if (event.startTime < startTime) startTime = event.startTime;
        }
        if (event.type === 'after') {
          const before = beforeEvents.get(event.callId);
          if (before) {
            if (event.endTime > endTime) endTime = event.endTime;

            const action = {
              callId: event.callId,
              class: before.class,
              method: before.method,
              params: before.params,
              startTime: before.startTime,
              endTime: event.endTime,
              duration: Math.round(event.endTime - before.startTime),
              result: event.result,
              error: event.error,
              title: before.title || (before.class + '.' + before.method),
              beforeSnapshot: before.beforeSnapshot,
              afterSnapshot: event.afterSnapshot,
              // callId is like "call@23" - extract the number to match stackMap
              stack: stackMap.get(parseInt(event.callId.split('@')[1]) || 0) || [],
              point: event.point
            };

            // Find screenshots for before/after the action
            // Before: latest screenshot taken before the action started
            // After: first screenshot taken after the action completed
            let closestBeforeScreenshot = null;
            let closestAfterScreenshot = null;
            let closestBeforeTime = -Infinity;

            const sortedScreenshots = Array.from(screenshots.entries()).sort((a, b) => a[0] - b[0]);

            for (const [ts, data] of sortedScreenshots) {
              // Before: latest screenshot before action started
              if (ts < before.startTime) {
                if (ts > closestBeforeTime) {
                  closestBeforeTime = ts;
                  closestBeforeScreenshot = data.sha1;
                }
              }
              // After: first screenshot at or after action END time (when action completed)
              if (ts >= event.endTime && !closestAfterScreenshot) {
                closestAfterScreenshot = data.sha1;
              }
            }

            // If we still don't have an after screenshot, use the last screenshot before
            if (!closestAfterScreenshot && closestBeforeScreenshot) {
              closestAfterScreenshot = closestBeforeScreenshot;
            }

            // If we don't have a before screenshot, use the first after screenshot
            if (!closestBeforeScreenshot && closestAfterScreenshot) {
              closestBeforeScreenshot = closestAfterScreenshot;
            }

            action.beforeScreenshot = closestBeforeScreenshot;
            action.afterScreenshot = closestAfterScreenshot;
            action.screenshot = closestAfterScreenshot || closestBeforeScreenshot;

            actions.push(action);

            if (event.error) {
              errors.push({
                action: action.title,
                name: event.error.name || 'Error',
                message: event.error.message || 'Unknown error',
                stack: event.error.stack || ''
              });
            }
          }
        }
        if (event.type === 'log') {
          logs.push({
            time: event.time,
            message: event.message
          });
        }
      }

      // Calculate metadata duration
      metadata.duration = endTime - startTime;

      // Calculate max duration for relative bars
      maxActionDuration = Math.max(...actions.map(a => a.duration), 1);

      // Sort console entries by timestamp
      consoleEntries.sort((a, b) => a.timestamp - b.timestamp);

      return {
        actions,
        logs,
        errors,
        network: networkData,
        console: consoleEntries,
        metadata,
        contextInfo,
        startTime,
        endTime
      };
    }

    function renderTraceViewer() {
      if (!traceData) return;

      // Render timeline
      renderTimeline();

      // Render actions list
      renderActionsList();

      // Update count
      const countEl = document.getElementById('traceActionCount');
      if (countEl) countEl.textContent = traceData.actions.length;

      // Select first action
      if (traceData.actions.length > 0) {
        selectTraceAction(0);
      }

      // Render static tabs
      renderErrorsTab();
      renderMetadataTab();
      renderNetworkTab();
      renderConsoleTab();
      renderAttachmentsTab();

      // Update badges
      updateTabBadges();

      // Set up panel resizing
      setupPanelResizer();

      // Set up timeline slider
      setupTimelineSlider();

      // Set up timeline hover magnification
      setupTimelineMagnifier();
    }

    function renderTimeline() {
      const container = document.getElementById('traceTimelineScroll');
      if (!container || !traceData) return;

      // Get all unique screenshots in order
      const screenshotTimes = Array.from(traceScreenshots.keys()).sort((a, b) => a - b);

      // Sample if too many (show ~20-30 thumbnails)
      let sampled = screenshotTimes;
      if (screenshotTimes.length > 30) {
        const step = Math.ceil(screenshotTimes.length / 30);
        sampled = screenshotTimes.filter((_, i) => i % step === 0);
      }

      // Find which actions have errors
      const errorActionIndices = new Set(
        traceData.actions.map((a, i) => a.error ? i : -1).filter(i => i >= 0)
      );

      // Create thumbnail for each screenshot
      container.innerHTML = sampled.map((ts, idx) => {
        const sha1 = traceScreenshots.get(ts);
        const src = traceResources[sha1] || '';

        // Find closest action to this timestamp
        let closestActionIdx = 0;
        let closestDiff = Infinity;
        for (let i = 0; i < traceData.actions.length; i++) {
          const diff = Math.abs(traceData.actions[i].startTime - ts);
          if (diff < closestDiff) {
            closestDiff = diff;
            closestActionIdx = i;
          }
        }

        const hasError = errorActionIndices.has(closestActionIdx);

        return `
          <div class="trace-timeline-thumb ${hasError ? 'has-error' : ''}"
               data-index="${closestActionIdx}"
               data-timestamp="${ts}"
               onclick="jumpToTimelineFrame(${closestActionIdx}, ${idx})">
            ${src ? `<img src="${src}" alt="Frame">` : '<div class="trace-timeline-placeholder">No img</div>'}
          </div>
        `;
      }).join('');
    }

    function jumpToTimelineFrame(actionIndex, thumbIndex) {
      selectTraceAction(actionIndex);

      // Update active state on timeline
      document.querySelectorAll('.trace-timeline-thumb').forEach((el, i) => {
        el.classList.toggle('active', i === thumbIndex);
      });
    }

    function renderActionsList() {
      const actionsList = document.getElementById('traceActionsList');
      if (!actionsList || !traceData) return;

      actionsList.innerHTML = traceData.actions.map((action, idx) => {
        const icon = getActionIcon(action.method);
        const selector = action.params?.selector || action.params?.url || '';
        const hasError = !!action.error;
        const durationPercent = (action.duration / maxActionDuration) * 100;

        return `
          <div class="trace-action-item ${idx === 0 ? 'active' : ''} ${hasError ? 'has-error' : ''}"
               onclick="selectTraceAction(${idx})" data-index="${idx}">
            <span class="trace-action-icon">${icon}</span>
            <div class="trace-action-info">
              <div class="trace-action-name">${escapeHtmlTrace(action.title || action.method)}</div>
              ${selector ? `<div class="trace-action-selector">${escapeHtmlTrace(selector.substring(0, 50))}</div>` : ''}
              <div class="trace-action-duration-bar" style="width: ${durationPercent}%"></div>
            </div>
            <span class="trace-action-time">${action.duration}ms</span>
          </div>
        `;
      }).join('');
    }

    function selectTraceAction(index) {
      if (!traceData || index >= traceData.actions.length) return;

      currentActionIndex = index;
      const action = traceData.actions[index];

      // Update active state in actions list
      document.querySelectorAll('.trace-action-item').forEach((el, i) => {
        el.classList.toggle('active', i === index);
      });

      // Scroll action into view
      const activeItem = document.querySelector('.trace-action-item.active');
      if (activeItem) {
        activeItem.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
      }

      // Update timeline active state
      const timelineThumbs = document.querySelectorAll('.trace-timeline-thumb');
      let closestThumbIdx = 0;
      let closestDiff = Infinity;
      timelineThumbs.forEach((thumb, i) => {
        const thumbActionIdx = parseInt(thumb.dataset.index) || 0;
        const diff = Math.abs(thumbActionIdx - index);
        if (diff < closestDiff) {
          closestDiff = diff;
          closestThumbIdx = i;
        }
      });
      timelineThumbs.forEach((el, i) => {
        el.classList.toggle('active', i === closestThumbIdx);
      });

      // Scroll timeline to active thumb
      const activeThumb = document.querySelector('.trace-timeline-thumb.active');
      if (activeThumb) {
        activeThumb.scrollIntoView({ block: 'nearest', behavior: 'smooth', inline: 'center' });
      }

      // Update snapshot controls visibility - show if action has any screenshot
      const snapshotControls = document.getElementById('traceSnapshotControls');
      if (snapshotControls) {
        const hasScreenshots = action.beforeScreenshot || action.afterScreenshot || action.screenshot;
        snapshotControls.style.display = hasScreenshots ? 'flex' : 'none';

        // Update button states to show which snapshots are available
        const beforeBtn = snapshotControls.querySelector('[data-snapshot="before"]');
        const afterBtn = snapshotControls.querySelector('[data-snapshot="after"]');
        if (beforeBtn) {
          beforeBtn.disabled = !action.beforeScreenshot;
          beforeBtn.style.opacity = action.beforeScreenshot ? '1' : '0.5';
        }
        if (afterBtn) {
          afterBtn.disabled = !action.afterScreenshot && !action.screenshot;
          afterBtn.style.opacity = (action.afterScreenshot || action.screenshot) ? '1' : '0.5';
        }
      }

      // Update screenshot
      updateScreenshot(action);

      // Update details tab
      updateDetailsTab(action);

      // Update source tab
      updateSourceTab(action);

      // Update logs for this action's timeframe
      updateLogsForAction(action);

      // Update timeline slider position
      updateTimelineSlider(index);

      // Show click position indicator if action has point data
      showClickPosition(action);
    }

    function updateScreenshot(action) {
      const screenshotEl = document.getElementById('traceScreenshot');
      const noScreenshotEl = document.getElementById('traceNoScreenshot');

      // Determine which screenshot to show based on mode
      let screenshot = currentSnapshotMode === 'before' ? action.beforeScreenshot : action.afterScreenshot;
      if (!screenshot) screenshot = action.screenshot;

      // If no screenshot for this action, find the nearest one from other actions
      if (!screenshot || !traceResources[screenshot]) {
        screenshot = findNearestScreenshot(action);
      }

      if (screenshot && traceResources[screenshot]) {
        screenshotEl.src = traceResources[screenshot];
        screenshotEl.style.display = 'block';
        noScreenshotEl.style.display = 'none';

        // Update snapshot visual indicator
        screenshotEl.classList.remove('before-snapshot', 'after-snapshot');
        if (currentSnapshotMode === 'before' && action.beforeScreenshot) {
          screenshotEl.classList.add('before-snapshot');
        } else if (currentSnapshotMode === 'after' && action.afterScreenshot) {
          screenshotEl.classList.add('after-snapshot');
        }
      } else {
        screenshotEl.style.display = 'none';
        noScreenshotEl.style.display = 'flex';
      }
    }

    function findNearestScreenshot(targetAction) {
      if (!traceData || !traceData.actions) return null;

      const targetTime = targetAction.startTime || 0;
      let nearestScreenshot = null;
      let nearestDiff = Infinity;

      // Search through all actions to find the nearest screenshot
      for (const action of traceData.actions) {
        const candidates = [action.screenshot, action.afterScreenshot, action.beforeScreenshot];
        for (const screenshot of candidates) {
          if (screenshot && traceResources[screenshot]) {
            const actionTime = action.startTime || 0;
            const diff = Math.abs(actionTime - targetTime);
            if (diff < nearestDiff) {
              nearestDiff = diff;
              nearestScreenshot = screenshot;
            }
          }
        }
      }

      return nearestScreenshot;
    }

    function switchSnapshot(mode) {
      currentSnapshotMode = mode;

      // Update button states
      document.querySelectorAll('.trace-snapshot-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.snapshot === mode);
      });

      // Update screenshot
      if (traceData && traceData.actions[currentActionIndex]) {
        updateScreenshot(traceData.actions[currentActionIndex]);
      }
    }

    function updateDetailsTab(action) {
      const detailsContent = document.getElementById('traceDetailsContent');
      if (!detailsContent) return;

      let html = `
        <div class="trace-detail-row">
          <span class="trace-detail-label">Action</span>
          <span class="trace-detail-value">${escapeHtmlTrace(action.class + '.' + action.method)}</span>
        </div>
        <div class="trace-detail-row">
          <span class="trace-detail-label">Duration</span>
          <span class="trace-detail-value">${action.duration}ms</span>
        </div>
      `;

      if (action.params) {
        for (const [key, value] of Object.entries(action.params)) {
          if (value !== null && value !== undefined) {
            const displayValue = typeof value === 'object' ? JSON.stringify(value) : String(value);
            html += `
              <div class="trace-detail-row">
                <span class="trace-detail-label">${escapeHtmlTrace(key)}</span>
                <span class="trace-detail-value">${escapeHtmlTrace(displayValue.substring(0, 300))}</span>
              </div>
            `;
          }
        }
      }

      if (action.result && typeof action.result === 'object') {
        html += `
          <div class="trace-detail-row">
            <span class="trace-detail-label">Result</span>
            <span class="trace-detail-value">${escapeHtmlTrace(JSON.stringify(action.result).substring(0, 200))}</span>
          </div>
        `;
      }

      if (action.error) {
        html += `
          <div class="trace-detail-row">
            <span class="trace-detail-label">Error</span>
            <span class="trace-detail-value" style="color: var(--accent-red)">${escapeHtmlTrace(action.error.message)}</span>
          </div>
        `;
      }

      detailsContent.innerHTML = html;
    }

    function updateSourceTab(action) {
      const sourceContent = document.getElementById('traceSourceContent');
      if (!sourceContent) return;

      if (!action.stack || action.stack.length === 0) {
        sourceContent.innerHTML = '<div class="trace-empty">No source information available</div>';
        return;
      }

      // Find user code frames (not from node_modules)
      const userFrames = action.stack.filter(f =>
        f.file && !f.file.includes('node_modules') && !f.file.includes('internal/')
      );
      const internalFrames = action.stack.filter(f =>
        !f.file || f.file.includes('node_modules') || f.file.includes('internal/')
      );

      let html = '';

      if (userFrames.length > 0) {
        html += `
          <div class="trace-source-section">
            <div class="trace-source-title"> Test Code</div>
            <div class="trace-source-location">
              ${userFrames.map(f => `
                <div class="trace-stack-frame user-code">
                  at <span class="trace-stack-file">${escapeHtmlTrace(f.file || 'unknown')}</span>:<span class="trace-stack-line">${f.line || 0}</span>:${f.column || 0}
                  ${f.function ? ' (' + escapeHtmlTrace(f.function) + ')' : ''}
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      if (internalFrames.length > 0) {
        html += `
          <div class="trace-source-section">
            <div class="trace-source-title"> Framework Stack</div>
            <div style="max-height: 150px; overflow-y: auto;">
              ${internalFrames.slice(0, 10).map(f => `
                <div class="trace-stack-frame">
                  at ${escapeHtmlTrace(f.file || 'unknown')}:${f.line || 0}
                </div>
              `).join('')}
              ${internalFrames.length > 10 ? '<div class="trace-stack-frame">... ' + (internalFrames.length - 10) + ' more frames</div>' : ''}
            </div>
          </div>
        `;
      }

      sourceContent.innerHTML = html || '<div class="trace-empty">No source information available</div>';
    }

    function updateLogsForAction(action) {
      const logsContent = document.getElementById('traceLogsContent');
      if (!logsContent || !traceData) return;

      const actionLogs = traceData.logs.filter(log =>
        log.time >= action.startTime && log.time <= action.endTime
      );

      if (actionLogs.length === 0) {
        logsContent.innerHTML = '<div class="trace-empty">No logs for this action</div>';
      } else {
        logsContent.innerHTML = actionLogs.map(log => `
          <div class="trace-log-item">
            <span class="trace-log-time">${Math.round(log.time - action.startTime)}ms</span>
            <span class="trace-log-message">${escapeHtmlTrace(log.message)}</span>
          </div>
        `).join('');
      }
    }

    function renderConsoleTab() {
      const consoleContent = document.getElementById('traceConsoleContent');
      if (!consoleContent || !traceData) return;

      if (traceData.console.length === 0) {
        consoleContent.innerHTML = '<div class="trace-empty">No console output</div>';
        return;
      }

      const baseTime = traceData.startTime || 0;

      consoleContent.innerHTML = traceData.console.map(entry => {
        const icon = getConsoleIcon(entry.type);
        const relTime = Math.round(entry.timestamp - baseTime);
        return `
          <div class="trace-console-item ${entry.type}" data-level="${entry.type}">
            <span class="trace-console-icon">${icon}</span>
            <span class="trace-console-time">${relTime}ms</span>
            <span class="trace-console-message">${escapeHtmlTrace(entry.text)}</span>
            ${entry.location ? `<span class="trace-console-location">${escapeHtmlTrace(entry.location)}</span>` : ''}
          </div>
        `;
      }).join('');
    }

    function getConsoleIcon(type) {
      const icons = {
        'log': '',
        'info': '',
        'warning': '',
        'warn': '',
        'error': '',
        'debug': ''
      };
      return icons[type] || '';
    }

    function filterConsole(level) {
      currentConsoleFilter = level;

      // Update filter buttons
      document.querySelectorAll('.trace-console-filter').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.level === level);
      });

      // Filter items
      document.querySelectorAll('.trace-console-item').forEach(item => {
        const itemLevel = item.dataset.level;
        let show = level === 'all';
        if (!show) {
          if (level === 'error') show = itemLevel === 'error';
          else if (level === 'warning') show = itemLevel === 'warning' || itemLevel === 'warn';
          else if (level === 'log') show = itemLevel === 'log' || itemLevel === 'info' || itemLevel === 'debug';
        }
        item.classList.toggle('filtered-out', !show);
      });
    }

    function renderNetworkTab() {
      const networkContent = document.getElementById('traceNetworkContent');
      if (!networkContent || !traceData) return;

      const sortedNetwork = getSortedNetworkData();

      if (sortedNetwork.length === 0) {
        networkContent.innerHTML = '<div class="trace-empty">No network requests captured</div>';
        return;
      }

      // Calculate max time for waterfall scaling
      const maxTime = Math.max(...sortedNetwork.map(r => r.time || 0), 1);

      let html = `
        <div class="trace-network-list">
          <div class="trace-network-header">
            <span class="trace-network-header-cell" data-column="method" onclick="sortNetworkBy('method')">
              Method <span class="trace-network-sort-icon"></span>
            </span>
            <span class="trace-network-header-cell" data-column="url" onclick="sortNetworkBy('url')">
              URL <span class="trace-network-sort-icon"></span>
            </span>
            <span>Waterfall</span>
            <span class="trace-network-header-cell" data-column="status" onclick="sortNetworkBy('status')">
              Status <span class="trace-network-sort-icon"></span>
            </span>
            <span class="trace-network-header-cell" data-column="time" onclick="sortNetworkBy('time')">
              Time <span class="trace-network-sort-icon"></span>
            </span>
          </div>
      `;

      html += sortedNetwork.slice(0, 100).map((req, idx) => {
        const isError = req.status >= 400;
        const isRedirect = req.status >= 300 && req.status < 400;
        const statusClass = isError ? 'error' : (isRedirect ? 'redirect' : 'success');
        const methodClass = req.method.toLowerCase();
        const resourceType = getResourceType(req.url, req.mimeType);

        // Calculate waterfall bars
        const totalTime = req.time || 1;
        const timings = req.timings || {};
        const waterfallHtml = renderWaterfallBars(timings, totalTime, maxTime);

        return `
          <div class="trace-network-item" data-type="${resourceType}" data-url="${escapeHtmlTrace(req.url)}" onclick="toggleNetworkDetails(${idx})">
            <span class="trace-network-method ${methodClass}">${req.method}</span>
            <span class="trace-network-url" title="${escapeHtmlTrace(req.url)}">${escapeHtmlTrace(getUrlPath(req.url))}</span>
            <div class="trace-network-waterfall">${waterfallHtml}</div>
            <span class="trace-network-status ${statusClass}">${req.status}</span>
            <span class="trace-network-time">${Math.round(req.time || 0)}ms</span>
            <div class="trace-network-details" id="networkDetails${idx}">
              ${renderNetworkDetails(req)}
            </div>
          </div>
        `;
      }).join('');

      html += '</div>';

      // Add waterfall legend
      html += `
        <div class="trace-waterfall-legend">
          <div class="trace-waterfall-legend-item">
            <span class="trace-waterfall-legend-color trace-waterfall-dns"></span> DNS
          </div>
          <div class="trace-waterfall-legend-item">
            <span class="trace-waterfall-legend-color trace-waterfall-connect"></span> Connect
          </div>
          <div class="trace-waterfall-legend-item">
            <span class="trace-waterfall-legend-color trace-waterfall-ssl"></span> SSL
          </div>
          <div class="trace-waterfall-legend-item">
            <span class="trace-waterfall-legend-color trace-waterfall-wait"></span> Wait
          </div>
          <div class="trace-waterfall-legend-item">
            <span class="trace-waterfall-legend-color trace-waterfall-receive"></span> Receive
          </div>
        </div>
      `;

      networkContent.innerHTML = html;
    }

    function renderWaterfallBars(timings, totalTime, maxTime) {
      if (!timings || totalTime === 0) return '';

      const scale = 180 / maxTime; // 180px max width
      let offset = 0;
      let html = '';

      const phases = [
        { key: 'dns', cls: 'dns' },
        { key: 'connect', cls: 'connect' },
        { key: 'ssl', cls: 'ssl' },
        { key: 'wait', cls: 'wait' },
        { key: 'receive', cls: 'receive' }
      ];

      for (const phase of phases) {
        const duration = timings[phase.key] || 0;
        if (duration > 0) {
          const width = Math.max(2, duration * scale);
          html += `<div class="trace-waterfall-bar trace-waterfall-${phase.cls}" style="left: ${offset}px; width: ${width}px;"></div>`;
          offset += width;
        }
      }

      return html;
    }

    function renderNetworkDetails(req) {
      let html = '';

      // Request Headers
      if (req.requestHeaders && req.requestHeaders.length > 0) {
        html += `
          <div class="trace-network-details-section" onclick="event.stopPropagation(); toggleDetailsSection(this)">
            <div class="trace-network-details-title">Request Headers (${req.requestHeaders.length})</div>
            <div class="trace-network-details-content">
              ${req.requestHeaders.map(h => `
                <div class="trace-header-row">
                  <span class="trace-header-name">${escapeHtmlTrace(h.name)}</span>
                  <span class="trace-header-value">${escapeHtmlTrace(h.value)}</span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      // Response Headers
      if (req.responseHeaders && req.responseHeaders.length > 0) {
        html += `
          <div class="trace-network-details-section" onclick="event.stopPropagation(); toggleDetailsSection(this)">
            <div class="trace-network-details-title">Response Headers (${req.responseHeaders.length})</div>
            <div class="trace-network-details-content">
              ${req.responseHeaders.map(h => `
                <div class="trace-header-row">
                  <span class="trace-header-name">${escapeHtmlTrace(h.name)}</span>
                  <span class="trace-header-value">${escapeHtmlTrace(h.value)}</span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      // Request Body
      if (req.requestBody) {
        html += `
          <div class="trace-network-details-section" onclick="event.stopPropagation(); toggleDetailsSection(this)">
            <div class="trace-network-details-title">Request Body</div>
            <div class="trace-network-details-content">
              <pre class="trace-request-body">${escapeHtmlTrace(formatBody(req.requestBody))}</pre>
            </div>
          </div>
        `;
      }

      // Timing breakdown
      if (req.timings) {
        const t = req.timings;
        html += `
          <div class="trace-network-details-section expanded" onclick="event.stopPropagation(); toggleDetailsSection(this)">
            <div class="trace-network-details-title">Timing</div>
            <div class="trace-network-details-content">
              <div class="trace-header-row"><span class="trace-header-name">DNS</span><span class="trace-header-value">${t.dns.toFixed(1)}ms</span></div>
              <div class="trace-header-row"><span class="trace-header-name">Connect</span><span class="trace-header-value">${t.connect.toFixed(1)}ms</span></div>
              <div class="trace-header-row"><span class="trace-header-name">SSL</span><span class="trace-header-value">${t.ssl.toFixed(1)}ms</span></div>
              <div class="trace-header-row"><span class="trace-header-name">Wait (TTFB)</span><span class="trace-header-value">${t.wait.toFixed(1)}ms</span></div>
              <div class="trace-header-row"><span class="trace-header-name">Receive</span><span class="trace-header-value">${t.receive.toFixed(1)}ms</span></div>
            </div>
          </div>
        `;
      }

      return html;
    }

    function toggleNetworkDetails(idx) {
      const item = document.querySelectorAll('.trace-network-item')[idx];
      if (item) {
        item.classList.toggle('expanded');
      }
    }

    function toggleDetailsSection(section) {
      section.classList.toggle('expanded');
    }

    function formatBody(body) {
      if (!body) return '';
      try {
        const parsed = JSON.parse(body);
        return JSON.stringify(parsed, null, 2);
      } catch {
        return body;
      }
    }

    function getResourceType(url, mimeType) {
      if (mimeType) {
        if (mimeType.includes('javascript')) return 'js';
        if (mimeType.includes('css')) return 'css';
        if (mimeType.includes('image')) return 'img';
        if (mimeType.includes('html')) return 'doc';
        if (mimeType.includes('json') || mimeType.includes('xml')) return 'xhr';
      }
      const ext = url.split('?')[0].split('.').pop()?.toLowerCase() || '';
      if (['js', 'mjs'].includes(ext)) return 'js';
      if (['css'].includes(ext)) return 'css';
      if (['png', 'jpg', 'jpeg', 'gif', 'svg', 'ico', 'webp'].includes(ext)) return 'img';
      if (['html', 'htm'].includes(ext)) return 'doc';
      return 'xhr';
    }

    function getUrlPath(url) {
      try {
        const u = new URL(url);
        return u.pathname + u.search;
      } catch {
        return url;
      }
    }

    function filterNetwork(searchTerm) {
      currentNetworkFilter = searchTerm.toLowerCase();
      applyNetworkFilters();
    }

    function filterNetworkType(type) {
      currentNetworkType = type;

      // Update filter buttons
      document.querySelectorAll('.trace-network-filter').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === type);
      });

      applyNetworkFilters();
    }

    function applyNetworkFilters() {
      document.querySelectorAll('.trace-network-item').forEach(item => {
        const url = (item.dataset.url || '').toLowerCase();
        const type = item.dataset.type || 'xhr';

        const matchesSearch = !currentNetworkFilter || url.includes(currentNetworkFilter);
        const matchesType = currentNetworkType === 'all' || type === currentNetworkType;

        item.classList.toggle('filtered-out', !matchesSearch || !matchesType);
      });
    }

    function renderMetadataTab() {
      const metadataContent = document.getElementById('traceMetadataContent');
      if (!metadataContent || !traceData) return;

      const m = traceData.metadata;
      const ctx = traceData.contextInfo || {};

      metadataContent.innerHTML = `
        <div class="trace-metadata-grid">
          <div class="trace-metadata-card">
            <div class="trace-metadata-card-title"> Browser</div>
            <div class="trace-metadata-row">
              <span class="trace-metadata-label">Name</span>
              <span class="trace-metadata-value">${escapeHtmlTrace(m.browserName)}</span>
            </div>
            ${m.browserVersion ? `
              <div class="trace-metadata-row">
                <span class="trace-metadata-label">Version</span>
                <span class="trace-metadata-value">${escapeHtmlTrace(m.browserVersion)}</span>
              </div>
            ` : ''}
            ${ctx.channel ? `
              <div class="trace-metadata-row">
                <span class="trace-metadata-label">Channel</span>
                <span class="trace-metadata-value">${escapeHtmlTrace(ctx.channel)}</span>
              </div>
            ` : ''}
          </div>

          <div class="trace-metadata-card">
            <div class="trace-metadata-card-title"> Viewport</div>
            <div class="trace-metadata-row">
              <span class="trace-metadata-label">Width</span>
              <span class="trace-metadata-value">${m.viewport.width || 'auto'}px</span>
            </div>
            <div class="trace-metadata-row">
              <span class="trace-metadata-label">Height</span>
              <span class="trace-metadata-value">${m.viewport.height || 'auto'}px</span>
            </div>
            ${ctx.deviceScaleFactor ? `
              <div class="trace-metadata-row">
                <span class="trace-metadata-label">Scale</span>
                <span class="trace-metadata-value">${ctx.deviceScaleFactor}x</span>
              </div>
            ` : ''}
          </div>

          <div class="trace-metadata-card">
            <div class="trace-metadata-card-title"> Platform</div>
            <div class="trace-metadata-row">
              <span class="trace-metadata-label">OS</span>
              <span class="trace-metadata-value">${escapeHtmlTrace(m.platform)}</span>
            </div>
            ${m.locale ? `
              <div class="trace-metadata-row">
                <span class="trace-metadata-label">Locale</span>
                <span class="trace-metadata-value">${escapeHtmlTrace(m.locale)}</span>
              </div>
            ` : ''}
            ${ctx.timezoneId ? `
              <div class="trace-metadata-row">
                <span class="trace-metadata-label">Timezone</span>
                <span class="trace-metadata-value">${escapeHtmlTrace(ctx.timezoneId)}</span>
              </div>
            ` : ''}
          </div>

          <div class="trace-metadata-card">
            <div class="trace-metadata-card-title"> Timing</div>
            <div class="trace-metadata-row">
              <span class="trace-metadata-label">Duration</span>
              <span class="trace-metadata-value">${(m.duration / 1000).toFixed(2)}s</span>
            </div>
            <div class="trace-metadata-row">
              <span class="trace-metadata-label">Actions</span>
              <span class="trace-metadata-value">${traceData.actions.length}</span>
            </div>
            <div class="trace-metadata-row">
              <span class="trace-metadata-label">Network</span>
              <span class="trace-metadata-value">${traceData.network.length} requests</span>
            </div>
          </div>
        </div>
      `;
    }

    function renderErrorsTab() {
      const errorsContent = document.getElementById('traceErrorsContent');
      if (!errorsContent || !traceData) return;

      if (traceData.errors.length === 0) {
        errorsContent.innerHTML = '<div class="trace-empty">No errors</div>';
      } else {
        errorsContent.innerHTML = traceData.errors.map(err => `
          <div class="trace-error-item">
            <div class="trace-error-action">Action: ${escapeHtmlTrace(err.action)}</div>
            <div class="trace-error-name">${escapeHtmlTrace(err.name)}</div>
            <div class="trace-error-message">${escapeHtmlTrace(err.message)}</div>
          </div>
        `).join('');
      }
    }

    function updateTabBadges() {
      // Console badge
      const consoleBadge = document.getElementById('traceConsoleCount');
      if (consoleBadge && traceData) {
        const errorCount = traceData.console.filter(c => c.type === 'error').length;
        if (errorCount > 0) {
          consoleBadge.textContent = errorCount;
          consoleBadge.style.display = 'inline-block';
        } else {
          consoleBadge.style.display = 'none';
        }
      }

      // Error badge
      const errorBadge = document.getElementById('traceErrorCount');
      if (errorBadge && traceData) {
        if (traceData.errors.length > 0) {
          errorBadge.textContent = traceData.errors.length;
          errorBadge.style.display = 'inline-block';
        } else {
          errorBadge.style.display = 'none';
        }
      }
    }

    function filterTraceActions(searchTerm) {
      actionSearchTerm = searchTerm.toLowerCase();

      // Show/hide clear button
      const clearBtn = document.getElementById('traceSearchClear');
      if (clearBtn) {
        clearBtn.style.display = searchTerm ? 'block' : 'none';
      }

      // Filter and highlight actions
      document.querySelectorAll('.trace-action-item').forEach(item => {
        const index = parseInt(item.dataset.index);
        const action = traceData?.actions[index];
        if (!action) return;

        const title = (action.title || action.method || '').toLowerCase();
        const selector = (action.params?.selector || action.params?.url || '').toLowerCase();
        const matches = !searchTerm || title.includes(actionSearchTerm) || selector.includes(actionSearchTerm);

        item.classList.toggle('filtered-out', !matches);

        // Highlight matching text
        const nameEl = item.querySelector('.trace-action-name');
        if (nameEl && action) {
          const originalText = action.title || action.method;
          if (searchTerm && matches) {
            const regex = new RegExp('(' + escapeRegex(searchTerm) + ')', 'gi');
            nameEl.innerHTML = escapeHtmlTrace(originalText).replace(regex, '<mark>$1</mark>');
          } else {
            nameEl.textContent = originalText;
          }
        }
      });
    }

    function clearActionSearch() {
      const input = document.getElementById('traceActionSearch');
      if (input) {
        input.value = '';
        filterTraceActions('');
      }
    }

    function escapeRegex(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function setupPanelResizer() {
      const resizer = document.getElementById('traceResizer');
      const actionsPanel = document.getElementById('traceActionsPanel');
      if (!resizer || !actionsPanel) return;

      let isResizing = false;
      let startX = 0;
      let startWidth = 0;

      resizer.addEventListener('mousedown', (e) => {
        isResizing = true;
        startX = e.clientX;
        startWidth = actionsPanel.offsetWidth;
        resizer.classList.add('active');
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;
        const diff = e.clientX - startX;
        const newWidth = Math.min(Math.max(startWidth + diff, 200), 400);
        actionsPanel.style.width = newWidth + 'px';
      });

      document.addEventListener('mouseup', () => {
        if (isResizing) {
          isResizing = false;
          resizer.classList.remove('active');
          document.body.style.cursor = '';
          document.body.style.userSelect = '';
        }
      });
    }

    function getActionIcon(method) {
      const icons = {
        'goto': '',
        'click': '',
        'dblclick': '',
        'fill': '',
        'type': '',
        'press': '',
        'check': '',
        'uncheck': '',
        'selectOption': '',
        'hover': '',
        'focus': '',
        'blur': '',
        'screenshot': '',
        'evaluate': '',
        'evaluateHandle': '',
        'waitForSelector': '',
        'waitForTimeout': '',
        'waitForLoadState': '',
        'waitForNavigation': '',
        'waitForURL': '',
        'waitForFunction': '',
        'expect': '',
        'toBeVisible': '',
        'toHaveText': '',
        'toHaveValue': '',
        'toBeChecked': '',
        'toBeEnabled': '',
        'toBeDisabled': '',
        'toHaveAttribute': '',
        'toHaveClass': '',
        'toHaveCount': '#',
        'toContainText': '',
        'newPage': '',
        'newContext': '',
        'close': '',
        'setContent': '',
        'setViewportSize': '',
        'route': '',
        'unroute': '',
        'request': '',
        'fetch': ''
      };
      return icons[method] || '';
    }

    function switchTraceTab(tabName) {
      document.querySelectorAll('.trace-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === tabName);
      });
      document.querySelectorAll('.trace-tab-pane').forEach(pane => {
        pane.classList.toggle('active', pane.id === 'traceTab' + tabName.charAt(0).toUpperCase() + tabName.slice(1));
      });
    }

    function showTraceState(state) {
      const loading = document.getElementById('traceLoading');
      const error = document.getElementById('traceError');
      const content = document.getElementById('traceContent');

      if (loading) loading.style.display = state === 'loading' ? 'flex' : 'none';
      if (error) error.style.display = state === 'error' ? 'flex' : 'none';
      if (content) content.style.display = state === 'content' ? 'flex' : 'none';
    }

    function showTraceError(message) {
      showTraceState('error');
      const msgEl = document.getElementById('traceErrorMessage');
      if (msgEl) msgEl.textContent = message;
    }

    function closeTraceModal() {
      const modal = document.getElementById('traceViewerModal');
      if (modal) {
        modal.style.display = 'none';
        modal.classList.remove('fullscreen');
        document.body.style.overflow = '';
      }
      traceData = null;
      traceResources = {};
      traceScreenshots = new Map();
      currentActionIndex = 0;
      currentSnapshotMode = 'after';
      actionSearchTerm = '';
    }

    function toggleFullscreen() {
      const modal = document.getElementById('traceViewerModal');
      const icon = document.getElementById('fullscreenIcon');
      if (modal) {
        modal.classList.toggle('fullscreen');
        if (icon) {
          icon.textContent = modal.classList.contains('fullscreen') ? '' : '';
        }
      }
    }

    function escapeHtmlTrace(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
    }

    // Timeline slider functionality
    function setupTimelineSlider() {
      const track = document.getElementById('traceSliderTrack');
      const thumb = document.getElementById('traceSliderThumb');
      const progress = document.getElementById('traceSliderProgress');
      if (!track || !thumb || !progress || !traceData) return;

      let isDragging = false;

      function updateSliderPosition(percent) {
        const clampedPercent = Math.max(0, Math.min(100, percent));
        thumb.style.left = clampedPercent + '%';
        progress.style.width = clampedPercent + '%';

        // Find closest action to this time position
        if (traceData.actions.length > 0) {
          const actionIndex = Math.round((clampedPercent / 100) * (traceData.actions.length - 1));
          selectTraceAction(actionIndex);
        }
      }

      function handleSliderInteraction(e) {
        const rect = track.getBoundingClientRect();
        const percent = ((e.clientX - rect.left) / rect.width) * 100;
        updateSliderPosition(percent);
      }

      track.addEventListener('click', handleSliderInteraction);

      thumb.addEventListener('mousedown', (e) => {
        isDragging = true;
        document.body.style.cursor = 'grabbing';
        document.body.style.userSelect = 'none';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        handleSliderInteraction(e);
      });

      document.addEventListener('mouseup', () => {
        if (isDragging) {
          isDragging = false;
          document.body.style.cursor = '';
          document.body.style.userSelect = '';
        }
      });
    }

    function updateTimelineSlider(actionIndex) {
      const thumb = document.getElementById('traceSliderThumb');
      const progress = document.getElementById('traceSliderProgress');
      if (!thumb || !progress || !traceData || traceData.actions.length === 0) return;

      const percent = (actionIndex / (traceData.actions.length - 1)) * 100;
      thumb.style.left = percent + '%';
      progress.style.width = percent + '%';
    }

    // Timeline hover magnification
    function setupTimelineMagnifier() {
      const scroll = document.getElementById('traceTimelineScroll');
      const magnifier = document.getElementById('traceTimelineMagnifier');
      const magnifierImg = document.getElementById('traceMagnifierImg');
      const magnifierTime = document.getElementById('traceMagnifierTime');
      if (!scroll || !magnifier) return;

      scroll.addEventListener('mousemove', (e) => {
        const thumb = e.target.closest('.trace-timeline-thumb');
        if (!thumb) {
          magnifier.style.display = 'none';
          return;
        }

        const img = thumb.querySelector('img');
        if (!img || !img.src) {
          magnifier.style.display = 'none';
          return;
        }

        magnifierImg.src = img.src;
        const timestamp = parseInt(thumb.dataset.timestamp) || 0;
        const baseTime = traceData?.startTime || 0;
        magnifierTime.textContent = Math.round(timestamp - baseTime) + 'ms';

        // Position magnifier
        const thumbRect = thumb.getBoundingClientRect();
        const scrollRect = scroll.getBoundingClientRect();
        magnifier.style.left = (thumbRect.left - scrollRect.left + thumbRect.width / 2) + 'px';
        magnifier.style.display = 'block';
      });

      scroll.addEventListener('mouseleave', () => {
        magnifier.style.display = 'none';
      });
    }

    // Click position indicator
    function showClickPosition(action) {
      const indicator = document.getElementById('traceClickIndicator');
      const container = document.getElementById('traceScreenshotContainer');
      const screenshot = document.getElementById('traceScreenshot');

      if (!indicator || !container || !screenshot) return;

      // Check if this is a click action with point data
      const isClickAction = ['click', 'dblclick', 'hover', 'tap'].includes(action.method);
      const hasPoint = action.point && typeof action.point.x === 'number' && typeof action.point.y === 'number';

      if (!isClickAction || !hasPoint) {
        indicator.style.display = 'none';
        return;
      }

      // Wait for image to load to get correct dimensions
      if (!screenshot.complete || screenshot.naturalWidth === 0) {
        screenshot.onload = () => showClickPosition(action);
        return;
      }

      // Calculate position relative to displayed image
      const imgRect = screenshot.getBoundingClientRect();
      const containerRect = container.getBoundingClientRect();

      // Scale factor between original viewport and displayed image
      const scaleX = imgRect.width / (traceData?.metadata?.viewport?.width || 1280);
      const scaleY = imgRect.height / (traceData?.metadata?.viewport?.height || 720);

      const x = (imgRect.left - containerRect.left) + (action.point.x * scaleX);
      const y = (imgRect.top - containerRect.top) + (action.point.y * scaleY);

      indicator.style.left = x + 'px';
      indicator.style.top = y + 'px';
      indicator.style.display = 'block';
    }

    // Attachments tab
    function renderAttachmentsTab() {
      const content = document.getElementById('traceAttachmentsContent');
      if (!content || !traceData) return;

      // Collect all resources that look like attachments (store globally for preview)
      traceAttachments = [];

      // Add screenshots as attachments
      for (const [key, dataUri] of Object.entries(traceResources)) {
        if (key.endsWith('.jpeg') || key.endsWith('.png')) {
          traceAttachments.push({
            name: key,
            type: 'image',
            dataUri: dataUri
          });
        }
      }

      if (traceAttachments.length === 0) {
        content.innerHTML = '<div class="trace-empty">No attachments in this trace</div>';
        return;
      }

      content.innerHTML = `
        <div class="trace-attachments-grid">
          ${traceAttachments.slice(0, 20).map((att, idx) => `
            <div class="trace-attachment-card">
              <div class="trace-attachment-preview">
                ${att.type === 'image' ? `<img src="${att.dataUri}" alt="${escapeHtmlTrace(att.name)}" onclick="openAttachmentPreview(${idx})">` : `<span class="trace-attachment-preview-icon"></span>`}
              </div>
              <div class="trace-attachment-info">
                <div class="trace-attachment-name" title="${escapeHtmlTrace(att.name)}">${escapeHtmlTrace(att.name)}</div>
                <div class="trace-attachment-meta">${att.type}</div>
              </div>
            </div>
          `).join('')}
        </div>
        ${traceAttachments.length > 20 ? '<p class="trace-empty">Showing first 20 of ' + traceAttachments.length + ' attachments</p>' : ''}
      `;

      // Update badge
      const badge = document.getElementById('traceAttachmentCount');
      if (badge && traceAttachments.length > 0) {
        badge.textContent = traceAttachments.length;
        badge.style.display = 'inline-block';
      }
    }

    // Open attachment in fullscreen preview modal
    function openAttachmentPreview(index) {
      if (!traceAttachments[index]) return;

      const att = traceAttachments[index];

      // Create or reuse modal
      let modal = document.getElementById('attachmentPreviewModal');
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'attachmentPreviewModal';
        modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:10000;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;';
        modal.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };
        document.body.appendChild(modal);
      }

      modal.innerHTML = `
        <div style="color:#fff;margin-bottom:10px;font-size:14px;">${escapeHtmlTrace(att.name)} (${index + 1}/${traceAttachments.length})</div>
        <img src="${att.dataUri}" style="max-width:90vw;max-height:80vh;object-fit:contain;border-radius:8px;" alt="${escapeHtmlTrace(att.name)}">
        <div style="margin-top:15px;display:flex;gap:10px;">
          <button onclick="openAttachmentPreview(${Math.max(0, index - 1)})" style="padding:8px 16px;background:#333;color:#fff;border:none;border-radius:4px;cursor:pointer;" ${index === 0 ? 'disabled style="opacity:0.5;padding:8px 16px;background:#333;color:#fff;border:none;border-radius:4px;"' : ''}> Previous</button>
          <button onclick="document.getElementById('attachmentPreviewModal').style.display='none'" style="padding:8px 16px;background:#666;color:#fff;border:none;border-radius:4px;cursor:pointer;">Close (Esc)</button>
          <button onclick="openAttachmentPreview(${Math.min(traceAttachments.length - 1, index + 1)})" style="padding:8px 16px;background:#333;color:#fff;border:none;border-radius:4px;cursor:pointer;" ${index === traceAttachments.length - 1 ? 'disabled style="opacity:0.5;padding:8px 16px;background:#333;color:#fff;border:none;border-radius:4px;"' : ''}>Next </button>
        </div>
      `;
      modal.style.display = 'flex';

      // Add keyboard navigation
      const keyHandler = (e) => {
        if (modal.style.display !== 'flex') {
          document.removeEventListener('keydown', keyHandler);
          return;
        }
        if (e.key === 'Escape') modal.style.display = 'none';
        if (e.key === 'ArrowLeft' && index > 0) openAttachmentPreview(index - 1);
        if (e.key === 'ArrowRight' && index < traceAttachments.length - 1) openAttachmentPreview(index + 1);
      };
      document.addEventListener('keydown', keyHandler);
    }

    // Sortable network columns
    let networkSortColumn = null;
    let networkSortAsc = true;

    function sortNetworkBy(column) {
      if (networkSortColumn === column) {
        networkSortAsc = !networkSortAsc;
      } else {
        networkSortColumn = column;
        networkSortAsc = true;
      }

      // Update header styles
      document.querySelectorAll('.trace-network-header-cell').forEach(cell => {
        const isActive = cell.dataset.column === column;
        cell.classList.toggle('sorted', isActive);
        const icon = cell.querySelector('.trace-network-sort-icon');
        if (icon) {
          icon.textContent = isActive ? (networkSortAsc ? '' : '') : '';
        }
      });

      // Re-render with current sort settings (sorting done in renderNetworkTab)
      if (traceData && traceData.network) {
        renderNetworkTab();
      }
    }

    // Get sorted network data without mutating original
    function getSortedNetworkData() {
      if (!traceData || !traceData.network) return [];

      // Create a shallow copy to avoid mutating original order
      const networkCopy = [...traceData.network];

      if (!networkSortColumn) return networkCopy;

      return networkCopy.sort((a, b) => {
        let aVal, bVal;
        switch (networkSortColumn) {
          case 'method': aVal = a.method || ''; bVal = b.method || ''; break;
          case 'url': aVal = a.url || ''; bVal = b.url || ''; break;
          case 'status': aVal = a.status || 0; bVal = b.status || 0; break;
          case 'time': aVal = a.time || 0; bVal = b.time || 0; break;
          default: return 0;
        }
        if (typeof aVal === 'string') {
          return networkSortAsc ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
        }
        return networkSortAsc ? aVal - bVal : bVal - aVal;
      });
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      const modal = document.getElementById('traceViewerModal');
      if (modal && modal.style.display === 'flex') {
        if (e.key === 'Escape') closeTraceModal();
        if (e.key === 'ArrowUp' && traceData) {
          e.preventDefault();
          // Find previous visible action
          let prev = currentActionIndex - 1;
          while (prev >= 0) {
            const item = document.querySelector(`.trace-action-item[data-index="${prev}"]`);
            if (item && !item.classList.contains('filtered-out')) break;
            prev--;
          }
          if (prev >= 0) selectTraceAction(prev);
        }
        if (e.key === 'ArrowDown' && traceData) {
          e.preventDefault();
          // Find next visible action
          let next = currentActionIndex + 1;
          while (next < traceData.actions.length) {
            const item = document.querySelector(`.trace-action-item[data-index="${next}"]`);
            if (item && !item.classList.contains('filtered-out')) break;
            next++;
          }
          if (next < traceData.actions.length) selectTraceAction(next);
        }
        // Before/After snapshot shortcuts
        if (e.key === 'b' || e.key === 'B') {
          e.preventDefault();
          switchSnapshot('before');
        }
        if (e.key === 'a' || e.key === 'A') {
          e.preventDefault();
          switchSnapshot('after');
        }
        // Tab switching with number keys
        if (e.key === '1') switchTraceTab('details');
        if (e.key === '2') switchTraceTab('console');
        if (e.key === '3') switchTraceTab('source');
        if (e.key === '4') switchTraceTab('network');
        if (e.key === '5') switchTraceTab('metadata');
        if (e.key === '6') switchTraceTab('errors');
        // Fullscreen toggle
        if (e.key === 'f' || e.key === 'F') {
          e.preventDefault();
          toggleFullscreen();
        }
      }
    });
  
  </script>
</body>
</html>